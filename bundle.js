!function e(t,n,r){function o(s,i){if(!n[s]){if(!t[s]){var c="function"==typeof require&&require;if(!i&&c)return c(s,!0);if(a)return a(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var u=n[s]={exports:{}};t[s][0].call(u.exports,(function(e){return o(t[s][1][e]||e)}),u,u.exports,e,t,n,r)}return n[s].exports}for(var a="function"==typeof require&&require,s=0;s<r.length;s++)o(r[s]);return o}({1:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./commentBlockControl"),o=e("./Menu"),a=e("./messages");class s extends o.Menu{update(){this.clearItems();const e=r.getBlockedUsers();0===e.length?this.addItem(a.NO_BLOCKED_USERS,{small:!0}):this.addItem(a.CLICK_TO_UNBLOCK,{small:!0}),e.forEach(e=>{this.addItem(e,{small:!0,button:!0}).onClick(()=>{r.unblockUser(e)})})}constructor(e){super("屏蔽用户评论管理",e),this.update(),r.blockedUserUpdateEvent.on(this.update.bind(this))}}n.BlockMenu=s},{"./Menu":8,"./commentBlockControl":16,"./messages":26}],2:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./chapterControl"),o=e("./data"),a=e("./history"),s=e("./Menu"),i=e("./shortNumber"),c=new Map;let l=null;function u(e,t){l=e.append("[上次阅读]")}function d(e){switch(e){case"Markdown":return s.ItemDecoration.ICON_FILE;case"WTCD":return s.ItemDecoration.ICON_GAME}}r.loadChapterEvent.on(e=>{null!==l&&l.remove(),u(c.get(e))});class h extends s.Menu{constructor(e,t){void 0===t&&(t=o.data.chapterTree),super(t.isRoot?"章节选择":t.displayName,e);for(const e of t.subFolders){this.addLink(new h(this,e),!0,s.ItemDecoration.ICON_FOLDER).append(`[${i.shortNumber(e.folderCharCount)}]`,"char-count")}for(const e of t.chapters){const t=this.addItem(e.displayName,{small:!0,button:!0,decoration:d(e.type)}).onClick(()=>{r.loadChapter(e.htmlRelativePath),a.updateHistory(!0)});e.isEarlyAccess&&(t.prepend("[编写中]"),t.addClass("early-access")),t.append(`[${i.shortNumber(e.chapterCharCount)}]`,"char-count"),window.localStorage.getItem("lastRead")===e.htmlRelativePath&&u(t,e.htmlRelativePath),c.set(e.htmlRelativePath,t)}}}n.ChaptersMenu=h},{"./Menu":8,"./chapterControl":15,"./data":18,"./history":22,"./shortNumber":29}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./Menu");class o extends r.Menu{constructor(e){super("订阅/讨论组",e),this.addItem("Telegram 更新推送频道",{small:!0,button:!0,link:"https://t.me/joinchat/AAAAAEpkRVwZ-3s5V3YHjA",decoration:r.ItemDecoration.ICON_LINK}),this.addItem("Telegram 讨论组",{small:!0,button:!0,link:"https://t.me/joinchat/Dt8_WlJnmEwYNbjzlnLyNA",decoration:r.ItemDecoration.ICON_LINK}),this.addItem("GitHub Repo",{small:!0,button:!0,link:"https://github.com/SCLeoX/Wearable-Technology",decoration:r.ItemDecoration.ICON_LINK}),this.addItem("原始 Google Docs",{small:!0,button:!0,link:"https://docs.google.com/document/d/1Pp5CtO8c77DnWGqbXg-3e7w9Q3t88P35FOl6iIJvMfo/edit?usp=sharing",decoration:r.ItemDecoration.ICON_LINK})}}n.ContactMenu=o},{"./Menu":8}],4:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./DebugLogger");n.id=function(e){return document.getElementById(e)},n.getTextNodes=function e(t,n){const r=n||[];let o=t.firstChild;for(;null!==o;)o instanceof HTMLElement&&e(o,r),o instanceof Text&&r.push(o),o=o.nextSibling;return r};const o=new r.DebugLogger("selectNode");n.selectNode=function(e){try{const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}catch(t){o.log("Failed to select node: ",e,"; Error: ",t)}},n.isAnyParent=function(e,t){for(;null!==e;){if(t(e))return!0;e=e.parentElement}return!1}},{"./DebugLogger":5}],5:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./settings");n.DebugLogger=class{constructor(e,t={}){this.prefix=e+"("+Object.keys(t).map(e=>`${e}=${function(e){switch(typeof e){case"string":return`"${e}"`;default:return String(e)}}(t[e])}`).join(",")+")"}log(...e){r.developerMode.getValue()&&console.info(this.prefix,...e)}info(...e){r.developerMode.getValue()&&console.info(this.prefix,...e)}warn(...e){r.developerMode.getValue()&&console.warn(this.prefix,...e)}error(...e){r.developerMode.getValue()&&console.error(this.prefix,...e)}}},{"./settings":28}],6:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.Event=class{constructor(){this.listeners=null,this.onceListeners=null,this.isEmitting=!1,this.queue=[]}on(e){return this.isEmitting?(this.queue.push(()=>{this.on(e)}),e):(null===this.listeners&&(this.listeners=new Set),this.listeners.add(e),e)}off(e){this.isEmitting?this.queue.push(()=>{this.off(e)}):null!==this.listeners&&this.listeners.delete(e)}once(e){return this.isEmitting?(this.queue.push(()=>{this.once(e)}),e):(null===this.onceListeners&&(this.onceListeners=[]),this.onceListeners.push(e),e)}expect(e){return this.isEmitting?new Promise(t=>{this.queue.push(()=>{this.expect(e).then(t)})}):void 0===e?new Promise(e=>this.once(e)):new Promise(t=>{const n=this.on(r=>{e(r)&&(this.off(n),t(r))})})}emit(e){this.isEmitting?this.queue.push(()=>{this.emit(e)}):(this.isEmitting=!0,null!==this.listeners&&this.listeners.forEach(t=>t(e)),null!==this.onceListeners&&(this.onceListeners.forEach(t=>t(e)),this.onceListeners.length=0),this.isEmitting=!1,this.queue.forEach(e=>e()),this.queue.length=0)}}},{}],7:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./ChaptersMenu"),o=e("./ContactMenu"),a=e("./Menu"),s=e("./SettingsMenu"),i=e("./StatsMenu"),c=e("./StyleMenu"),l=e("./ThanksMenu");class u extends a.Menu{constructor(){super("",null),this.addLink(new r.ChaptersMenu(this)),this.addLink(new l.ThanksMenu(this)),this.addLink(new c.StyleMenu(this)),this.addLink(new o.ContactMenu(this)),this.addItem("源代码",{button:!0,link:"https://github.com/SCLeoX/Wearable-Technology"}),this.addLink(new s.SettingsMenu(this)),this.addLink(new i.StatsMenu(this))}}n.MainMenu=u},{"./ChaptersMenu":2,"./ContactMenu":3,"./Menu":8,"./SettingsMenu":10,"./StatsMenu":12,"./StyleMenu":13,"./ThanksMenu":14}],8:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./DebugLogger"),o=e("./Event"),a=e("./RectMode");var s;function i(e,...t){const n=document.createElement("span");return n.innerText=e,n.classList.add(...t),n}!function(e){e[e.SELECTABLE=0]="SELECTABLE",e[e.BACK=1]="BACK",e[e.ICON_FOLDER=2]="ICON_FOLDER",e[e.ICON_LINK=3]="ICON_LINK",e[e.ICON_EQUALIZER=4]="ICON_EQUALIZER",e[e.ICON_FILE=5]="ICON_FILE",e[e.ICON_GAME=6]="ICON_GAME"}(s=n.ItemDecoration||(n.ItemDecoration={}));class c{constructor(e,t){this.menu=e,this.element=t,this.$prependSpan=null,this.$appendSpan=null}setSelected(e){return this.element.classList.toggle("selected",e),this}onClick(e){return this.element.addEventListener("click",()=>{e(this.element)}),this}linkTo(e){return this.onClick(()=>{this.menu.navigateTo(e)}),this}setInnerText(e){return this.element.innerText=e,this}addClass(e){return this.element.classList.add(e),this}removeClass(e){return this.element.classList.remove(e),this}prepend(e,t){null===this.$prependSpan&&(this.$prependSpan=i("","prepend"),this.element.prepend(this.$prependSpan));const n=i(e,"item-side");return void 0!==t&&n.classList.add(t),this.$prependSpan.prepend(n),n}append(e,t){null===this.$appendSpan&&(this.$appendSpan=i("","append"),this.element.appendChild(this.$appendSpan));const n=i(e,"item-side");return void 0!==t&&n.classList.add(t),this.$appendSpan.appendChild(n),n}}n.ItemHandle=c;n.Menu=class{constructor(e,t,n=a.RectMode.OFF){if(this.name=e,this.parent=t,this.rectMode=n,this.active=!1,this.clearableElements=[],this.activateEvent=new o.Event,this.debugLogger=new r.DebugLogger("Menu",{name:e}),this.fullPath=null===t?[]:t.fullPath.slice(),""!==e&&this.fullPath.push(e),this.container=document.createElement("div"),this.container.classList.add("menu","hidden"),this.fullPath.length>=1){const e=document.createElement("div");e.classList.add("path"),e.innerText=this.fullPath.join(" > "),this.container.appendChild(e)}null!==t&&this.addItem("返回",{button:!0,decoration:s.BACK,unclearable:!0}).linkTo(t),document.body.appendChild(this.container),a.rectModeChangeEvent.on(({newRectMode:e})=>{this.active&&e===a.RectMode.MAIN&&(this.setActive(!1),a.rectModeChangeEvent.expect().then(()=>{this.setActive(!0)}))})}navigateTo(e){this.setActive(!1),e.setActive(!0),a.setRectMode(e.rectMode)}exit(){if(null===this.parent)throw new Error("Cannot exit the root menu.");this.navigateTo(this.parent)}setActive(e){this.debugLogger.log(`setActive(${e})`),!this.active&&e&&this.activateEvent.emit(),this.active=e,this.container.classList.toggle("hidden",!e)}isActive(){return this.active}addItem(e,t){let n;if(t.button&&void 0!==t.link?((n=document.createElement("a")).href=t.link,n.target="_blank"):n=document.createElement("div"),n.innerText=e,t.small&&n.classList.add("small"),t.button)switch(n.classList.add("button"),t.decoration){case s.BACK:n.classList.add("back");break;case s.SELECTABLE:n.classList.add("selectable");break;case s.ICON_FOLDER:n.classList.add("icon","folder");break;case s.ICON_LINK:n.classList.add("icon","link");break;case s.ICON_EQUALIZER:n.classList.add("icon","equalizer");break;case s.ICON_FILE:n.classList.add("icon","file");break;case s.ICON_GAME:n.classList.add("icon","game")}return this.container.appendChild(n),t.unclearable||this.clearableElements.push(n),new c(this,n)}clearItems(){this.clearableElements.forEach(e=>e.remove()),this.clearableElements=[]}addLink(e,t,n){return this.addItem(e.name,{small:t,button:!0,decoration:n}).linkTo(e)}}},{"./DebugLogger":5,"./Event":6,"./RectMode":9}],9:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./DebugLogger"),o=e("./DOM"),a=e("./Event");var s;!function(e){e[e.SIDE=0]="SIDE",e[e.MAIN=1]="MAIN",e[e.OFF=2]="OFF"}(s=n.RectMode||(n.RectMode={}));const i=o.id("rect"),c=new r.DebugLogger("RectMode");n.rectModeChangeEvent=new a.Event;let l=s.OFF;n.setRectMode=function(e){c.log(`${s[l]} -> ${s[e]}`),l!==e&&(e===s.OFF?i.classList.remove("reading"):(l===s.MAIN?i.classList.remove("main"):l===s.SIDE?i.classList.remove("side"):(i.classList.remove("main","side"),i.classList.add("reading")),e===s.MAIN?i.classList.add("main"):i.classList.add("side")),n.rectModeChangeEvent.emit({previousRectMode:l,newRectMode:e}),l=e)}},{"./DOM":4,"./DebugLogger":5,"./Event":6}],10:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./BlockMenu"),o=e("./commentsControl"),a=e("./DOM"),s=e("./Menu"),i=e("./RectMode"),c=e("./settings"),l=e("./stylePreviewArticle");class u extends s.Menu{constructor(e,t,n,r){let c;super(`${t}设置`,e,r?i.RectMode.SIDE:i.RectMode.MAIN),r&&this.activateEvent.on(()=>{o.hideComments(),a.id("content").innerHTML=l.stylePreviewArticle}),n.options.forEach((e,t)=>{const r=this.addItem(e,{small:!0,button:!0,decoration:s.ItemDecoration.SELECTABLE}).onClick(()=>{c.setSelected(!1),r.setSelected(!0),n.setValue(t),c=r});t===n.getValue()&&(c=r,r.setSelected(!0))})}}n.EnumSettingMenu=u;class d extends s.Menu{constructor(e){super("设置",e),this.addBooleanSetting("NSFW 警告",c.warning),this.addBooleanSetting("使用动画",c.animation),this.addBooleanSetting("显示编写中章节",c.earlyAccess),this.addBooleanSetting("显示评论",c.useComments),this.addBooleanSetting("手势切换章节（仅限手机）",c.gestureSwitchChapter),this.addEnumSetting("字体",c.fontFamily,!0),this.addBooleanSetting("显示每个章节的字数",c.charCount),this.addBooleanSetting("开发人员模式",c.developerMode),this.addLink(new r.BlockMenu(this),!0)}addBooleanSetting(e,t){const n=()=>`${e}：${t.getValue()?"开":"关"}`,r=this.addItem(n(),{small:!0,button:!0}).onClick(()=>{t.toggle(),r.setInnerText(n())})}addEnumSetting(e,t,n){const r=()=>`${e}：${t.getValueName()}`,o=this.addItem(r(),{small:!0,button:!0}),a=new u(this,e,t,!0===n);o.linkTo(a).onClick(()=>{this.activateEvent.once(()=>{o.setInnerText(r())})})}}n.SettingsMenu=d},{"./BlockMenu":1,"./DOM":4,"./Menu":8,"./RectMode":9,"./commentsControl":17,"./settings":28,"./stylePreviewArticle":31}],11:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./data"),o=e("./Menu");class a extends o.Menu{constructor(e){super("关键词统计",e),this.addItem("添加其他关键词",{small:!0,button:!0,link:"https://github.com/SCLeoX/Wearable-Technology/edit/master/src/builder/keywords.ts",decoration:o.ItemDecoration.ICON_LINK}),r.data.keywordsCount.forEach(([e,t])=>{this.addItem(`${e}：${t}`,{small:!0})})}}n.StatsKeywordsCountMenu=a},{"./Menu":8,"./data":18}],12:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./data"),o=e("./Menu"),a=e("./StatsKeywordsCountMenu");class s extends o.Menu{constructor(e){super("统计",e),this.addItem("统计数据由构建脚本自动生成",{small:!0}),this.addLink(new a.StatsKeywordsCountMenu(this),!0,o.ItemDecoration.ICON_EQUALIZER),this.addItem(`总字数：${r.data.charsCount}`,{small:!0}),this.addItem(`总段落数：${r.data.paragraphsCount}`,{small:!0})}}n.StatsMenu=s},{"./Menu":8,"./StatsKeywordsCountMenu":11,"./data":18}],13:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./commentsControl"),o=e("./DebugLogger"),a=e("./DOM"),s=e("./Menu"),i=e("./RectMode"),c=e("./stylePreviewArticle");class l{constructor(e,t){this.name=e,this.def=t,this.styleSheet=null,this.debugLogger=new o.DebugLogger("Style",{name:e})}injectStyleSheet(){const e=document.createElement("style");document.head.appendChild(e);const t=e.sheet;t.disabled=!0;const n=e=>{try{t.insertRule(e)}catch(t){this.debugLogger.error(`Failed to inject rule "${e}".`,t)}},r=`rgb(${this.def.keyColor.join(",")})`,o=e=>`rgba(${this.def.keyColor.join(",")},${e})`;n(`.container { color: ${r}; }`),n(`.menu { color: ${r}; }`),n(`.menu .button:active::after { background-color: ${r}; }`),n(`.button::after { background-color: ${r}; }`),n(`body { background-color: ${this.def.paperBgColor}; }`),n(`.rect { background-color: ${this.def.rectBgColor}; }`),n(`.rect.reading>div { background-color: ${this.def.paperBgColor}; }`),n(`.rect.reading>div { color: ${r}; }`),n(`.rect.reading>.content a { color: ${this.def.linkColor}; }`),n(`.rect.reading>.content a:hover { color: ${this.def.linkHoverColor}; }`),n(`.rect.reading>.content a:active { color: ${this.def.linkActiveColor}; }`),n(`.rect.reading>.content>.earlyAccess.block { background-color: ${this.def.contentBlockEarlyAccessColor}; }`),n(`.rect>.comments>div { background-color: ${this.def.commentColor}; }`),n(`@media (min-width: 901px) { ::-webkit-scrollbar-thumb { background-color: ${this.def.paperBgColor}; } }`),n(`.rect>.comments>.create-comment::before { background-color: ${r}; }`),n(`:root { --key: ${r}; }`),n(`:root { --key-opacity-01: ${o(.1)}; }`),n(`:root { --key-opacity-05: ${o(.5)}; }`),n(`:root { --key-opacity-007: ${o(.07)}; }`),n(`:root { --key-opacity-004: ${o(.04)}; }`),n(`:root { --button-color: ${this.def.commentColor}; }`),this.styleSheet=t}active(){if(null!==l.currentlyEnabled){const e=l.currentlyEnabled;null!==e.styleSheet&&(e.styleSheet.disabled=!0),e.itemHandle.setSelected(!1)}null===this.styleSheet&&this.injectStyleSheet(),this.styleSheet.disabled=!1,this.itemHandle.setSelected(!0),window.localStorage.setItem("style",this.name),l.currentlyEnabled=this}}l.currentlyEnabled=null;const u={linkColor:"#00E",linkHoverColor:"#F00",linkActiveColor:"#00E"},d={linkColor:"#88F",linkHoverColor:"#F33",linkActiveColor:"#88F"},h=[new l("可穿戴科技（默认）",Object.assign(Object.assign({rectBgColor:"#444",paperBgColor:"#333",keyColor:[221,221,221]},d),{contentBlockEarlyAccessColor:"#E65100",commentColor:"#444",keyIsDark:!1})),new l("白纸",Object.assign(Object.assign({rectBgColor:"#EFEFED",paperBgColor:"#FFF",keyColor:[0,0,0]},u),{contentBlockEarlyAccessColor:"#FFE082",commentColor:"#F5F5F5",keyIsDark:!0})),new l("夜间",Object.assign(Object.assign({rectBgColor:"#272B36",paperBgColor:"#38404D",keyColor:[221,221,221]},d),{contentBlockEarlyAccessColor:"#E65100",commentColor:"#272B36",keyIsDark:!1})),new l("羊皮纸",Object.assign(Object.assign({rectBgColor:"#D8D4C9",paperBgColor:"#F8F4E9",keyColor:[85,40,48]},u),{contentBlockEarlyAccessColor:"#FFE082",commentColor:"#F9EFD7",keyIsDark:!0})),new l("巧克力",Object.assign(Object.assign({rectBgColor:"#2E1C11",paperBgColor:"#3A2519",keyColor:[221,175,153]},d),{contentBlockEarlyAccessColor:"#E65100",commentColor:"#2C1C11",keyIsDark:!1}))];class p extends s.Menu{constructor(e){super("阅读器样式",e,i.RectMode.SIDE);for(const e of h)e.itemHandle=this.addItem(e.name,{small:!0,button:!0,decoration:s.ItemDecoration.SELECTABLE}).onClick(()=>{e.active()});const t=window.localStorage.getItem("style");let n=!1;for(const e of h)if(t===e.name){e.active(),n=!0;break}n||h[0].active(),this.activateEvent.on(()=>{r.hideComments(),a.id("content").innerHTML=c.stylePreviewArticle})}}n.StyleMenu=p},{"./DOM":4,"./DebugLogger":5,"./Menu":8,"./RectMode":9,"./commentsControl":17,"./stylePreviewArticle":31}],14:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./Menu"),o=e("./thanks");class a extends r.Menu{constructor(e){super("鸣谢列表",e);for(const e of o.thanks)this.addItem(e.name,void 0===e.link?{small:!0}:{small:!0,button:!0,link:e.link,decoration:r.ItemDecoration.ICON_LINK})}}n.ThanksMenu=a},{"./Menu":8,"./thanks":32}],15:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../wtcd/FlowReader"),o=e("../wtcd/WTCDError"),a=e("./commentsControl"),s=e("./data"),i=e("./DebugLogger"),c=e("./DOM"),l=e("./Event"),u=e("./gestures"),d=e("./history"),h=e("./keyboard"),p=e("./loadingText"),g=e("./messages"),m=e("./processElements"),f=e("./RectMode"),v=e("./settings"),b=e("./state"),y=new i.DebugLogger("chapterControl"),E=c.id("content"),C=new Map;function T(){f.setRectMode(f.RectMode.OFF),b.state.currentChapter=null,b.state.chapterSelection=null,b.state.chapterTextNodes=null}n.loadChapterEvent=new l.Event,n.closeChapter=T;const w=([e,t,n,r])=>{if(null===b.state.chapterTextNodes)return;const o=b.state.chapterTextNodes[e],a=b.state.chapterTextNodes[n];if(void 0===o||void 0===a)return;document.getSelection().setBaseAndExtent(o,t,a,r);const s=o.parentElement;null!==s&&"function"==typeof s.scrollIntoView&&s.scrollIntoView()},L=()=>{const e=document.createElement("span");return e.style.flex="1",e},M=e=>v.earlyAccess.getValue()||!e.isEarlyAccess;function S(){const e=b.state.currentChapter;if(null===e)return;const t=e.inFolderIndex;if(t>=1&&M(e.folder.chapters[t-1])){x(e.folder.chapters[t-1].htmlRelativePath),d.updateHistory(!0)}}function R(){const e=b.state.currentChapter;if(null===e)return;const t=e.inFolderIndex;if(t<e.folder.chapters.length-1&&M(e.folder.chapters[t+1])){x(e.folder.chapters[t+1].htmlRelativePath),d.updateHistory(!0)}}n.loadPrevChapter=S,n.loadNextChapter=R;const D=e=>{b.state.chapterTextNodes=c.getTextNodes(E),void 0!==e&&(null===c.id("warning")?w(e):c.id("warning").addEventListener("click",()=>{w(e)})),m.processElements(E);const t=b.state.currentChapter,n=t.inFolderIndex;if(t.chapter.isEarlyAccess){const e=((e,t,n)=>{const r=document.createElement("div");r.classList.add("block",e);const o=document.createElement("h1");o.innerText=t,r.appendChild(o);const a=document.createElement("p");return a.innerText=n,r.appendChild(a),r})("earlyAccess","编写中章节","请注意，本文正在编写中，因此可能会含有未完成的句子或是尚未更新的信息。");E.prepend(e)}const r=document.createElement("div");if(r.style.display="flex",r.style.marginTop="2vw",n>=1&&M(t.folder.chapters[n-1])){const e=t.folder.chapters[n-1].htmlRelativePath,o=document.createElement("a");o.innerText="上一章",o.href=`${window.location.pathname}#${e}`,o.style.textAlign="left",o.style.flex="1",o.addEventListener("click",e=>{e.preventDefault(),S()}),r.appendChild(o)}else r.appendChild(L());const o=document.createElement("a");if(o.innerText="返回菜单",o.href=window.location.pathname,o.style.textAlign="center",o.style.flex="1",o.addEventListener("click",e=>{e.preventDefault(),T(),d.updateHistory(!0)}),r.appendChild(o),n<t.folder.chapters.length-1&&M(t.folder.chapters[n+1])){const e=t.folder.chapters[n+1].htmlRelativePath,o=document.createElement("a");o.innerText="下一章",o.href=`${window.location.pathname}#${e}`,o.style.textAlign="right",o.style.flex="1",o.addEventListener("click",e=>{e.preventDefault(),R()}),r.appendChild(o)}else r.appendChild(L());E.appendChild(r),a.loadComments(t.chapter.commentsUrl),c.id("rect").style.overflow="hidden",setTimeout(()=>{c.id("rect").style.overflow="",void 0===e&&c.id("rect").scrollTo(0,0)},1),setTimeout(()=>{c.id("rect").focus()},1)};var k;function _({errorType:e,message:t,internalStack:n,wtcdStack:r}){const o=document.createElement("div"),a=document.createElement("h1"),s=document.createElement("p");switch(e){case k.COMPILE:a.innerText=g.WTCD_ERROR_COMPILE_TITLE,s.innerText=g.WTCD_ERROR_COMPILE_TITLE;break;case k.RUNTIME:a.innerText=g.WTCD_ERROR_RUNTIME_TITLE,s.innerText=g.WTCD_ERROR_RUNTIME_DESC;break;case k.INTERNAL:a.innerText=g.WTCD_ERROR_INTERNAL_TITLE,s.innerText=g.WTCD_ERROR_INTERNAL_DESC}o.appendChild(a),o.appendChild(s);const i=document.createElement("p");if(i.innerText=g.WTCD_ERROR_MESSAGE+t,o.appendChild(i),void 0!==r){const e=document.createElement("h2");e.innerText=g.WTCD_ERROR_WTCD_STACK_TITLE,o.appendChild(e);const t=document.createElement("p");t.innerText=g.WTCD_ERROR_WTCD_STACK_DESC,o.appendChild(t);const n=document.createElement("pre"),a=document.createElement("code");a.innerText=r,n.appendChild(a),o.appendChild(n)}if(void 0!==n){const e=document.createElement("h2");e.innerText=g.WTCD_ERROR_INTERNAL_STACK_TITLE,o.appendChild(e);const t=document.createElement("p");t.innerText=g.WTCD_ERROR_INTERNAL_STACK_DESC,o.appendChild(t);const r=document.createElement("pre"),a=document.createElement("code");a.innerText=n,r.appendChild(a),o.appendChild(r)}return o}function I(e,t,n){switch(n.type){case"Markdown":e.innerHTML=t;break;case"WTCD":{e.innerHTML="";const a=JSON.parse(t);if(!0===a.error){e.appendChild(_({errorType:k.COMPILE,message:a.message,internalStack:a.internalStack}));break}const s=new r.FlowReader(n.htmlRelativePath,a.wtcdRoot,e=>_({errorType:e instanceof o.WTCDError?k.RUNTIME:k.INTERNAL,message:e.message,internalStack:e.stack,wtcdStack:e instanceof o.WTCDError?e.wtcdStack:void 0}),m.processElements),i=document.createElement("div");s.renderTo(i),E.appendChild(i);break}}}function x(e,t){y.log("Load chapter",e,"selection",t),a.hideComments(),n.loadChapterEvent.emit(e),window.localStorage.setItem("lastRead",e),f.setRectMode(f.RectMode.MAIN);const r=s.relativePathLookUpMap.get(e);return b.state.currentChapter=r,C.has(e)?null===C.get(e)?E.innerText=p.loadingText:(I(E,C.get(e),r.chapter),D(t)):(E.innerText=p.loadingText,fetch(`./chapters/${e}`).then(e=>e.text()).then(n=>{C.set(e,n),r===b.state.currentChapter&&(I(E,n,r.chapter),D(t))})),!0}u.swipeEvent.on(e=>{v.gestureSwitchChapter.getValue()&&(e===u.SwipeDirection.TO_RIGHT?S():e===u.SwipeDirection.TO_LEFT&&R())}),h.arrowKeyPressEvent.on(e=>{e===h.ArrowKey.LEFT?S():e===h.ArrowKey.RIGHT&&R()}),h.escapeKeyPressEvent.on(()=>{T(),d.updateHistory(!0)}),function(e){e[e.COMPILE=0]="COMPILE",e[e.RUNTIME=1]="RUNTIME",e[e.INTERNAL=2]="INTERNAL"}(k||(k={})),n.loadChapter=x},{"../wtcd/FlowReader":34,"../wtcd/WTCDError":37,"./DOM":4,"./DebugLogger":5,"./Event":6,"./RectMode":9,"./commentsControl":17,"./data":18,"./gestures":21,"./history":22,"./keyboard":24,"./loadingText":25,"./messages":26,"./processElements":27,"./settings":28,"./state":30}],16:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./Event"),o=new Set(JSON.parse(window.localStorage.getItem("blockedUsers")||"[]"));function a(){window.localStorage.setItem("blockedUsers",JSON.stringify(Array.from(o))),n.blockedUserUpdateEvent.emit()}n.blockedUserUpdateEvent=new r.Event,n.blockUser=function(e){o.add(e),a()},n.unblockUser=function(e){o.delete(e),a()},n.isUserBlocked=function(e){return o.has(e)},n.getBlockedUsers=function(){return Array.from(o)}},{"./Event":6}],17:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./commentBlockControl"),o=e("./DOM"),a=e("./formatTime"),s=e("./messages"),i=e("./settings"),c=o.id("comments"),l=o.id("comments-status"),u=o.id("create-comment"),d=/^https:\/\/github\.com\/([a-zA-Z0-9-_]+)\/([a-zA-Z0-9-_]+)\/issues\/([1-9][0-9]*)$/;let h=1,p=0,g="";u.addEventListener("click",()=>{window.open(g,"_blank")}),n.hideComments=function(){c.classList.toggle("display-none",!0),p=0},n.loadComments=function(e){if(!1===i.useComments.getValue())return;if(Array.from(c.getElementsByClassName("comment")).forEach(e=>e.remove()),c.classList.toggle("display-none",!1),u.classList.toggle("display-none",!0),null===e)return void(l.innerText=s.COMMENTS_UNAVAILABLE);g=e;const t=p=h++,n=function(e){const t=d.exec(e);if(null===t)throw new Error(`Bad issue url: ${e}.`);return`https://api.github.com/repos/${t[1]}/${t[2]}/issues/${t[3]}/comments`}(e);l.innerText=s.COMMENTS_LOADING,fetch(n).then(e=>e.json()).then(e=>{t===p&&(l.innerText=s.COMMENTS_LOADED,e.forEach(e=>{r.isUserBlocked(e.user.login)||c.appendChild(function(e,t,n,o,s,i){const c=document.createElement("div");c.classList.add("comment");const l=document.createElement("img");l.classList.add("avatar"),l.src=e,c.appendChild(l);const u=document.createElement("a");u.classList.add("author"),u.innerText=t,u.target="_blank",u.href=n,c.appendChild(u);const d=document.createElement("div");d.classList.add("time"),d.innerText=o===s?a.formatTime(new Date(o)):`${a.formatTime(new Date(o))}（最后修改于 ${a.formatTime(new Date(s))}）`,c.appendChild(d);const h=document.createElement("a");return h.classList.add("block-user"),h.innerText="屏蔽此人",h.onclick=()=>{r.blockUser(t),c.remove()},c.appendChild(h),i.split("\n\n").forEach(e=>{const t=document.createElement("p");t.innerText=e,c.appendChild(t)}),c}(e.user.avatar_url,e.user.login,e.user.html_url,e.created_at,e.updated_at,e.body))}),u.classList.toggle("display-none",!1))}).catch(e=>{l.innerText=s.COMMENTS_FAILED})}},{"./DOM":4,"./commentBlockControl":16,"./formatTime":20,"./messages":26,"./settings":28}],18:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.data=window.DATA,n.relativePathLookUpMap=new Map,function e(t){t.subFolders.forEach(t=>{e(t)}),t.chapters.forEach((e,r)=>{n.relativePathLookUpMap.set(e.htmlRelativePath,{folder:t,chapter:e,inFolderIndex:r})})}(n.data.chapterTree)},{}],19:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./chapterControl"),o=e("./data"),a=e("./history"),s=e("./state");n.followQuery=function(){const e=decodeURIComponent(window.location.hash.substr(1)),t=o.relativePathLookUpMap.get(e);if(void 0===t)null!==s.state.currentChapter&&(r.closeChapter(),document.title=a.getTitle());else if(s.state.currentChapter!==t)if("function"!=typeof URLSearchParams)r.loadChapter(e);else{const t=new URLSearchParams(window.location.search).get("selection"),n=null!==t?t.split(",").map(e=>+e):[];4===n.length&&n.every(e=>e>=0&&e%1==0&&!Number.isNaN(e)&&Number.isFinite(e))?r.loadChapter(e,n):r.loadChapter(e),document.title=a.getTitle()}a.updateHistory(!1)}},{"./chapterControl":15,"./data":18,"./history":22,"./state":30}],20:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=1e3,o=60*r,a=60*o,s=24*a,i=7*s;n.formatTime=function(e){const t=Date.now()-e.getTime();return t>i?`${e.getFullYear()}/${e.getMonth()+1}/${e.getDate()}`:t>s?`${Math.floor(t/s)} 天前`:t>a?`${Math.floor(t/a)} 小时前`:t>o?`${Math.floor(t/o)} 分钟前`:`${Math.floor(t/r)} 秒前`}},{}],21:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./DebugLogger"),o=e("./DOM"),a=e("./Event");var s;!function(e){e[e.TO_TOP=0]="TO_TOP",e[e.TO_RIGHT=1]="TO_RIGHT",e[e.TO_BOTTOM=2]="TO_BOTTOM",e[e.TO_LEFT=3]="TO_LEFT"}(s=n.SwipeDirection||(n.SwipeDirection={}));n.swipeEvent=new a.Event;let i=0,c=0,l=0,u=null;window.addEventListener("touchstart",e=>{1===e.touches.length&&(u=e.target,i=e.touches[0].clientX,c=e.touches[0].clientY,l=Date.now())}),window.addEventListener("touchend",e=>{if(0!==e.touches.length)return;if(Date.now()-l>500)return;if(window.innerWidth>900)return;const t=e.changedTouches[0].clientX-i,r=e.changedTouches[0].clientY-c,a=Math.abs(t/window.innerWidth),d=Math.abs(r/window.innerHeight);if(a>.17&&d<.1){if(o.isAnyParent(u,e=>"hidden"!==window.getComputedStyle(e).getPropertyValue("overflow-x")&&e.scrollWidth>e.clientWidth))return;t>0?n.swipeEvent.emit(s.TO_RIGHT):n.swipeEvent.emit(s.TO_LEFT)}else if(d>.1&&a<.1){if(o.isAnyParent(u,e=>"hidden"!==window.getComputedStyle(e).getPropertyValue("overflow-y")&&e.scrollHeight>e.clientHeight))return;r>0?n.swipeEvent.emit(s.TO_BOTTOM):n.swipeEvent.emit(s.TO_TOP)}});const d=new r.DebugLogger("swipeEvent");n.swipeEvent.on(e=>{d.log(s[e])})},{"./DOM":4,"./DebugLogger":5,"./Event":6}],22:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./state");function o(){let e="可穿戴科技";return null!==r.state.currentChapter&&(e+=" - "+r.state.currentChapter.chapter.displayName),e}n.getTitle=o,n.updateHistory=function(e){const t=e?window.history.pushState:window.history.replaceState;let n=window.location.pathname;null!==r.state.currentChapter&&(null!==r.state.chapterSelection&&(n+=`?selection=${r.state.chapterSelection.join(",")}`),n+="#"+r.state.currentChapter.chapter.htmlRelativePath);const a=o();document.title=a,t.call(window.history,null,a,n)}},{"./state":30}],23:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./data"),o=e("./DOM"),a=e("./followQuery"),s=e("./MainMenu"),i=e("./settings"),c=e("./updateSelection"),l=o.id("warning");null!==l&&l.addEventListener("click",()=>{l.style.opacity="0",i.animation.getValue()?l.addEventListener("transitionend",()=>{l.remove()}):l.remove()}),o.id("build-number").innerText=`Build ${r.data.buildNumber}`,(new s.MainMenu).setActive(!0),document.addEventListener("selectionchange",()=>{c.updateSelection()}),window.addEventListener("popstate",()=>{a.followQuery()}),a.followQuery()},{"./DOM":4,"./MainMenu":7,"./data":18,"./followQuery":19,"./settings":28,"./updateSelection":33}],24:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./DebugLogger"),o=e("./Event");var a;!function(e){e[e.LEFT=0]="LEFT",e[e.UP=1]="UP",e[e.RIGHT=2]="RIGHT",e[e.DOWN=3]="DOWN"}(a=n.ArrowKey||(n.ArrowKey={})),n.arrowKeyPressEvent=new o.Event,n.escapeKeyPressEvent=new o.Event,document.addEventListener("keyup",e=>{switch(e.keyCode){case 27:n.escapeKeyPressEvent.emit();break;case 37:n.arrowKeyPressEvent.emit(a.LEFT);break;case 38:n.arrowKeyPressEvent.emit(a.UP);break;case 39:n.arrowKeyPressEvent.emit(a.RIGHT);break;case 40:n.arrowKeyPressEvent.emit(a.DOWN)}});const s=new r.DebugLogger("arrowKeyEvent");n.arrowKeyPressEvent.on(e=>{s.log(a[e])})},{"./DebugLogger":5,"./Event":6}],25:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.loadingText="加载中..."},{}],26:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.COMMENTS_UNAVAILABLE="本文评论不可用。",n.COMMENTS_LOADING="评论加载中...",n.COMMENTS_LOADED="以下为本章节的评论区。",n.COMMENTS_FAILED="评论加载失败。",n.NO_BLOCKED_USERS="没有用户的评论被屏蔽",n.CLICK_TO_UNBLOCK="(点击用户名以解除屏蔽)",n.WTCD_ERROR_COMPILE_TITLE="WTCD 编译失败",n.WTCD_ERROR_COMPILE_DESC="该 WTCD 文档在编译时发生了错误。请检查是否有语法错误或是其他基本错误。",n.WTCD_ERROR_RUNTIME_TITLE="WTCD 运行时错误",n.WTCD_ERROR_RUNTIME_DESC="该 WTCD 文档在运行时发生了错误。请检查是否有逻辑错误。",n.WTCD_ERROR_INTERNAL_TITLE="WTCD 内部错误",n.WTCD_ERROR_INTERNAL_DESC="WTCD 解释器在解释执行该 WTCD 文档时崩溃了。请务必告诉琳你做了什么好让她来修。",n.WTCD_ERROR_MESSAGE="错误信息：",n.WTCD_ERROR_WTCD_STACK_TITLE="WTCD 调用栈",n.WTCD_ERROR_WTCD_STACK_DESC="WTCD 调用栈记录了在错误发生时 WTCD 的解释器状态。这可以帮助理解错误发生的上下文。",n.WTCD_ERROR_INTERNAL_STACK_TITLE="内部调用栈",n.WTCD_ERROR_INTERNAL_STACK_DESC="内部调用栈记录了出现该错误时编译器或是解释器的状态。请注意内部调用栈通常只在调试 WTCD 编译器或是解释器时有用。内部调用栈通常对调试 WTCD 文档没有作用。"},{}],27:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./DOM");n.processElements=function(e){Array.from(e.getElementsByTagName("a")).forEach(e=>e.target="_blank"),Array.from(e.getElementsByTagName("code")).forEach(e=>e.addEventListener("dblclick",()=>{e.parentNode instanceof HTMLPreElement||r.selectNode(e)})),Array.from(e.getElementsByTagName("img")).forEach(e=>{const t=e.src,n=t.lastIndexOf("."),r=t.substr(0,n);if(r.endsWith("_low")){const o=t.substr(n+1),a=r.substr(0,r.length-4);e.style.cursor="zoom-in",e.addEventListener("click",()=>window.open(a+"."+o))}})}},{"./DOM":4}],28:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=()=>{};class o{constructor(e,t,n=r){this.key=e,this.onUpdate=n,this.value=t?"false"!==window.localStorage.getItem(e):"true"===window.localStorage.getItem(e),this.updateLocalStorage(),this.onUpdate(this.value)}updateLocalStorage(){window.localStorage.setItem(this.key,String(this.value))}getValue(){return this.value}setValue(e){e!==this.value&&this.onUpdate(e),this.value=e,this.updateLocalStorage()}toggle(){this.setValue(!this.value)}}n.BooleanSetting=o;class a{constructor(e,t,n,o=r){if(this.key=e,this.options=t,this.defaultValue=n,this.onUpdate=o,!this.isCorrectValue(n))throw new Error(`Default value ${n} is not correct.`);this.value=+(window.localStorage.getItem(e)||n),this.correctValue(),this.onUpdate(this.value,this.options[this.value])}isCorrectValue(e){return!(Number.isNaN(e)||e%1!=0||e<0||e>=this.options.length)}correctValue(){this.isCorrectValue(this.value)||(this.value=this.defaultValue)}updateLocalStorage(){window.localStorage.setItem(this.key,String(this.value))}getValue(){return this.value}getValueName(){return this.options[this.value]}setValue(e){e!==this.value&&this.onUpdate(e,this.options[e]),this.value=e,this.updateLocalStorage()}}n.EnumSetting=a,n.animation=new o("animation",!0,e=>{setTimeout(()=>{document.body.classList.toggle("animation-enabled",e)},1)}),n.warning=new o("warning",!1),n.earlyAccess=new o("earlyAccess",!1,e=>{document.body.classList.toggle("early-access-disabled",!e)}),n.useComments=new o("useComments",!0),n.gestureSwitchChapter=new o("gestureSwitchChapter",!0);const s=['-apple-system, "Noto Sans", "Helvetica Neue", Helvetica, "Nimbus Sans L", Arial, "Liberation Sans", "PingFang SC", "Hiragino Sans GB", "Noto Sans CJK SC", "Source Han Sans SC", "Source Han Sans CN", "Microsoft YaHei", "Wenquanyi Micro Hei", "WenQuanYi Zen Hei", "ST Heiti", SimHei, "WenQuanYi Zen Hei Sharp", sans-serif','Baskerville, Georgia, "Liberation Serif", "Kaiti SC", STKaiti, "AR PL UKai CN", "AR PL UKai HK", "AR PL UKai TW", "AR PL UKai TW MBE", "AR PL KaitiM GB", KaiTi, KaiTi_GB2312, DFKai-SB, "TW-Kai", serif','Georgia, "Nimbus Roman No9 L", "Songti SC", "Noto Serif CJK SC", "Source Han Serif SC", "Source Han Serif CN", STSong, "AR PL New Sung", "AR PL SungtiL GB", NSimSun, SimSun, "TW-Sung", "WenQuanYi Bitmap Song", "AR PL UMing CN", "AR PL UMing HK", "AR PL UMing TW", "AR PL UMing TW MBE", PMingLiU, MingLiU, serif','Baskerville, "Times New Roman", "Liberation Serif", STFangsong, FangSong, FangSong_GB2312, "CWTEX-F", serif'];n.fontFamily=new a("fontFamily",["黑体","楷体","宋体","仿宋"],0,e=>{document.documentElement.style.setProperty("--font-family",s[e]),document.documentElement.style.setProperty("--font-family-mono",'"Fira Code", '+s[e])}),n.developerMode=new o("developerMode",!1),n.charCount=new o("charCount",!0,e=>{document.body.classList.toggle("char-count-disabled",!e)})},{}],29:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.shortNumber=function(e){return e<1e3?String(e):e<1e6?(e/1e3).toFixed(1)+"k":(e/1e6).toFixed(1)+"M"}},{}],30:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.state={currentChapter:null,chapterSelection:null,chapterTextNodes:null}},{}],31:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.stylePreviewArticle="<h1>午饭</h1>\n<p><em>作者：友人♪B</em></p>\n<p>“午饭，午饭♪”</p>\n<p>阳伞下的琳，很是期待今天的午饭。</p>\n<p>或许是体质和别的血族不太一样，琳能够感知到食物的味道，似乎也保有着生物对食物的喜爱。</p>\n<p>虽然她并不能从这些食物中获取能量就是。</p>\n<p>学校食堂的夏季限定甜点今天也很是抢手，这点从队伍的长度就能看出来——队伍险些就要超出食堂的范围了。</p>\n<p>“你说我要有钱多好——”</p>\n<p>已经从隔壁窗口买下了普通，但是很便宜的营养餐的秋镜悬，看着队伍中兴致勃勃的琳。</p>\n<p>其实她并不是缺钱，大约是吝啬。</p>\n<p>这得怪她娘，穷养秋镜悬养习惯了，现在她光自己除灵退魔挣来的外快都够她奢侈上一把了，可却还保留着能不花钱绝对不花，必须花钱越少越好的吝啬习惯。</p>\n<p>少顷，琳已经带着她的甜品建筑——每块砖头都是一块蛋糕，堆成一个诡异的火柴盒——来到了桌前。</p>\n<p>“（吃不胖真好，有钱真好……”</p>\n<p>血族的听觉自然是捕捉到了秋镜悬的嘀咕，琳放下盘子，悄咪咪地将牙贴上了秋镜悬的脖颈。</p>\n<p>“嘻嘻♪”</p>\n<p>“呜——”</p>\n<p>盯——</p>\n<p>秋镜悬看了看盘中剩下的一块毛血旺，似是联系到了什么，将目光转向了琳的牙。</p>\n<p>正在享用蛋糕盛宴的琳以余光瞥见了她的视线，</p>\n<p>“盯着本小姐是要做什么呢？”</p>\n<p>“啊，没，没什么……”</p>\n<p>秋镜悬支支吾吾的说着，</p>\n<p>“就是好奇一个问题，血族为什么不吃毛血旺……”</p>\n<p>“噢☆毛血旺就是那个煮熟的血块是吧？太没有美感了这种血！而且吃了也没法儿恢复能量，简直就是血液的绝佳浪费☆！”</p>\n<p>琳发出了对这样美食的鄙视，不过这种鄙视大约只有血族和蚊子会出现吧……</p>\n<p>“血族需要摄入血，是因为血所具有的生命能量，如果煮熟了的话，超过九成的能量都被转化成其他的东西了，对我们来说实在是没什么用处，还白白浪费了作为原料的血，这种东西本小姐才不吃咧✘！饿死，死外边，从这边跳下去也不吃✘！”</p>\n<p>“欸，别这么说嘛，你能尝得到味道的吧，吃一块试试呗？”</p>\n<p>“真……真香♪”</p>\n<p>当晚，因为触发了真香定律而感到很火大的琳，把秋镜悬丢进了自己的高维空间里头放置了一晚上（高维时间三天）泄愤。</p>"},{}],32:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.thanks=[{name:"神楽坂 立音"},{name:"lgd_小翅膀"},{name:"青葉"},{name:"kn"},{name:"F74nk",link:"https://t.me/F74nk_K"},{name:"杨佳文"},{name:"不知名的N姓人士就好"},{name:"某不愿透露姓名的N性？"},{name:"神楽坂 萌绫"},{name:"Butby"},{name:"友人♪B"},{name:"NekoCaffeine"},{name:"RainSlide"},{name:"czp",link:"https://www.hiczp.com"},{name:"kookxiang"},{name:"櫻川 紗良"},{name:"Skimige"},{name:"TExL",link:"http://texas.penguin-logistics.cn"},{name:"路人乙"},{name:"pokemonchw",link:"https://github.com/pokemonchw"},{name:"帕蒂卡",link:"https://github.com/Patika-ailemait"},{name:"零件",link:"https://nekosc.com"},{name:"幻梦",link:"https://t.me/HuanmengQwQ"},{name:"acted咕咕喵",link:"https://acted.gitlab.io"},{name:"重水时雨",link:"https://t.me/boatmasteronD2O"},{name:"神楽坂 紫"},{name:"Runian Lee",link:"https://t.me/Runian"}].sort(()=>Math.random()-.5)},{}],33:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./history"),o=e("./state");n.updateSelection=function(){if(null===o.state.chapterTextNodes)return;const e=String(o.state.chapterSelection),t=document.getSelection();if(null===t)o.state.chapterSelection=null;else{const e=t.anchorNode instanceof HTMLElement?t.anchorNode.firstChild:t.anchorNode,n=o.state.chapterTextNodes.indexOf(e),r=t.focusNode instanceof HTMLElement?t.focusNode.firstChild:t.focusNode,a=o.state.chapterTextNodes.indexOf(r);-1===n||-1===a||n===a&&t.anchorOffset===t.focusOffset?o.state.chapterSelection=null:n<a||n===a&&t.anchorOffset<t.focusOffset?o.state.chapterSelection=[n,t.anchorOffset,a,t.focusOffset]:o.state.chapterSelection=[a,t.focusOffset,n,t.anchorOffset]}e!==String(o.state.chapterSelection)&&r.updateHistory(!1)}},{"./history":22,"./state":30}],34:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./Interpreter"),o=e("./Random");n.FlowReader=class{constructor(e,t,n,r){this.wtcdRoot=t,this.errorMessageCreator=n,this.elementPreprocessor=r,this.currentDecisionIndex=0,this.buttons=[],this.contents=[],this.started=!1,this.storageKey=`wtcd.fr.${e}`,this.data=this.parseData(window.localStorage.getItem(this.storageKey))||{random:String(Math.random()),decisions:[]},this.resetInterpreter()}parseData(e){if("string"!=typeof e)return null;let t;try{t=JSON.parse(e)}catch(e){return null}return"string"!=typeof t.random?null:Array.isArray(t.decisions)?t.decisions.some(e=>"number"!=typeof e)?null:t:null}persist(){window.localStorage.setItem(this.storageKey,JSON.stringify(this.data))}next(e){try{return this.interpreterIterator.next(e)}catch(e){const t=this.errorMessageCreator(e);return this.target.appendChild(t),this.contents.push(t),{done:!0,value:{choices:[],content:[]}}}}resetInterpreter(){const e=new r.Interpreter(this.wtcdRoot,new o.Random(this.data.random));this.interpreterIterator=e.start()}decide(e,t=!1){this.buttons[this.currentDecisionIndex].forEach((t,n)=>{t.classList.contains("disabled")||(t.classList.remove("candidate"),n===e?t.classList.add("selected"):t.classList.add("unselected"))}),t||this.data.decisions.push(e),this.currentDecisionIndex++;const n=this.next(e);return this.handleOutput(n.value),n.done}undecide(e){this.resetInterpreter(),this.data.decisions.splice(e),this.buttons.splice(e+1),this.contents.splice(e+1).forEach(e=>e.remove()),this.next();for(const e of this.data.decisions)this.next(e);this.buttons[e].forEach(e=>{e.classList.contains("disabled")||(e.classList.remove("selected","unselected"),e.classList.add("candidate"))}),this.currentDecisionIndex=e}handleOutput(e){const t=document.createElement("div");t.classList.add("wtcd-group-container"),e.content.forEach(e=>t.appendChild(e));const n=this.currentDecisionIndex;this.buttons.push(e.choices.map((e,r)=>{const o=document.createElement("div");return o.classList.add("wtcd-button"),o.innerText=e.content,e.disabled?o.classList.add("disabled"):(o.classList.add("candidate"),o.addEventListener("click",()=>{this.data.decisions[n]===r?(this.undecide(n),this.persist()):this.currentDecisionIndex===n&&(this.decide(r),this.persist())})),t.appendChild(o),o})),this.contents.push(t),this.target.appendChild(t),this.elementPreprocessor(t)}renderTo(e){if(this.started)throw new Error("Flow Interface already started.");this.started=!0,this.target=e;const t=this.next();let n=t.done;this.handleOutput(t.value);for(const e of this.data.decisions){if(n)return;n=this.decide(e,!0)}}}},{"./Interpreter":35,"./Random":36}],35:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./constantsPool"),o=e("./operators"),a=e("./std"),s=e("./utils"),i=e("./WTCDError");function c(e,t){if(e.type!==t.type)return!1;switch(e.type){case"null":return!0;case"number":case"boolean":case"string":return e.value===t.value;case"action":if(e.value.action!==t.value.action)return!1;switch(e.value.action){case"exit":return!0;case"goto":return s.arrayEquals(e.value.target,t.value.target);case"selection":return e.value.choices.length===t.value.choices.length&&e.value.choices.every((e,n)=>c(e,t.value.choices[n]))}throw new Error("Shouldn't fall through.");case"choice":return e.value.text===t.value.text&&c(e.value.action,t.value.action);case"function":return e.value.builtIn===t.value.builtIn&&(!0===e.value.builtIn?e.value.nativeFn===t.value.nativeFn:e.value.expr===t.value.expr&&e.value.captured.every((e,n)=>{const r=t.value.captured[n];return e.name===r.name&&e.value===r.value}));case"list":return e.value.length===t.value.length&&e.value.every((e,n)=>c(e,t.value[n]))}}var l;n.isEqual=c,function(e){e[e.YIELD=0]="YIELD",e[e.RETURN=1]="RETURN"}(l=n.BubbleSignalType||(n.BubbleSignalType={}));class u extends Error{constructor(e){super("Uncaught Bubble Signal."),this.type=e,Object.setPrototypeOf(this,new.target.prototype)}}function d(e){switch(e.type){case"number":case"boolean":return`${e.type} (value = ${e.value})`;case"string":return`string (value = "${e.value}")`;case"choice":return`choice (action = ${d(e.value.action)}, label = `+`"${e.value.text}")`;case"action":switch(e.value.action){case"goto":return`action (type = goto, target = ${e.value.target})`;case"exit":return"action (type = exit)";case"selection":return`action (type = selection, choices = [${e.value.choices.map(d).join(", ")}])`}case"null":return"null";case"list":return`list (elements = [${e.value.map(d).join(", ")}])`;case"function":return e.value.builtIn?`function (native ${e.value.nativeFn.name})`:`function (arguments = [${e.value.expr.arguments.map(e=>e.name).join(", ")}])`}}n.BubbleSignal=u,n.describe=d;class h{constructor(){this.variables=new Map,this.registers=null}resolveVariableReference(e){return this.variables.get(e)||null}addVariable(e,t){this.variables.set(e,t)}addRegister(e){null===this.registers&&(this.registers=new Map),this.registers.set(e,r.getMaybePooled("null",null))}setRegisterIfExist(e,t){return null!==this.registers&&(!!this.registers.has(e)&&(this.registers.set(e,t),!0))}getRegister(e){return this.registers&&this.registers.get(e)||null}}class p extends Error{constructor(e){super(`Invalid choice ${e}.`),this.choiceId=e}}n.InvalidChoiceError=p;n.Interpreter=class{constructor(e,t){this.wtcdRoot=e,this.random=t,this.timers=new Map,this.interpreterHandle={evaluator:this.evaluator.bind(this),pushScope:this.pushScope.bind(this),popScope:this.popScope.bind(this),resolveVariableReference:this.resolveVariableReference.bind(this),getRandom:()=>this.random,pushContent:this.pushContent.bind(this),timers:this.timers},this.scopes=[],this.sectionStack=[],this.started=!1,this.sectionEnterTimes=new Map,this.currentlyBuilding=[],this.sectionStack.push(this.wtcdRoot.sections[0])}resolveVariableReference(e){for(let t=this.scopes.length-1;t>=0;t--){const n=this.scopes[t].resolveVariableReference(e);if(null!==n)return n}throw i.WTCDError.atUnknown(`Cannot resolve variable reference "${e}". `+"This is most likely caused by WTCD compiler's error or the compiled output has been modified")}setRegister(e,t){for(let n=this.scopes.length-1;n>=0;n--)if(this.scopes[n].setRegisterIfExist(e,t))return;throw i.WTCDError.atUnknown(`Cannot resolve register reference "${e}". `+"This is mostly likely caused by WTCD compiler's error or the compiled output has been modified")}getCurrentScope(){return this.scopes[this.scopes.length-1]}pushScope(){const e=new h;return this.scopes.push(e),e}popScope(){return this.scopes.pop()}evaluateChoiceExpression(e){const t=this.evaluator(e.text);if("string"!==t.type)throw i.WTCDError.atLocation(e,"First argument of choice is expected to be a string, "+`received: ${d(t)}`);const n=this.evaluator(e.action);if("action"!==n.type&&"null"!==n.type)throw i.WTCDError.atLocation(e,"Second argument of choice is expected to be an action "+`or null, received: ${d(t)}`);return{type:"choice",value:{text:t.value,action:n}}}evaluateConditionalExpression(e){const t=this.evaluator(e.condition);if("boolean"!==t.type)throw i.WTCDError.atLocation(e,"First argument of a conditional expression is expected to "+`be a boolean, received: ${d(t)}`);return t.value?this.evaluator(e.then):this.evaluator(e.otherwise)}executeDeclarationStatement(e){for(const t of e.declarations){let n;if(null!==t.initialValue)n=this.evaluator(t.initialValue);else switch(t.variableType){case"boolean":n=r.getMaybePooled("boolean",!1);break;case"number":n=r.getMaybePooled("number",0);break;case"string":n=r.getMaybePooled("string","");break;case"list":n={type:"list",value:[]};break;default:throw i.WTCDError.atLocation(e,`Variable type ${t.variableType} `+"does not have a default initial value")}if(n.type!==t.variableType)throw i.WTCDError.atLocation(e,`The type of variable ${t.variableName} is `+`${t.variableType}, thus cannot hold ${d(n)}`);this.getCurrentScope().addVariable(t.variableName,{type:t.variableType,value:n.value})}}evaluateBlockExpression(e){const t=this.pushScope();try{t.addRegister("yield");for(const t of e.statements)this.executeStatement(t);return t.getRegister("yield")}catch(e){if(e instanceof u&&e.type===l.YIELD)return t.getRegister("yield");throw e}finally{this.popScope()}}evaluateSelectionExpression(e){const t=this.evaluator(e.choices);if("list"!==t.type)throw i.WTCDError.atLocation(e,"Expression after selection is expected to be a list of choices, received: "+`${d(t)}`);const n=t.value.filter(e=>"null"!==e.type);for(let t=0;t<n.length;t++)if("choice"!==n[t].type)throw i.WTCDError.atLocation(e,`Choice at index ${t} is expected `+`to be a choice, received: ${d(n[t])}`);return{type:"action",value:{action:"selection",choices:n}}}evaluateListExpression(e){return{type:"list",value:s.flat(e.elements.map(e=>{if("spread"!==e.type)return this.evaluator(e);const t=this.evaluator(e.expression);if("list"!==t.type)throw i.WTCDError.atLocation(e,'Spread operator "..." can only '+`be used before a list, received: ${d(t)}`);return t.value}))}}evaluateFunctionExpression(e){return{type:"function",value:{builtIn:!1,expr:e,captured:e.captures.map(e=>({name:e,value:this.resolveVariableReference(e)}))}}}evaluateSwitchExpression(e){const t=this.evaluator(e.expression);for(const n of e.cases){const e=this.evaluator(n.matches);if("list"!==e.type)throw i.WTCDError.atLocation(n.matches,"Value to match for each case is expected to be a list, received: "+`${d(e)}`);if(e.value.some(e=>c(e,t)))return this.evaluator(n.returns)}if(null===e.defaultCase)throw i.WTCDError.atLocation(e,"None of the cases matched and no default case is provided");return this.evaluator(e.defaultCase)}evaluator(e){switch(e.type){case"unaryExpression":return o.unaryOperators.get(e.operator).fn(e,this.interpreterHandle);case"binaryExpression":return o.binaryOperators.get(e.operator).fn(e,this.interpreterHandle);case"booleanLiteral":return r.getMaybePooled("boolean",e.value);case"numberLiteral":return r.getMaybePooled("number",e.value);case"stringLiteral":return r.getMaybePooled("string",e.value);case"nullLiteral":return r.getMaybePooled("null",null);case"list":return this.evaluateListExpression(e);case"choiceExpression":return this.evaluateChoiceExpression(e);case"conditionalExpression":return this.evaluateConditionalExpression(e);case"block":return this.evaluateBlockExpression(e);case"gotoAction":return{type:"action",value:{action:"goto",target:e.sections}};case"exitAction":return{type:"action",value:{action:"exit"}};case"selection":return this.evaluateSelectionExpression(e);case"variableReference":return r.clone(this.resolveVariableReference(e.variableName));case"function":return this.evaluateFunctionExpression(e);case"switch":return this.evaluateSwitchExpression(e)}}executeStatement(e){switch(e.type){case"declaration":return void this.executeDeclarationStatement(e);case"expression":return void this.evaluator(e.expression);case"yield":throw this.setRegister("yield",this.evaluator(e.value)),new u(l.YIELD);case"setYield":return void this.setRegister("yield",this.evaluator(e.value));case"return":throw this.setRegister("return",this.evaluator(e.value)),new u(l.RETURN);case"setReturn":return void this.setRegister("return",this.evaluator(e.value));default:throw i.WTCDError.atLocation(e,"Not implemented")}}addToSectionStack(e){for(const t of this.wtcdRoot.sections)if(t.name===e)return void this.sectionStack.push(t);throw i.WTCDError.atUnknown(`Unknown section "${e}"`)}*executeAction(e){switch(e.value.action){case"goto":for(let t=e.value.target.length-1;t>=0;t--)this.addToSectionStack(e.value.target[t]);break;case"exit":this.sectionStack.length=0;break;case"selection":{const t=e.value.choices,n=t.map(e=>({content:e.value.text,disabled:"null"===e.value.action.type})),r={content:this.currentlyBuilding,choices:n};this.currentlyBuilding=[];const o=yield r,a=t[o];if(void 0===a||"null"===a.value.action.type)throw new p(o);yield*this.executeAction(a.value.action);break}}}pushContent(e){this.currentlyBuilding.push(e)}*start(){const e=this.pushScope();for(const t of a.stdFunctions)e.addVariable(t.name,{type:"function",value:{builtIn:!0,nativeFn:t}});if(this.pushScope(),this.started)throw new Error("Interpretation has already started.");this.started=!0;let t=null;try{for(const e of this.wtcdRoot.initStatements)this.executeStatement(e);const e=document.createElement("div");for(;0!==this.sectionStack.length;){const n=this.sectionStack.pop();t=n,null!==n.executes&&this.evaluator(n.executes);const r=this.sectionEnterTimes.has(n.name)?this.sectionEnterTimes.get(n.name)+1:1;this.sectionEnterTimes.set(n.name,r);const o=n.content.filter(e=>(void 0===e.lowerBound||e.lowerBound<=r)&&(void 0===e.upperBound||e.upperBound>=r));if(0!==o.length){const t=o[this.random.nextInt(0,o.length)];e.innerHTML=t.html;for(const n of t.variables)e.getElementsByClassName(n.elementClass)[0].innerText=String(this.resolveVariableReference(n.variableName).value);let n=e.firstChild;for(;null!==n;)n instanceof HTMLElement&&this.pushContent(n),n=n.nextSibling}const a=this.evaluator(n.then);if("action"===a.type)yield*this.executeAction(a);else if("null"!==a.type)throw i.WTCDError.atLocation(n.then,"Expression after then is expected to return an action, or null, "+`received: ${d(a)}`)}}catch(e){if(e instanceof u)throw i.WTCDError.atUnknown(`Uncaught BubbleSignal with type "${e.type}".`);throw e instanceof i.WTCDError&&(null===t?e.pushWTCDStack("initialization"):e.pushWTCDStack(`section "${t.name}"`,t)),e}return{content:this.currentlyBuilding,choices:[]}}}},{"./WTCDError":37,"./constantsPool":39,"./operators":41,"./std":44,"./utils":50}],36:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.Random=class{constructor(e){const t=function(e){let t=1779033703^e.length;for(let n=0;n<e.length;n++)t=(t=Math.imul(t^e.charCodeAt(n),3432918353))<<13|t>>>19;return()=>(t=Math.imul(t^t>>>16,2246822507),t=Math.imul(t^t>>>13,3266489909),(t^=t>>>16)>>>0)}(e);var n,r,o,a;this.rng=(n=t(),r=t(),o=t(),a=t(),()=>{let e=(n>>>=0)+(r>>>=0)|0;return n=r^r>>>9,r=(o>>>=0)+(o<<3)|0,o=(o=o<<21|o>>>11)+(e=e+(a=1+(a>>>=0)|0)|0)|0,(e>>>0)/4294967296})}next(e=0,t=1){return this.rng()*(t-e)+e}nextBool(){return this.rng()<.5}nextInt(e,t){return Math.floor(this.next(e,t))}}},{}],37:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r={};class o extends Error{constructor(e,t,n){super(e),this.line=t,this.column=n,this.wtcdStackArray=[],this.name="WTCDError"}get wtcdStack(){return this.message+"\n"+this.wtcdStackArray.join("\n")}pushWTCDStack(e,t=r){this.wtcdStackArray.push(`    at ${e}`+(t.line?":"+t.line+(t.column?":"+t.column:""):""))}static atUnknown(e){return new o(e+" at unknown location. (Location NaN",null,null)}static atLineColumn(e,t,n){return new o(n+` at ${e}:${t}.`,e,t)}static atLocation(e,t){return void 0===e.line?new o(t+" at unknown location. (Try recompile in debug mode to enable source map)",null,null):o.atLineColumn(e.line,e.column,t)}}n.WTCDError=o},{}],38:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.autoEvaluated=function(e){return(t,n)=>{const r=n.evaluator(t.arg0),o=n.evaluator(t.arg1);return e(r,o,t,n)}}},{}],39:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.nullValue={type:"null",value:null},n.trueValue={type:"boolean",value:!0},n.falseValue={type:"boolean",value:!1},n.smallIntegers=[];for(let e=0;e<=100;e++)n.smallIntegers.push({type:"number",value:e});function r(e){return e?n.trueValue:n.falseValue}function o(e,t){return"null"===e?n.nullValue:"boolean"===e?r(t):"number"===e&&t>=0&&t<=100&&t%1==0?n.smallIntegers[t]:{type:e,value:t}}n.booleanValue=r,n.getMaybePooled=o,n.clone=function(e){return o(e.type,e.value)}},{}],40:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./autoEvaluated"),o=e("./Interpreter"),a=e("./std/utils"),s=e("./WTCDError");class i extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}function c(e,t,n){const{evaluator:r,pushScope:s,popScope:c}=n;if(e.builtIn)try{return e.nativeFn(t,n)}catch(t){throw t instanceof a.NativeFunctionError?new i("Failed to call native function "+`"${e.nativeFn.name}". Reason: ${t.message}`):t}const l=s();try{l.addRegister("return"),e.expr.arguments.forEach((e,n)=>{let a=t[n];if(void 0===a||"null"===a.type){if(null===e.defaultValue)throw new i(`The ${n+1}th argument of `+"invocation is omitted, but it does not have a default value");a=r(e.defaultValue)}if(a.type!==e.type)throw new i(`The ${n+1}th argument of `+`invocation has wrong type. Expected: ${e.type}, received: `+`${o.describe(a)}`);l.addVariable(e.name,{type:a.type,value:a.value})}),null!==e.expr.restArgName&&l.addVariable(e.expr.restArgName,{type:"list",value:t.slice(e.expr.arguments.length)}),e.captured.forEach(e=>{l.addVariable(e.name,e.value)});const n=r(e.expr.expression),a=l.getRegister("return");return"null"===a.type?n:a}catch(e){if(e instanceof o.BubbleSignal&&e.type===o.BubbleSignalType.RETURN)return l.getRegister("return");throw e}finally{c()}}function l(e,t){if(t instanceof i)throw s.WTCDError.atLocation(e,t.message);throw t instanceof s.WTCDError&&t.pushWTCDStack(`"${e.operator}" invocation`,e),t}n.FunctionInvocationError=i,n.invokeFunctionRaw=c,n.regularInvocation=r.autoEvaluated((e,t,n,r)=>{if("function"!==e.type)throw s.WTCDError.atLocation(n,'Left side of function invocation "::" '+`is expected to be a function, received: ${o.describe(e)}`);if("list"!==t.type)throw s.WTCDError.atLocation(n,'Right side of function invocation "::" '+`is expected to be a list, received: ${o.describe(t)}`);try{return c(e.value,t.value,r)}catch(e){return l(n,e)}}),n.pipelineInvocation=r.autoEvaluated((e,t,n,r)=>{if("function"!==t.type)throw s.WTCDError.atLocation(n,'Left side of pipeline invocation "|>" '+`is expected to be a function, received: ${o.describe(t)}`);try{return c(t.value,[e],r)}catch(e){return l(n,e)}}),n.reverseInvocation=r.autoEvaluated((e,t,n,r)=>{if("list"!==e.type)throw s.WTCDError.atLocation(n,'Left side of reverse invocation "|::" '+`is expected to be a list, received: ${o.describe(e)}`);if("function"!==t.type)throw s.WTCDError.atLocation(n,'Right side of reverse invocation "|::" '+`is expected to be a function, received: ${o.describe(t)}`);try{return c(t.value,e.value,r)}catch(e){return l(n,e)}})},{"./Interpreter":35,"./WTCDError":37,"./autoEvaluated":38,"./std/utils":49}],41:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./autoEvaluated"),o=e("./constantsPool"),a=e("./Interpreter"),s=e("./invokeFunction"),i=e("./WTCDError");function c(e,t,n){return r.autoEvaluated((r,s,c,l)=>{if(r.type===e&&s.type===e)return o.getMaybePooled(t,n(r.value,s.value,c,l));throw i.WTCDError.atLocation(c,`Binary operator "${c.operator}" can only be `+`applied to two ${e}s, received: ${a.describe(r)} (left) and `+`${a.describe(s)} (right)`)})}function l(e,t,n){return(r,s)=>{if("variableReference"!==r.arg0.type)throw i.WTCDError.atLocation(r,`Left side of binary operator "${r.operator}" `+"has to be a variable reference");const c=s.resolveVariableReference(r.arg0.variableName);if(c.type!==e)throw i.WTCDError.atLocation(r,`Left side of binary operator "${r.operator}" has to be a `+`variable of type ${e}, actual type: ${c.type}`);const l=s.evaluator(r.arg1);if(l.type!==t)throw i.WTCDError.atLocation(r,`Right side of binary operator "${r.operator}" `+` has to be a ${t}, received: ${a.describe(l)}`);const u=n(c.value,l.value,r,s);return c.value=u,o.getMaybePooled(e,u)}}n.unaryOperators=new Map([["-",{precedence:17,fn:(e,{evaluator:t})=>{const n=t(e.arg);if("number"!==n.type)throw i.WTCDError.atLocation(e,'Unary operator "-" can only be applied '+`to a number, received: ${a.describe(n)}`);return o.getMaybePooled("number",-n.value)}}],["!",{precedence:17,fn:(e,{evaluator:t})=>{const n=t(e.arg);if("boolean"!==n.type)throw i.WTCDError.atLocation(e,'Unary operator "!" can only be applied '+`to a boolean, received: ${a.describe(n)}`);return o.getMaybePooled("boolean",!n.value)}}]]),n.binaryOperators=new Map([["=",{precedence:3,fn:(e,{evaluator:t,resolveVariableReference:n})=>{if("variableReference"!==e.arg0.type)throw i.WTCDError.atLocation(e,'Left side of binary operator "=" has to be a variable reference');const r=n(e.arg0.variableName),o=t(e.arg1);if(o.type!==r.type)throw i.WTCDError.atLocation(e,`Variable "${e.arg0.variableName}" can only hold `+`values of type ${r.type}. Received ${a.describe(o)}`);return r.value=o.value,o}}],["+=",{precedence:3,fn:(e,{evaluator:t,resolveVariableReference:n})=>{if("variableReference"!==e.arg0.type)throw i.WTCDError.atLocation(e,'Left side of binary operator "+=" has to be a variable reference');const r=n(e.arg0.variableName);if("string"!==r.type&&"number"!==r.type)throw i.WTCDError.atLocation(e,'Left side of binary operator "+=" has to be a '+`variable of type number or string, actual type: ${r.type}`);const s=t(e.arg1);if(s.type!==r.type)throw i.WTCDError.atLocation(e,'Right side of binary operator "+=" has to '+` be a ${r.type}, received: ${a.describe(s)}`);const c=r.value+s.value;return r.value=c,o.getMaybePooled(r.type,c)}}],["-=",{precedence:3,fn:l("number","number",(e,t)=>e-t)}],["*=",{precedence:3,fn:l("number","number",(e,t)=>e*t)}],["/=",{precedence:3,fn:l("number","number",(e,t)=>e/t)}],["~/=",{precedence:3,fn:l("number","number",(e,t)=>Math.trunc(e/t))}],["%=",{precedence:3,fn:l("number","number",(e,t)=>e%t)}],["|>",{precedence:5,fn:s.pipelineInvocation}],["|::",{precedence:5,fn:s.reverseInvocation}],["||",{precedence:6,fn:(e,{evaluator:t})=>{const n=t(e.arg0);if("boolean"!==n.type)throw i.WTCDError.atLocation(e,'Left side of binary operator "||" has to be a boolean. '+`Received ${a.describe(n)}`);if(!0===n.value)return o.getMaybePooled("boolean",!0);const r=t(e.arg1);if("boolean"!==r.type)throw i.WTCDError.atLocation(e,'Right side of binary operator "||" has to be a boolean. '+`Received ${a.describe(r)}`);return o.getMaybePooled("boolean",r.value)}}],["?!",{precedence:6,fn:(e,{evaluator:t})=>{const n=t(e.arg0);if("null"!==n.type)return n;const r=t(e.arg1);if("null"===r.type)throw i.WTCDError.atLocation(e,'Right side of binary operator "??" cannot be null. If returning null is desired in this case, please use "???" instead');return r}}],["??",{precedence:6,fn:(e,{evaluator:t})=>{const n=t(e.arg0);return"null"!==n.type?n:t(e.arg1)}}],["&&",{precedence:7,fn:(e,{evaluator:t})=>{const n=t(e.arg0);if("boolean"!==n.type)throw i.WTCDError.atLocation(e,'Left side of binary operator "&&" has to be a boolean. '+`Received ${a.describe(n)}`);if(!1===n.value)return o.getMaybePooled("boolean",!1);const r=t(e.arg1);if("boolean"!==r.type)throw i.WTCDError.atLocation(e,'Right side of binary operator "&&" has to be a boolean. '+`Received ${a.describe(r)}`);return o.getMaybePooled("boolean",r.value)}}],["==",{precedence:11,fn:r.autoEvaluated((e,t,n,r)=>o.getMaybePooled("boolean",a.isEqual(e,t)))}],["!=",{precedence:11,fn:r.autoEvaluated((e,t)=>o.getMaybePooled("boolean",e.type!==t.type||e.value!==t.value))}],["<",{precedence:12,fn:c("number","boolean",(e,t)=>e<t)}],["<=",{precedence:12,fn:c("number","boolean",(e,t)=>e<=t)}],[">",{precedence:12,fn:c("number","boolean",(e,t)=>e>t)}],[">=",{precedence:12,fn:c("number","boolean",(e,t)=>e>=t)}],["+",{precedence:14,fn:r.autoEvaluated((e,t,n)=>{if("number"===e.type&&"number"===t.type)return o.getMaybePooled("number",e.value+t.value);if("string"===e.type&&"string"===t.type)return o.getMaybePooled("string",e.value+t.value);throw i.WTCDError.atLocation(n,'Binary operator "+" can only be applied to two '+`strings or two numbers, received: ${a.describe(e)} (left) and `+`${a.describe(t)} (right)`)})}],["-",{precedence:14,fn:c("number","number",(e,t)=>e-t)}],["*",{precedence:15,fn:c("number","number",(e,t)=>e*t)}],["/",{precedence:15,fn:c("number","number",(e,t)=>e/t)}],["~/",{precedence:15,fn:c("number","number",(e,t)=>Math.trunc(e/t))}],["%",{precedence:15,fn:c("number","number",(e,t)=>e%t)}],["**",{precedence:16,fn:c("number","number",(e,t)=>e**t)}],[".",{precedence:19,fn:r.autoEvaluated((e,t,n)=>{if("list"!==e.type)throw i.WTCDError.atLocation(n,'Left side of binary operator "." '+`is expected to be a list. Received: ${e}`);if("number"!==t.type||t.value%1!=0)throw i.WTCDError.atLocation(n,'Right side of binary operator "." '+`is expected to be an integer. Received: ${t}`);if(t.value>=e.value.length)throw i.WTCDError.atLocation(n,"List does not have an element at "+`${t.value}. If return null is desired, use ".?" instead. List `+`contents: ${a.describe(e)}`);return e.value[t.value]})}],[".?",{precedence:19,fn:r.autoEvaluated((e,t,n)=>{if("list"!==e.type)throw i.WTCDError.atLocation(n,'Left side of binary operator ".?" '+`is expected to be a list. Received: ${e}`);if("number"!==t.type||t.value%1!=0)throw i.WTCDError.atLocation(n,'Right side of binary operator ".?" '+`is expected to be an integer. Received: ${t}`);const r=e.value[t.value];return void 0===r?o.getMaybePooled("null",null):r})}],["?.",{precedence:19,fn:(e,{evaluator:t})=>{const n=t(e.arg0);if("null"===n.type)return n;if("list"!==n.type)throw i.WTCDError.atLocation(e,'Left side of binary operator "?." '+`is expected to be a list or null. Received: ${n}`);const r=t(e.arg1);if("number"!==r.type||r.value%1!=0)throw i.WTCDError.atLocation(e,'Right side of binary operator "?." '+`is expected to be an integer. Received: ${r}`);const o=n.value[r.value];if(void 0===o)throw i.WTCDError.atLocation(e,"List does not have an element at "+`${r.value}. If return null is desired, use "?.?" instead. `+`List contents: ${a.describe(n)}`);return o}}],["?.?",{precedence:19,fn:(e,{evaluator:t})=>{const n=t(e.arg0);if("null"===n.type)return n;if("list"!==n.type)throw i.WTCDError.atLocation(e,'Left side of binary operator "?.?" '+`is expected to be a list or null. Received: ${n}`);const r=t(e.arg1);if("number"!==r.type||r.value%1!=0)throw i.WTCDError.atLocation(e,"Right side of binary operator "+`"?.?" is expected to be an integer. Received: ${r}`);const a=n.value[r.value];return void 0===a?o.getMaybePooled("null",null):a}}],["::",{precedence:20,fn:s.regularInvocation}]]),n.conditionalOperatorPrecedence=4,n.operators=new Set([...n.unaryOperators.keys(),...n.binaryOperators.keys(),"?",":","..."])},{"./Interpreter":35,"./WTCDError":37,"./autoEvaluated":38,"./constantsPool":39,"./invokeFunction":40}],42:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../constantsPool"),o=e("./utils");n.contentStdFunctions=[function(e,t){o.assertArgsLength(e,1);const n=document.createElement("p");return n.innerText=o.assertArgType(e,0,"string"),t.pushContent(n),r.getMaybePooled("null",null)},function(e,t){o.assertArgsLength(e,1);const n=document.createElement("img");return n.src=o.assertArgType(e,0,"string"),t.pushContent(n),r.getMaybePooled("null",null)},function(e,t){const n=document.createElement("ul");for(let t=0;t<e.length;t++){const r=o.assertArgType(e,t,"string"),a=document.createElement("li");a.innerText=r,n.appendChild(a)}return t.pushContent(n),r.getMaybePooled("null",null)},function(e,t){const n=document.createElement("ol");for(let t=0;t<e.length;t++){const r=o.assertArgType(e,t,"string"),a=document.createElement("li");a.innerText=r,n.appendChild(a)}return t.pushContent(n),r.getMaybePooled("null",null)},function(e,t){o.assertArgsLength(e,1,2);const n=o.assertArgType(e,1,"number",1);if(![1,2,3,4,5,6].includes(n))throw new o.NativeFunctionError(`There is no header with level ${n}`);const a=document.createElement("h"+n);return a.innerText=o.assertArgType(e,0,"string"),t.pushContent(a),r.getMaybePooled("null",null)}]},{"../constantsPool":39,"./utils":49}],43:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../constantsPool"),o=e("../Interpreter"),a=e("../invokeFunction"),s=e("../WTCDError"),i=e("./utils");n.debugStdFunctions=[function(e){return console.group("WTCD print call"),e.forEach((e,t)=>console.info(`[${t}] ${o.describe(e)}`)),console.groupEnd(),r.getMaybePooled("null",null)},function(e){if(i.assertArgsLength(e,1),!i.assertArgType(e,0,"boolean"))throw new i.NativeFunctionError("Assertion failed");return r.getMaybePooled("null",null)},function(e,t){i.assertArgsLength(e,1);const n=i.assertArgType(e,0,"function");try{a.invokeFunctionRaw(n,[],t)}catch(e){if(e instanceof s.WTCDError||e instanceof a.FunctionInvocationError)return r.getMaybePooled("null",null);throw e}throw new i.NativeFunctionError("Assertion failed, no error is thrown")},function(e,t){i.assertArgsLength(e,0,1);const n=i.assertArgType(e,0,"string","default");if(t.timers.has(n))throw new i.NativeFunctionError(`Timer "${n}" already existed.`);return t.timers.set(n,Date.now()),r.getMaybePooled("null",null)},function(e,t){i.assertArgsLength(e,0,1);const n=i.assertArgType(e,0,"string","default");if(!t.timers.has(n))throw new i.NativeFunctionError(`Cannot find timer "${n}".`);const o=t.timers.get(n);t.timers.delete(n);const a=Date.now();return console.group("WTCD timeEnd call"),console.info(`Timer        : ${n}`),console.info(`Start time   : ${o}`),console.info(`End time     : ${a}`),console.info(`Time elapsed : ${a-o}ms`),console.groupEnd(),r.getMaybePooled("null",null)}]},{"../Interpreter":35,"../WTCDError":37,"../constantsPool":39,"../invokeFunction":40,"./utils":49}],44:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./content"),o=e("./debug"),a=e("./list"),s=e("./math"),i=e("./random"),c=e("./string");n.stdFunctions=[...r.contentStdFunctions,...o.debugStdFunctions,...a.listStdFunctions,...s.mathStdFunctions,...i.randomStdFunctions,...c.stringStdFunctions]},{"./content":42,"./debug":43,"./list":45,"./math":46,"./random":47,"./string":48}],45:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../constantsPool"),o=e("../invokeFunction"),a=e("../WTCDError"),s=e("./utils");n.listStdFunctions=[function(e){s.assertArgsLength(e,3);const t=s.assertArgType(e,0,"list"),n=s.assertArgType(e,1,"number"),r=e[2];if(n%1!=0)throw new s.NativeFunctionError(`Index (${n}) has to be an integer`);if(n<0)throw new s.NativeFunctionError(`Index (${n}) cannot be negative`);if(n>=t.length)throw new s.NativeFunctionError(`Index (${n}) out of bounds. List `+`length is ${t.length}`);const o=t.slice();return o[n]=r,{type:"list",value:o}},function(e,t){s.assertArgsLength(e,2);const n=s.assertArgType(e,0,"list"),i=s.assertArgType(e,1,"function");return n.forEach((e,n)=>{try{o.invokeFunctionRaw(i,[e,r.getMaybePooled("number",n)],t)}catch(e){if(e instanceof o.FunctionInvocationError)throw new s.NativeFunctionError("Failed to apply function to the "+`${n}th element of list: ${e.message}`);throw e instanceof a.WTCDError&&e.pushWTCDStack(`listForEach (index = ${n})`),e}}),r.getMaybePooled("null",null)},function(e,t){s.assertArgsLength(e,2);const n=s.assertArgType(e,0,"list"),i=s.assertArgType(e,1,"function");return{type:"list",value:n.map((e,n)=>{try{return o.invokeFunctionRaw(i,[e,r.getMaybePooled("number",n)],t)}catch(e){if(e instanceof o.FunctionInvocationError)throw new s.NativeFunctionError("Failed to apply function to the "+`${n}th element of list: ${e.message}`);throw e instanceof a.WTCDError&&e.pushWTCDStack(`listForEach (index = ${n})`),e}})}},function(e){s.assertArgsLength(e,1,2);const t=s.assertArgType(e,0,"number"),n=1===e.length?r.getMaybePooled("null",null):e[1];if(t%1!=0)throw new s.NativeFunctionError(`Length (${t}) has to be an integer.`);if(t<0)throw new s.NativeFunctionError(`Length (${t}) cannot be negative.`);return{type:"list",value:new Array(t).fill(n)}},function(e){s.assertArgsLength(e,2);const t=s.assertArgType(e,0,"list"),n=s.assertArgType(e,1,"number");if(n%1!=0||n<1)throw new s.NativeFunctionError(`Chunk size (${n} has to be a `+"positive integer.");const r=[];for(let e=0;e<t.length;e+=n)r.push({type:"list",value:t.slice(e,e+n)});return{type:"list",value:r}}]},{"../WTCDError":37,"../constantsPool":39,"../invokeFunction":40,"./utils":49}],46:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../constantsPool"),o=e("./utils");n.mathStdFunctions=[function(e){o.assertArgsLength(e,1,1/0);let t=1/0;for(let n=0;n<e.length;n++){const r=o.assertArgType(e,n,"number");r<t&&(t=r)}return r.getMaybePooled("number",t)},function(e){o.assertArgsLength(e,1,1/0);let t=-1/0;for(let n=0;n<e.length;n++){const r=o.assertArgType(e,n,"number");r>t&&(t=r)}return r.getMaybePooled("number",t)},function(e){return o.assertArgsLength(e,1),r.getMaybePooled("number",Math.floor(o.assertArgType(e,0,"number")))}]},{"../constantsPool":39,"./utils":49}],47:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../constantsPool"),o=e("./utils");n.randomStdFunctions=[function(e,t){o.assertArgsLength(e,0,2);const n=o.assertArgType(e,0,"number",0),r=o.assertArgType(e,1,"number",1);return{type:"number",value:t.getRandom().next(n,r)}},function(e,t){o.assertArgsLength(e,2);const n=o.assertArgType(e,0,"number"),a=o.assertArgType(e,1,"number");return r.getMaybePooled("number",t.getRandom().nextInt(n,a))},function(e,t){o.assertArgsLength(e,0,1);const n=o.assertArgType(e,0,"number",.5);return r.getMaybePooled("boolean",t.getRandom().next()<n)},function(e,t){o.assertArgsLength(e,0,4);const n=o.assertArgType(e,0,"number",0),r=o.assertArgType(e,1,"number",1),a=o.assertArgType(e,2,"number",(n+r)/2),s=o.assertArgType(e,3,"number",4);if(n>=r)throw new o.NativeFunctionError("Low cannot be larger than or equal to high.");if(a<n||a>=r)throw new o.NativeFunctionError("Bias has to be between low and high.");let i;do{i=a+(r-n)/s*Math.sqrt(-2*Math.log(t.getRandom().next()))*Math.cos(2*Math.PI*t.getRandom().next())}while(i<n||i>=r);return{type:"number",value:i}}]},{"../constantsPool":39,"./utils":49}],48:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../constantsPool"),o=e("./utils");n.stringStdFunctions=[function(e){o.assertArgsLength(e,1);const t=o.assertArgType(e,0,"string");return r.getMaybePooled("number",t.length)}]},{"../constantsPool":39,"./utils":49}],49:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../constantsPool"),o=e("../Interpreter");class a extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}function s(e,t){const n=e[t];return void 0===n?r.getMaybePooled("null",null):n}n.NativeFunctionError=a,n.assertArgsLength=function(e,t,n=t){if(e.length<t)throw new a("Too many arguments are provided. "+`Minimum number of arguments: ${t}, received: ${e.length}`);if(e.length>n)throw new a("Too many arguments are provided. "+`Maximum number of arguments: ${n}, received: ${e.length}`)},n.nullify=s,n.assertArgType=function(e,t,n,r){const i=s(e,t);if("null"===i.type&&void 0!==r)return r;if(i.type!==n)throw new a(`The ${t}th argument of `+`invocation has wrong type. Expected: ${n}, received: `+`${o.describe(i)}`);return i.value}},{"../Interpreter":35,"../constantsPool":39}],50:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.flat=function(e){const t=[];for(const n of e)Array.isArray(n)?t.push(...n):t.push(n);return t},n.arrayEquals=function(e,t,n=((e,t)=>e===t)){return e.every((e,r)=>n(e,t[r]))}},{}]},{},[23]);