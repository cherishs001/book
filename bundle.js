!function r(e,t,n){function o(a,s){if(!t[a]){if(!e[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(i)return i(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var u=t[a]={exports:{}};e[a][0].call(u.exports,(function(t){return o(e[a][1][t]||t)}),u,u.exports,r,e,t,n)}return t[a].exports}for(var i="function"==typeof require&&require,a=0;a<n.length;a++)o(n[a]);return o}({1:[function(e,t,n){},{}],2:[function(e,t,n){
/*!
 * Cross-Browser Split 1.1.1
 * Copyright 2007-2012 Steven Levithan <stevenlevithan.com>
 * Available under the MIT License
 * ECMAScript compliant, uniform cross-browser split method
 */
t.exports=function split(e){var t=String.prototype.split,n=/()??/.exec("")[1]===e;return function(i,a,s){if("[object RegExp]"!==Object.prototype.toString.call(a))return t.call(i,a,s);var l,c,u,d,p=[],g=(a.ignoreCase?"i":"")+(a.multiline?"m":"")+(a.extended?"x":"")+(a.sticky?"y":""),m=0;a=new RegExp(a.source,g+"g");for(i+="",n||(l=new RegExp("^"+a.source+"$(?!\\s)",g)),s=s===e?-1>>>0:s>>>0;(c=a.exec(i))&&!((u=c.index+c[0].length)>m&&(p.push(i.slice(m,c.index)),!n&&c.length>1&&c[0].replace(l,(function(){for(var t=1;t<arguments.length-2;t++)arguments[t]===e&&(c[t]=e)})),c.length>1&&c.index<i.length&&Array.prototype.push.apply(p,c.slice(1)),d=c[0].length,m=u,p.length>=s));)a.lastIndex===c.index&&a.lastIndex++;return m===i.length?!d&&a.test("")||p.push(""):p.push(i.slice(m)),p.length>s?p.slice(0,s):p}}()},{}],3:[function(e,t,n){var i=e("indexof");function isTruthy(e){return!!e}t.exports=function ClassList(e){var t=e.classList;if(t)return t;var n={add:add,remove:remove,contains:contains,toggle:function toggle(e){return contains(e)?(remove(e),!1):(add(e),!0)},toString:function $toString(){return e.className},length:0,item:function item(e){return getTokens()[e]||null}};return n;function add(e){var t=getTokens();i(t,e)>-1||(t.push(e),setTokens(t))}function remove(e){var t=getTokens(),n=i(t,e);-1!==n&&(t.splice(n,1),setTokens(t))}function contains(e){return i(getTokens(),e)>-1}function getTokens(){return function filter(e,t){for(var n=[],i=0;i<e.length;i++)t(e[i])&&n.push(e[i]);return n}(e.className.split(" "),isTruthy)}function setTokens(t){var i=t.length;e.className=t.join(" "),n.length=i;for(var a=0;a<t.length;a++)n[a]=t[a];delete t[i]}}},{indexof:5}],4:[function(e,t,n){var i=e("browser-split"),a=e("class-list"),s="undefined"==typeof window?e("html-element"):window,l=s.document,c=s.Text;function context(){var e=[];function h(){var t=[].slice.call(arguments),n=null;function item(t){var s;if(null==t);else if("string"==typeof t)n?n.appendChild(s=l.createTextNode(t)):function parseClass(e){var t=i(e,/([\.#]?[^\s#.]+)/);/^\.|#/.test(t[1])&&(n=l.createElement("div")),forEach(t,(function(e){var t=e.substring(1,e.length);e&&(n?"."===e[0]?a(n).add(t):"#"===e[0]&&n.setAttribute("id",t):n=l.createElement(e))}))}(t);else if("number"==typeof t||"boolean"==typeof t||t instanceof Date||t instanceof RegExp)n.appendChild(s=l.createTextNode(t.toString()));else if(isArray(t))forEach(t,item);else if(isNode(t))n.appendChild(s=t);else if(t instanceof c)n.appendChild(s=t);else if("object"==typeof t)for(var u in t)if("function"==typeof t[u])/^on\w+/.test(u)?function(t,i){n.addEventListener?(n.addEventListener(t.substring(2),i[t],!1),e.push((function(){n.removeEventListener(t.substring(2),i[t],!1)}))):(n.attachEvent(t,i[t]),e.push((function(){n.detachEvent(t,i[t])})))}(u,t):(n[u]=t[u](),e.push(t[u]((function(e){n[u]=e}))));else if("style"===u)if("string"==typeof t[u])n.style.cssText=t[u];else for(var d in t[u])!function(i,a){if("function"==typeof a)n.style.setProperty(i,a()),e.push(a((function(e){n.style.setProperty(i,e)})));else var s=t[u][i].match(/(.*)\W+!important\W*$/);s?n.style.setProperty(i,s[1],"important"):n.style.setProperty(i,t[u][i])}(d,t[u][d]);else if("attrs"===u)for(var p in t[u])n.setAttribute(p,t[u][p]);else"data-"===u.substr(0,5)?n.setAttribute(u,t[u]):n[u]=t[u];else if("function"==typeof t){p=t();n.appendChild(s=isNode(p)?p:l.createTextNode(p)),e.push(t((function(e){isNode(e)&&s.parentElement?(s.parentElement.replaceChild(e,s),s=e):s.textContent=e})))}return s}for(;t.length;)item(t.shift());return n}return h.cleanup=function(){for(var t=0;t<e.length;t++)e[t]();e.length=0},h}function isNode(e){return e&&e.nodeName&&e.nodeType}function forEach(e,t){if(e.forEach)return e.forEach(t);for(var n=0;n<e.length;n++)t(e[n],n)}function isArray(e){return"[object Array]"==Object.prototype.toString.call(e)}(t.exports=context()).context=context},{"browser-split":2,"class-list":3,"html-element":1}],5:[function(e,t,n){var i=[].indexOf;t.exports=function(e,t){if(i)return e.indexOf(t);for(var n=0;n<e.length;++n)if(e[n]===t)return n;return-1}},{}],6:[function(e,t,n){var i,a,s=t.exports={};function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(e){if(i===setTimeout)return setTimeout(e,0);if((i===defaultSetTimout||!i)&&setTimeout)return i=setTimeout,setTimeout(e,0);try{return i(e,0)}catch(t){try{return i.call(null,e,0)}catch(t){return i.call(this,e,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){i=defaultSetTimout}try{a="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){a=defaultClearTimeout}}();var l,c=[],u=!1,d=-1;function cleanUpNextTick(){u&&l&&(u=!1,l.length?c=l.concat(c):d=-1,c.length&&drainQueue())}function drainQueue(){if(!u){var e=runTimeout(cleanUpNextTick);u=!0;for(var t=c.length;t;){for(l=c,c=[];++d<t;)l&&l[d].run();d=-1,t=c.length}l=null,u=!1,function runClearTimeout(e){if(a===clearTimeout)return clearTimeout(e);if((a===defaultClearTimeout||!a)&&clearTimeout)return a=clearTimeout,clearTimeout(e);try{return a(e)}catch(t){try{return a.call(null,e)}catch(t){return a.call(this,e)}}}(e)}}function Item(e,t){this.fun=e,this.array=t}function noop(){}s.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new Item(e,t)),1!==c.length||u||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=noop,s.addListener=noop,s.once=noop,s.off=noop,s.removeListener=noop,s.removeAllListeners=noop,s.emit=noop,s.prependListener=noop,s.prependOnceListener=noop,s.listeners=function(e){return[]},s.binding=function(e){throw new Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw new Error("process.chdir is not supported")},s.umask=function(){return 0}},{}],7:[function(e,t,n){(function(t,i){var a=e("process/browser.js").nextTick,s=Function.prototype.apply,l=Array.prototype.slice,c={},u=0;function Timeout(e,t){this._id=e,this._clearFn=t}n.setTimeout=function(){return new Timeout(s.call(setTimeout,window,arguments),clearTimeout)},n.setInterval=function(){return new Timeout(s.call(setInterval,window,arguments),clearInterval)},n.clearTimeout=n.clearInterval=function(e){e.close()},Timeout.prototype.unref=Timeout.prototype.ref=function(){},Timeout.prototype.close=function(){this._clearFn.call(window,this._id)},n.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},n.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},n._unrefActive=n.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout((function onTimeout(){e._onTimeout&&e._onTimeout()}),t))},n.setImmediate="function"==typeof t?t:function(e){var t=u++,i=!(arguments.length<2)&&l.call(arguments,1);return c[t]=!0,a((function onNextTick(){c[t]&&(i?e.apply(null,i):e.call(null),n.clearImmediate(t))})),t},n.clearImmediate="function"==typeof i?i:function(e){delete c[e]}}).call(this,e("timers").setImmediate,e("timers").clearImmediate)},{"process/browser.js":6,timers:7}],8:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.DebugLogger=void 0;const i=e("./constant/materialDarkColors"),a=e("./data/settings"),s=e("./util/stringHash");n.DebugLogger=class DebugLogger{constructor(e){this.prefix="%c"+e,this.css="background-color: #"+i.materialDarkColors[Math.abs(s.stringHash(e))%i.materialDarkColors.length]+"; border-radius: 0.3em; padding: 0 0.3em; color: white"}log(...e){a.developerMode.getValue()&&console.info(this.prefix,this.css,...e)}warn(...e){console.warn(this.prefix,this.css,...e)}error(...e){console.error(this.prefix,this.css,...e)}}},{"./constant/materialDarkColors":12,"./data/settings":37,"./util/stringHash":65}],9:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Event=void 0;n.Event=class Event{constructor(){this.listeners=null,this.onceListeners=null,this.isEmitting=!1,this.queue=[]}on(e){return this.isEmitting?(this.queue.push(()=>{this.on(e)}),e):(null===this.listeners&&(this.listeners=new Set),this.listeners.add(e),e)}off(e){this.isEmitting?this.queue.push(()=>{this.off(e)}):null!==this.listeners&&this.listeners.delete(e)}once(e){return this.isEmitting?(this.queue.push(()=>{this.once(e)}),e):(null===this.onceListeners&&(this.onceListeners=[]),this.onceListeners.push(e),e)}expect(e){return this.isEmitting?new Promise(t=>{this.queue.push(()=>{this.expect(e).then(t)})}):new Promise(void 0===e?e=>this.once(e):t=>{const n=this.on(i=>{e(i)&&(this.off(n),t(i))})})}emit(e){this.isEmitting?this.queue.push(()=>{this.emit(e)}):(this.isEmitting=!0,null!==this.listeners&&this.listeners.forEach(t=>t(e)),null!==this.onceListeners&&(this.onceListeners.forEach(t=>t(e)),this.onceListeners.length=0),this.isEmitting=!1,this.queue.forEach(e=>e()),this.queue.length=0)}}},{}],10:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Menu=n.ItemHandle=n.ItemLocation=n.ItemDecoration=void 0;const i=e("./control/layoutControl"),a=e("./DebugLogger"),s=e("./Event");var l,c;function createSpan(e,...t){const n=document.createElement("span");return n.innerText=e,n.classList.add(...t),n}!function(e){e[e.SELECTABLE=0]="SELECTABLE",e[e.BACK=1]="BACK",e[e.ICON_FOLDER=2]="ICON_FOLDER",e[e.ICON_LINK=3]="ICON_LINK",e[e.ICON_EQUALIZER=4]="ICON_EQUALIZER",e[e.ICON_FILE=5]="ICON_FILE",e[e.ICON_GAME=6]="ICON_GAME",e[e.ICON_NOTIFICATION=7]="ICON_NOTIFICATION"}(l=n.ItemDecoration||(n.ItemDecoration={})),function(e){e[e.BEFORE=0]="BEFORE",e[e.AFTER=1]="AFTER"}(c=n.ItemLocation||(n.ItemLocation={}));class ItemHandle{constructor(e,t){this.menu=e,this.element=t,this.$prependSpan=null,this.$appendSpan=null}setSelected(e){return this.element.classList.toggle("selected",e),this}onClick(e){return this.element.addEventListener("click",()=>{e(this.element)}),this}linkTo(e){return this.onClick(()=>{this.menu.navigateTo(e)}),this}setInnerText(e){return this.element.innerText=e,this}addClass(e){return this.element.classList.add(e),this}removeClass(e){return this.element.classList.remove(e),this}prepend(e,t){null===this.$prependSpan&&(this.$prependSpan=createSpan("","prepend"),this.element.prepend(this.$prependSpan));const n=createSpan(e,"item-side");return void 0!==t&&n.classList.add(t),this.$prependSpan.prepend(n),n}append(e,t){null===this.$appendSpan&&(this.$appendSpan=createSpan("","append"),this.element.appendChild(this.$appendSpan));const n=createSpan(e,"item-side");return void 0!==t&&n.classList.add(t),this.$appendSpan.appendChild(n),n}remove(){this.element.remove()}}n.ItemHandle=ItemHandle;n.Menu=class Menu{constructor(e,t,n=i.Layout.OFF){if(this.name=e,this.parent=t,this.layout=n,this.active=!1,this.clearableElements=[],this.activateEvent=new s.Event,this.debugLogger=new a.DebugLogger(`Menu (${e})`),this.fullPath=null===t?[]:t.fullPath.slice(),""!==e&&this.fullPath.push(e),this.container=document.createElement("div"),this.container.classList.add("menu","hidden"),this.fullPath.length>=1){const e=document.createElement("div");e.classList.add("path"),e.innerText=this.fullPath.join(" > "),this.container.appendChild(e)}null!==t&&this.addItem("返回",{button:!0,decoration:l.BACK,unclearable:!0}).linkTo(t),document.body.appendChild(this.container),i.layoutChangeEvent.on(({newLayout:e})=>{this.active&&e===i.Layout.MAIN&&(this.setActive(!1),i.layoutChangeEvent.expect().then(()=>{this.setActive(!0)}))})}navigateTo(e){this.setActive(!1),e.setActive(!0),i.setLayout(e.layout)}exit(){if(null===this.parent)throw new Error("Cannot exit the root menu.");this.navigateTo(this.parent)}setActive(e){this.debugLogger.log(`setActive(${e})`),!this.active&&e&&this.activateEvent.emit(),this.active=e,this.container.classList.toggle("hidden",!e)}isActive(){return this.active}addItem(e,t){let n;if(t.button&&void 0!==t.link?(n=document.createElement("a"),n.href=t.link,n.rel="noopener noreferrer",t.link.startsWith("#")||(n.target="_blank")):n=document.createElement("div"),n.innerText=e,t.small&&n.classList.add("small"),t.button)switch(n.classList.add("button"),t.decoration){case l.BACK:n.classList.add("back");break;case l.SELECTABLE:n.classList.add("selectable");break;case l.ICON_FOLDER:n.classList.add("icon","folder");break;case l.ICON_LINK:n.classList.add("icon","link");break;case l.ICON_EQUALIZER:n.classList.add("icon","equalizer");break;case l.ICON_FILE:n.classList.add("icon","file");break;case l.ICON_GAME:n.classList.add("icon","game");break;case l.ICON_NOTIFICATION:n.classList.add("icon","notification")}return t.location===c.BEFORE?this.container.prepend(n):this.container.appendChild(n),t.unclearable||this.clearableElements.push(n),new ItemHandle(this,n)}clearItems(){this.clearableElements.forEach(e=>e.remove()),this.clearableElements=[]}addLink(e,t,n){return this.addItem(e.name,{small:t,button:!0,decoration:n}).linkTo(e)}}},{"./DebugLogger":8,"./Event":9,"./control/layoutControl":29}],11:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.loadingText=void 0,n.loadingText="加载中..."},{}],12:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.materialDarkColors=void 0,n.materialDarkColors=["b71c1c","880e4f","4a148c","311b92","1a237e","0d47a1","01579b","006064","004d40","1b5e20","33691e","827717","bf360c","3e2723","795548","5d4037","1976d2","303f9f","3f51b5","673ab7","9c27b0","c2185b","d32f2f","263238","455a64","616161","212121"]},{}],13:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.MAKAI_MODAL_CONTENT_DEVELOPMENT_HINT=n.MAKAI_MODAL_CONTENT_MAKAI_TOKEN_DESC=n.MAKAI_MODAL_CONTENT_DELETION_CONFIRMATION=n.MAKAI_MODAL_CONTENT_TOKEN_INPUT_PREFIX=n.MAKAI_MODAL_CONTENT_EMAIL_INPUT_PREFIX=n.MAKAI_MODAL_CONTENT_NAME_INPUT_PREFIX=n.MAKAI_MODAL_CONTENT_COMMENT_HINT=n.MAKAI_MODAL_CONFIRM_LOSS_EDITED_NO=n.MAKAI_MODAL_CONFIRM_LOSS_EDITED_YES=n.MAKAI_MODAL_CONFIRM_LOSS_EDITED=n.MAKAI_MODAL_SUBMIT=n.MAKAI_MODAL_SAVE=n.MAKAI_MODAL_CANCEL=n.MAKAI_MODAL_CONFIRM=n.MAKAI_MODAL_OK=n.MAKAI_MODAL_TITLE_COMMENT=n.MAKAI_MODAL_TITLE_TOKEN=n.MAKAI_MODAL_TITLE_WAITING=n.MAKAI_MODAL_TITLE_INFO=n.MAKAI_MODAL_TITLE_WARNING=n.MAKAI_BUTTON_REPLY=n.MAKAI_BUTTON_DELETE=n.MAKAI_BUTTON_BLOCK=n.MAKAI_GENERIC_LAST_MODIFIED_SUFFIX=n.MAKAI_GENERIC_LAST_MODIFIED=n.MAKAI_SUBMITTED_1=n.MAKAI_SUBMITTED_0=n.MAKAI_SUBMIT_1=n.MAKAI_SUBMIT_0=n.MAKAI_INFO_OBTAIN_TOKEN=n.MAKAI_INFO_CONFIRM_TOKEN=n.MAKAI_INFO_SET_TOKKEN_SUCCESS=n.MAKAI_ERROR_UNKNOWN=n.MAKAI_ERROR_USER_EXIST=n.MAKAI_ERROR_INVALID_EMAIL=n.MAKAI_ERROR_INVALID_TOKEN=n.MAKAI_ERROR_EMPTY_TOKEN=n.MAKAI_ERROR_DELETE_COMMENT_INVALID_TOKEN=n.MAKAI_ERROR_SUBMIT_COMMENT_INVALID_TOKEN=n.MAKAI_ERROR_INTERNET=n.WTCD_CANVAS_LOADING=n.WTCD_ERROR_INTERNAL_STACK_DESC=n.WTCD_ERROR_INTERNAL_STACK_TITLE=n.WTCD_ERROR_WTCD_STACK_DESC=n.WTCD_ERROR_WTCD_STACK_TITLE=n.WTCD_ERROR_MESSAGE=n.WTCD_ERROR_INTERNAL_DESC=n.WTCD_ERROR_INTERNAL_TITLE=n.WTCD_ERROR_RUNTIME_DESC=n.WTCD_ERROR_RUNTIME_TITLE=n.WTCD_ERROR_COMPILE_DESC=n.WTCD_ERROR_COMPILE_TITLE=n.WTCD_GAME_NO_DESC=n.WTCD_GAME_QUICK_LOAD_CONFIRM_CANCEL=n.WTCD_GAME_QUICK_LOAD_CONFIRM_CONFIRM=n.WTCD_GAME_QUICK_LOAD_CONFIRM_DESC=n.WTCD_GAME_QUICK_LOAD_CONFIRM_TITLE=n.WTCD_GAME_QUICK_LOAD_NOT_EXIST=n.WTCD_GAME_QUICK_LOAD_OK=n.WTCD_GAME_QUICK_LOAD=n.WTCD_GAME_QUICK_SAVE_OK=n.WTCD_GAME_QUICK_SAVE=n.WTCD_GAME_LOAD_OK=n.WTCD_GAME_LOAD_QUICK=n.WTCD_GAME_LOAD_CANCEL=n.WTCD_GAME_LOAD_TITLE=n.WTCD_GAME_LOAD=n.WTCD_GAME_SAVE_OK=n.WTCD_GAME_SAVE_OVERWRITE_CANCEL=n.WTCD_GAME_SAVE_OVERWRITE_CONFIRM=n.WTCD_GAME_SAVE_OVERWRITE_TITLE=n.WTCD_GAME_SAVE_NEW=n.WTCD_GAME_SAVE_CANCEL=n.WTCD_GAME_SAVE_TITLE=n.WTCD_GAME_SAVE=n.WTCD_GAME_RESTART_OK=n.WTCD_GAME_RESTART_CANCEL=n.WTCD_GAME_RESTART_DECISION_ONLY=n.WTCD_GAME_RESTART_ALL=n.WTCD_GAME_RESTART_DECISION_ONLY_DESC=n.WTCD_GAME_RESTART_ALL_DESC=n.WTCD_GAME_RESTART_DESC=n.WTCD_GAME_RESTART_TITLE=n.WTCD_GAME_RESTART=n.CLICK_TO_UNBLOCK=n.NO_BLOCKED_USERS=n.VISIT_COUNT_TIMES=n.VISIT_COUNT_DISPLAYING=n.VISIT_COUNT_TIME_FRAME_YEAR=n.VISIT_COUNT_TIME_FRAME_MONTH=n.VISIT_COUNT_TIME_FRAME_WEEK=n.VISIT_COUNT_TIME_FRAME_DAY=n.VISIT_COUNT_TIME_FRAME_HOUR=n.VISIT_COUNT_TIME_FRAME_ALL=n.VISIT_COUNT_LOAD_MORE_FAILED=n.VISIT_COUNT_LOAD_MORE_LOADING=n.VISIT_COUNT_LOAD_MORE=n.VISIT_COUNT_FAILED=n.VISIT_COUNT_LOADING=n.VISIT_COUNT_DESC_2=n.VISIT_COUNT_DESC_1=n.VISIT_COUNT_DESC_0=n.VISIT_COUNT_TITLE=n.COMMENTS_MENTION_REPLIED_OK=n.COMMENTS_MENTION_REPLIED_TITLE=n.COMMENTS_MENTION_NO_TOKEN_DESC=n.COMMENTS_MENTION_NO_TOKEN_TITLE=n.COMMENTS_MENTION_LOADED=n.COMMENTS_MENTION_SECTION=n.COMMENTS_RECENT_LOADED=n.COMMENTS_RECENT_SECTION=n.COMMENTS_FAILED=n.COMMENTS_LOADED=n.COMMENTS_CREATE=n.COMMENTS_UNAVAILABLE=n.COMMENTS_LOADING=n.COMMENTS_SECTION=n.BROKEN_LINK_OK=n.BROKEN_LINK_DESC=n.BROKEN_LINK_TITLE=n.BUILD_FAILED_OK=n.BUILD_FAILED_DESC=n.BUILD_FAILED_TITLE=n.CHAPTER_FAILED=n.CHAPTER_LOADING=n.NEXT_CHAPTER=n.GO_TO_MENU=n.PREVIOUS_CHAPTER=n.EARLY_ACCESS_DESC=n.EARLY_ACCESS_TITLE=void 0,n.EARLY_ACCESS_TITLE="编写中章节",n.EARLY_ACCESS_DESC="请注意，本文正在编写中，因此可能会含有未完成的句子或是尚未更新的信息。",n.PREVIOUS_CHAPTER="上一章",n.GO_TO_MENU="返回",n.NEXT_CHAPTER="下一章",n.CHAPTER_LOADING="章节加载中...",n.CHAPTER_FAILED="章节加载失败，请检查网络连接。",n.BUILD_FAILED_TITLE="构建失败",n.BUILD_FAILED_DESC="《可穿戴科技》的网页构建脚本在构建过程中发生了可以恢复的异常。详细内容请参见控制台输出。",n.BUILD_FAILED_OK="我知道了",n.BROKEN_LINK_TITLE="损坏的链接",n.BROKEN_LINK_DESC="对不起，您提供的地址无法被正确解析，所以您现在回到了《可穿戴科技》的首页。",n.BROKEN_LINK_OK="我知道了",n.COMMENTS_SECTION="评论区",n.COMMENTS_LOADING="评论加载中...",n.COMMENTS_UNAVAILABLE="本文评论不可用。",n.COMMENTS_CREATE="+ 添加评论",n.COMMENTS_LOADED="以下为本章节的评论区。",n.COMMENTS_FAILED="评论加载失败，请检查网络连接。",n.COMMENTS_RECENT_SECTION="最新评论",n.COMMENTS_RECENT_LOADED="以下是最新的五十条评论。",n.COMMENTS_MENTION_SECTION="最新回复",n.COMMENTS_MENTION_LOADED="以下是最新回复了您的评论。",n.COMMENTS_MENTION_NO_TOKEN_TITLE="最新回复不可用",n.COMMENTS_MENTION_NO_TOKEN_DESC="请至少发送了一条评论后再来查看。",n.COMMENTS_MENTION_REPLIED_TITLE="回复成功",n.COMMENTS_MENTION_REPLIED_OK="完成",n.VISIT_COUNT_TITLE="访问量统计",n.VISIT_COUNT_DESC_0="访问量统计信息由《可穿戴科技》访问统计系统提供。《可穿戴科技》访问统计系统是专门为本小说编写的高度重视隐私保护的，不记录任何个人信息的数据统计服务。其隐私政策可以在",n.VISIT_COUNT_DESC_1="这里",n.VISIT_COUNT_DESC_2="找到。",n.VISIT_COUNT_LOADING="访问量加载中...",n.VISIT_COUNT_FAILED="访问量加载失败，请检查网络连接。",n.VISIT_COUNT_LOAD_MORE="加载更多",n.VISIT_COUNT_LOAD_MORE_LOADING="加载中...",n.VISIT_COUNT_LOAD_MORE_FAILED="加载失败，点此重试",n.VISIT_COUNT_TIME_FRAME_ALL="所有",n.VISIT_COUNT_TIME_FRAME_HOUR="1 小时内",n.VISIT_COUNT_TIME_FRAME_DAY="24 小时内",n.VISIT_COUNT_TIME_FRAME_WEEK="7 天内",n.VISIT_COUNT_TIME_FRAME_MONTH="30 天内",n.VISIT_COUNT_TIME_FRAME_YEAR="365 天内",n.VISIT_COUNT_DISPLAYING="正在显示$的访问量：",n.VISIT_COUNT_TIMES=" 次",n.NO_BLOCKED_USERS="没有用户的评论被屏蔽",n.CLICK_TO_UNBLOCK="(点击用户名以解除屏蔽)",n.WTCD_GAME_RESTART="重置游戏",n.WTCD_GAME_RESTART_TITLE="是否重置游戏种子",n.WTCD_GAME_RESTART_DESC="游戏种子会决定游戏的随机因素。",n.WTCD_GAME_RESTART_ALL_DESC="若选择【重置游戏种子与进度】，那么新游戏中的所有随机因素和本游戏不一致。",n.WTCD_GAME_RESTART_DECISION_ONLY_DESC="若选择【仅重置进度】，那么新游戏中的随机因素将与本游戏完全一致。",n.WTCD_GAME_RESTART_ALL="重置游戏种子与进度",n.WTCD_GAME_RESTART_DECISION_ONLY="仅重置进度",n.WTCD_GAME_RESTART_CANCEL="不重置任何内容",n.WTCD_GAME_RESTART_OK="游戏重置成功",n.WTCD_GAME_SAVE="存储",n.WTCD_GAME_SAVE_TITLE="请选择要存储的位置",n.WTCD_GAME_SAVE_CANCEL="取消",n.WTCD_GAME_SAVE_NEW="- 新存档 -",n.WTCD_GAME_SAVE_OVERWRITE_TITLE="是否覆盖？",n.WTCD_GAME_SAVE_OVERWRITE_CONFIRM="确认覆盖",n.WTCD_GAME_SAVE_OVERWRITE_CANCEL="取消",n.WTCD_GAME_SAVE_OK="存储成功",n.WTCD_GAME_LOAD="读取",n.WTCD_GAME_LOAD_TITLE="请选择要读取的存档",n.WTCD_GAME_LOAD_CANCEL="取消",n.WTCD_GAME_LOAD_QUICK="快",n.WTCD_GAME_LOAD_OK="读取成功",n.WTCD_GAME_QUICK_SAVE="快速存储",n.WTCD_GAME_QUICK_SAVE_OK="快速存储成功",n.WTCD_GAME_QUICK_LOAD="快速读取",n.WTCD_GAME_QUICK_LOAD_OK="快速读取成功",n.WTCD_GAME_QUICK_LOAD_NOT_EXIST="没有可用的快速存档，请先使用【快速存储】来创建快速存档。",n.WTCD_GAME_QUICK_LOAD_CONFIRM_TITLE="是否快速读取？",n.WTCD_GAME_QUICK_LOAD_CONFIRM_DESC="这会丢失当前未保存的数据。（可在【设置】中禁用此确认）",n.WTCD_GAME_QUICK_LOAD_CONFIRM_CONFIRM="确认读取",n.WTCD_GAME_QUICK_LOAD_CONFIRM_CANCEL="取消",n.WTCD_GAME_NO_DESC="无描述文本",n.WTCD_ERROR_COMPILE_TITLE="WTCD 编译失败",n.WTCD_ERROR_COMPILE_DESC="该 WTCD 文档在编译时发生了错误。请检查是否有语法错误或是其他基本错误。",n.WTCD_ERROR_RUNTIME_TITLE="WTCD 运行时错误",n.WTCD_ERROR_RUNTIME_DESC="该 WTCD 文档在运行时发生了错误。请检查是否有逻辑错误。",n.WTCD_ERROR_INTERNAL_TITLE="WTCD 内部错误",n.WTCD_ERROR_INTERNAL_DESC="WTCD 解释器在解释执行该 WTCD 文档时崩溃了。请务必告诉琳你做了什么好让她来修。",n.WTCD_ERROR_MESSAGE="错误信息：",n.WTCD_ERROR_WTCD_STACK_TITLE="WTCD 调用栈",n.WTCD_ERROR_WTCD_STACK_DESC="WTCD 调用栈记录了在错误发生时 WTCD 的解释器状态。这可以帮助理解错误发生的上下文。",n.WTCD_ERROR_INTERNAL_STACK_TITLE="内部调用栈",n.WTCD_ERROR_INTERNAL_STACK_DESC="内部调用栈记录了出现该错误时编译器或是解释器的状态。请注意内部调用栈通常只在调试 WTCD 编译器或是解释器时有用。内部调用栈通常对调试 WTCD 文档没有作用。",n.WTCD_CANVAS_LOADING="资源加载中... 取决于网络情况，这可能需要 1 秒 ~ 10 分钟。",n.MAKAI_ERROR_INTERNET="加载失败，请检查网络连接。",n.MAKAI_ERROR_SUBMIT_COMMENT_INVALID_TOKEN="评论失败，请检查令牌设置。",n.MAKAI_ERROR_DELETE_COMMENT_INVALID_TOKEN="删除失败，请检查令牌设置。",n.MAKAI_ERROR_EMPTY_TOKEN="请输入令牌。",n.MAKAI_ERROR_INVALID_TOKEN="令牌错误。",n.MAKAI_ERROR_INVALID_EMAIL="邮箱格式错误。",n.MAKAI_ERROR_USER_EXIST="用户名已存在。如果您在此之前使用别的设备在《可穿戴科技》评论过，请将之前评论时的生成的令牌复制到“设置” > “Makai 评论系统管理” > “Makai 令牌”。",n.MAKAI_ERROR_UNKNOWN="发生了未知错误，请联系友人♪B 或者琳。",n.MAKAI_INFO_SET_TOKKEN_SUCCESS="令牌设置成功。",n.MAKAI_INFO_CONFIRM_TOKEN="正在确认您的 Makai 令牌...",n.MAKAI_INFO_OBTAIN_TOKEN="正在获取 Makai 令牌...",n.MAKAI_SUBMIT_0="将以",n.MAKAI_SUBMIT_1="的身份发表评论。",n.MAKAI_SUBMITTED_0="由",n.MAKAI_SUBMITTED_1="发表于 ",n.MAKAI_GENERIC_LAST_MODIFIED="（最后修改于 ",n.MAKAI_GENERIC_LAST_MODIFIED_SUFFIX=" ）",n.MAKAI_BUTTON_BLOCK="屏蔽此人",n.MAKAI_BUTTON_DELETE="删除评论",n.MAKAI_BUTTON_REPLY="回复",n.MAKAI_MODAL_TITLE_WARNING="警告！",n.MAKAI_MODAL_TITLE_INFO="提示",n.MAKAI_MODAL_TITLE_WAITING="加载中...",n.MAKAI_MODAL_TITLE_TOKEN="Makai 令牌",n.MAKAI_MODAL_TITLE_COMMENT="添加评论",n.MAKAI_MODAL_OK="好的",n.MAKAI_MODAL_CONFIRM="是的",n.MAKAI_MODAL_CANCEL="取消",n.MAKAI_MODAL_SAVE="保存",n.MAKAI_MODAL_SUBMIT="发表",n.MAKAI_MODAL_CONFIRM_LOSS_EDITED="是否放弃编写的内容？",n.MAKAI_MODAL_CONFIRM_LOSS_EDITED_YES="放弃编写的内容",n.MAKAI_MODAL_CONFIRM_LOSS_EDITED_NO="继续编辑",n.MAKAI_MODAL_CONTENT_COMMENT_HINT="请填写评论内容。",n.MAKAI_MODAL_CONTENT_NAME_INPUT_PREFIX="署名（必填）：",n.MAKAI_MODAL_CONTENT_EMAIL_INPUT_PREFIX="邮箱（可选）：",n.MAKAI_MODAL_CONTENT_TOKEN_INPUT_PREFIX="令牌：",n.MAKAI_MODAL_CONTENT_DELETION_CONFIRMATION="确定要删除这条评论吗？",n.MAKAI_MODAL_CONTENT_MAKAI_TOKEN_DESC="这是您的 Makai 令牌。\n使用 Makai 令牌可以在《可穿戴科技》发表评论。\n当您第一次发表评论时，系统就会自动生成一个 Makai 令牌。\n您可以通过将这个令牌复制到别的电脑上来实现使用多台设备用一个身份回复。",n.MAKAI_MODAL_CONTENT_DEVELOPMENT_HINT="WTCD 存档同步正在开发中。—— 来自魔法☆少女的玩具 友人♪B"},{}],14:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.stylePreviewArticle=void 0,n.stylePreviewArticle="<h1>午饭</h1>\n<p><em>作者：友人♪B</em></p>\n<p>“午饭，午饭♪”</p>\n<p>阳伞下的琳，很是期待今天的午饭。</p>\n<p>或许是体质和别的血族不太一样，琳能够感知到食物的味道，似乎也保有着生物对食物的喜爱。</p>\n<p>虽然她并不能从这些食物中获取能量就是。</p>\n<p>学校食堂的夏季限定甜点今天也很是抢手，这点从队伍的长度就能看出来——队伍险些就要超出食堂的范围了。</p>\n<p>“你说我要有钱多好——”</p>\n<p>已经从隔壁窗口买下了普通，但是很便宜的营养餐的秋镜悬，看着队伍中兴致勃勃的琳。</p>\n<p>其实她并不是缺钱，大约是吝啬。</p>\n<p>这得怪她娘，穷养秋镜悬养习惯了，现在她光自己除灵退魔挣来的外快都够她奢侈上一把了，可却还保留着能不花钱绝对不花，必须花钱越少越好的吝啬习惯。</p>\n<p>少顷，琳已经带着她的甜品建筑——每块砖头都是一块蛋糕，堆成一个诡异的火柴盒——来到了桌前。</p>\n<p>“（吃不胖真好，有钱真好……”</p>\n<p>血族的听觉自然是捕捉到了秋镜悬的嘀咕，琳放下盘子，悄咪咪地将牙贴上了秋镜悬的脖颈。</p>\n<p>“嘻嘻♪”</p>\n<p>“呜——”</p>\n<p>盯——</p>\n<p>秋镜悬看了看盘中剩下的一块毛血旺，似是联系到了什么，将目光转向了琳的牙。</p>\n<p>正在享用蛋糕盛宴的琳以余光瞥见了她的视线，</p>\n<p>“盯着本小姐是要做什么呢？”</p>\n<p>“啊，没，没什么……”</p>\n<p>秋镜悬支支吾吾的说着，</p>\n<p>“就是好奇一个问题，血族为什么不吃毛血旺……”</p>\n<p>“噢☆毛血旺就是那个煮熟的血块是吧？太没有美感了这种血！而且吃了也没法儿恢复能量，简直就是血液的绝佳浪费☆！”</p>\n<p>琳发出了对这样美食的鄙视，不过这种鄙视大约只有血族和蚊子会出现吧……</p>\n<p>“血族需要摄入血，是因为血所具有的生命能量，如果煮熟了的话，超过九成的能量都被转化成其他的东西了，对我们来说实在是没什么用处，还白白浪费了作为原料的血，这种东西本小姐才不吃咧✘！饿死，死外边，从这边跳下去也不吃✘！”</p>\n<p>“欸，别这么说嘛，你能尝得到味道的吧，吃一块试试呗？”</p>\n<p>“真……真香♪”</p>\n<p>当晚，因为触发了真香定律而感到很火大的琳，把秋镜悬丢进了自己的高维空间里头放置了一晚上（高维时间三天）泄愤。</p>"},{}],15:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.thanks=void 0,n.thanks=[{name:"神楽坂 立音"},{name:"lgd_小翅膀"},{name:"青葉"},{name:"kn"},{name:"F74nk",link:"https://t.me/F74nk_K"},{name:"杨佳文"},{name:"不知名的N姓人士就好"},{name:"某不愿透露姓名的N性？"},{name:"神楽坂 萌绫"},{name:"Butby"},{name:"友人♪B"},{name:"NekoCaffeine"},{name:"RainSlide"},{name:"czp",link:"https://www.hiczp.com"},{name:"kookxiang"},{name:"櫻川 紗良"},{name:"Skimige"},{name:"TExL",link:"http://texas.penguin-logistics.cn"},{name:"路人乙"},{name:"pokemonchw",link:"https://github.com/pokemonchw"},{name:"帕蒂卡",link:"https://github.com/Patika-ailemait"},{name:"零件",link:"https://nekosc.com"},{name:"幻梦",link:"https://t.me/HuanmengQwQ"},{name:"acted咕咕喵",link:"https://acted.gitlab.io"},{name:"重水时雨",link:"https://t.me/boatmasteronD2O"},{name:"神楽坂 紫"},{name:"Runian Lee",link:"https://t.me/Runian"},{name:"琥珀"},{name:"为霜"},{name:"冰蓮音"},{name:"Testingdoll01"}].sort(()=>Math.random()-.5)},{}],16:[function(e,t,n){"use strict";function solveQuad(e,t,n){const i=t**2-4*e*n;return(-t+function sign(e){return e>0?1:e<0?-1:0}(e)*i**.5)/(2*e)}Object.defineProperty(n,"__esModule",{value:!0}),n.MonoDimensionTransitionControl=void 0;n.MonoDimensionTransitionControl=class MonoDimensionTransitionControl{constructor(e,t){this.lastValue=e,this.initialTime=0,this.reverseTime=0,this.reverseValue=0,this.reverseVelocity=0,this.lastStartingVelocity=0,this.finalTime=0,this.finalValue=0,this.acceleration=0,this.finalValue=e,this.acceleration=t/1e3/1e3}setTarget(e){this.lastValue=this.getValue();const t=e-this.lastValue;if(0===t)return;const n=Date.now(),i=this.getVelocity(n);let a=solveQuad(this.acceleration,2*i,.5*i**2/this.acceleration-t);(Number.isNaN(a)||a<0)&&(this.acceleration=-this.acceleration,a=solveQuad(this.acceleration,2*i,.5*i**2/this.acceleration-t));const s=this.acceleration;this.initialTime=n,this.reverseTime=this.initialTime+a,this.reverseValue=this.lastValue+.5*s*a**2+i*a,this.reverseVelocity=i+s*a,this.finalTime=this.reverseTime+a+i/s,this.lastStartingVelocity=i,this.finalValue=e}getVelocity(e=Date.now()){return e<this.reverseTime?this.lastStartingVelocity+(e-this.initialTime)*this.acceleration:e<this.finalTime?this.lastStartingVelocity+(2*this.reverseTime-this.initialTime-e)*this.acceleration:0}getValue(e=Date.now()){if(e<this.reverseTime){const t=e-this.initialTime;return this.lastValue+.5*this.acceleration*t**2+this.lastStartingVelocity*t}if(e<this.finalTime){const t=e-this.reverseTime;return this.reverseValue-.5*this.acceleration*t**2+this.reverseVelocity*t}return this.finalValue}isFinished(e=Date.now()){return e>=this.finalTime}}},{}],17:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.WTCDFeatureProvider=void 0;const i=e("../../wtcd/FeatureProvider"),a=e("../util/resolvePath"),s=e("../DebugLogger"),l=e("../data/AutoCache"),c=e("../util/loadGooleFonts"),u=e("../constant/messages"),d=new s.DebugLogger("WTCD Feature Provider"),p=new l.AutoCache(e=>new Promise((t,n)=>{const i=document.createElement("img");i.onload=()=>t(i),i.onerror=()=>n(new Error(`Failed to load ${e}.`)),i.src=e}),new s.DebugLogger("WTCD Image Cache")),g=new l.AutoCache(e=>{const t=e.indexOf(":");if(-1===t)return Promise.reject(new Error('Cannot find mode separator ":".'));const n=e.substr(0,t);return"googleFonts"!==n?Promise.reject(new Error(`Unknown mode: "${n}".`)):c.loadGoogleFonts(e.substr(t+1))},new s.DebugLogger("WTCD Font Cache"));class WTCDFeatureProvider extends i.FeatureProvider{constructor(e){super(),this.chapter=e}loadImage(e){if(!e.startsWith("./"))return Promise.reject(new Error(`Path has to be relative and start with "./". Received: "${e}"`));let t=a.resolvePath("chapters",this.chapter.htmlRelativePath,"..",e.substr(2));return null===t?Promise.reject(new Error(`Failed to resolve path: "${e}".`)):(t="/"+t,d.log("Resolved from:",e,"to:",t),p.get(t))}loadFont(e){return g.get(e)}drawLoadingCanvas(e){const t=e.getContext("2d");t.font=e.width/40+"px sans-serif",t.textAlign="center",t.textBaseline="middle",t.strokeStyle="rgba(0,0,0,0.8)",t.lineJoin="round",t.lineCap="round",t.lineWidth=e.width/200,t.strokeText(u.WTCD_CANVAS_LOADING,e.width/2,e.height/2),t.fillStyle="white",t.fillText(u.WTCD_CANVAS_LOADING,e.width/2,e.height/2)}}n.WTCDFeatureProvider=WTCDFeatureProvider},{"../../wtcd/FeatureProvider":67,"../DebugLogger":8,"../constant/messages":13,"../data/AutoCache":35,"../util/loadGooleFonts":60,"../util/resolvePath":63}],18:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.WTCDGameReaderUI=void 0;const i=e("../../wtcd/GameReader"),a=e("../constant/messages"),s=e("../data/settings"),l=e("../DebugLogger"),c=e("../hs"),u=e("../util/formatTime"),d=e("./createWTCDErrorMessageFromError"),p=e("./hintControl"),g=e("./modalControl"),m=e("../../wtcd/FeatureProvider"),E=new l.DebugLogger("WTCD Game Reader UI");n.WTCDGameReaderUI=class WTCDGameReaderUI{constructor(e,t,n,l,T,f=m.defaultFeatureProvider){this.content=e,this.slideAnimation=n,this.elementPreprocessor=T,this.mainBlock=null,this.started=!1,this.onClickRestart=()=>{const e=new g.Modal(c.h("div",[c.h("h1",a.WTCD_GAME_RESTART_TITLE),c.h("p",a.WTCD_GAME_RESTART_DESC),c.h("ul",[c.h("li",a.WTCD_GAME_RESTART_ALL_DESC),c.h("li",a.WTCD_GAME_RESTART_DECISION_ONLY_DESC)]),c.h(".button-container",[c.h("div",{onclick:()=>{this.reader.reset(!0),p.createHint(a.WTCD_GAME_RESTART_OK,1e3),e.close()}},a.WTCD_GAME_RESTART_ALL),c.h("div",{onclick:()=>{this.reader.reset(!1),p.createHint(a.WTCD_GAME_RESTART_OK,1e3),e.close()}},a.WTCD_GAME_RESTART_DECISION_ONLY),c.h("div",{onclick:()=>e.close()},a.WTCD_GAME_RESTART_CANCEL)])]));e.setDismissible(),e.open()},this.onClickSave=()=>{const e=new g.Modal(c.h("div",[c.h("h1",a.WTCD_GAME_SAVE_TITLE),c.h(".wtcd-save-button-list",this.reader.getSaves().map((t,n)=>0===n?null:null===t?c.h(".new",{onclick:()=>{this.reader.save(n),p.createHint(a.WTCD_GAME_SAVE_OK,1e3),e.close()}},a.WTCD_GAME_SAVE_NEW):c.h(".save",{onclick:()=>{g.confirm(a.WTCD_GAME_SAVE_OVERWRITE_TITLE,"",a.WTCD_GAME_SAVE_OVERWRITE_CONFIRM,a.WTCD_GAME_SAVE_OVERWRITE_CANCEL).then(t=>{t&&(this.reader.save(n),p.createHint(a.WTCD_GAME_SAVE_OK,1e3),e.close())})}},[c.h(".id",String(n)),c.h(".info",[c.h(".state-desc",""===t.desc?a.WTCD_GAME_NO_DESC:t.desc),c.h(".date",u.formatTimeSimple(t.date))])]))),c.h(".button-container",{style:{"margin-top":"1.2vh"}},[c.h("div",{onclick:()=>e.close()},a.WTCD_GAME_SAVE_CANCEL)])]));e.setDismissible(),e.open()},this.onClickLoad=()=>{const e=new g.Modal(c.h("div",[c.h("h1",a.WTCD_GAME_LOAD_TITLE),c.h(".wtcd-save-button-list",this.reader.getSaves().map((t,n)=>null===t?null:c.h(".save",{onclick:()=>{this.reader.load(n),p.createHint(a.WTCD_GAME_LOAD_OK,1e3),e.close()}},[0!==n?c.h(".id",String(n)):c.h(".small.id",a.WTCD_GAME_LOAD_QUICK),c.h(".info",[c.h(".state-desc",""===t.desc?a.WTCD_GAME_NO_DESC:t.desc),c.h(".date",u.formatTimeSimple(t.date))])]))),c.h(".button-container",{style:{"margin-top":"1.2vh"}},[c.h("div",{onclick:()=>e.close()},a.WTCD_GAME_LOAD_CANCEL)])]));e.setDismissible(),e.open()},this.onClickQuickSave=()=>{this.reader.save(0),p.createHint(a.WTCD_GAME_QUICK_SAVE_OK,1e3)},this.onClickQuickLoad=()=>{null!==this.reader.getSaves()[0]?s.wtcdGameQuickLoadConfirm.getValue()?g.confirm(a.WTCD_GAME_QUICK_LOAD_CONFIRM_TITLE,a.WTCD_GAME_QUICK_LOAD_CONFIRM_DESC,a.WTCD_GAME_QUICK_LOAD_CONFIRM_CONFIRM,a.WTCD_GAME_QUICK_LOAD_CONFIRM_CANCEL).then(e=>{e&&(this.reader.load(0),p.createHint(a.WTCD_GAME_QUICK_LOAD_OK,1e3))}):(this.reader.load(0),p.createHint(a.WTCD_GAME_QUICK_LOAD_OK,1e3)):p.createHint(a.WTCD_GAME_QUICK_LOAD_NOT_EXIST,3e3)},this.onOutput=e=>{this.elementPreprocessor(e),null===this.mainBlock?(E.log("Initialize main block."),this.mainBlock=this.content.addBlock({initElement:e,slidable:!0})):(E.log("Updating main block."),this.content.scrollTo(this.controlsBlock.element.offsetTop),this.slideAnimation?this.mainBlock.slideReplace(e):this.mainBlock.directReplace(e))},this.onError=e=>{E.warn("Game reader reported error."),this.content.addBlock({initElement:d.createWTCDErrorMessageFromError(e)})},this.reader=new i.GameReader(t,l,this.onOutput,this.onError,f)}start(){if(this.started)throw new Error("Already started.");this.started=!0,this.controlsBlock=this.content.addBlock({initElement:c.h("div.wtcd-game-control",c.h(".button-container",[c.h("div",{onclick:this.onClickRestart},a.WTCD_GAME_RESTART),c.h("div",{onclick:this.onClickSave},a.WTCD_GAME_SAVE),c.h("div",{onclick:this.onClickLoad},a.WTCD_GAME_LOAD),c.h("div",{onclick:this.onClickQuickSave},a.WTCD_GAME_QUICK_SAVE),c.h("div",{onclick:this.onClickQuickLoad},a.WTCD_GAME_QUICK_LOAD)]))});const e=Date.now();this.reader.start(),E.log(`Game loaded in ${Date.now()-e}ms.`)}}},{"../../wtcd/FeatureProvider":67,"../../wtcd/GameReader":69,"../DebugLogger":8,"../constant/messages":13,"../data/settings":37,"../hs":39,"../util/formatTime":59,"./createWTCDErrorMessageFromError":25,"./hintControl":27,"./modalControl":31}],19:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const i=e("../data/AutoCache"),a=e("../data/state"),s=e("../DebugLogger"),l=e("./chapterControl"),c=new i.AutoCache(e=>fetch("https://wta.makai.city/count",{method:"POST",body:e}),new s.DebugLogger("Analytics Cache"));l.loadChapterEvent.on(e=>{setTimeout(()=>{var t;(null===(t=a.state.currentChapter)||void 0===t?void 0:t.chapter.htmlRelativePath)===e&&c.get(e)},5e3)})},{"../DebugLogger":8,"../data/AutoCache":35,"../data/state":38,"./chapterControl":20}],20:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ErrorType=n.loadChapter=n.loadNextChapter=n.loadPrevChapter=n.implicitCloseChapter=n.closeChapter=n.loadChapterEvent=void 0;const i=e("../../wtcd/FlowReader"),a=e("../constant/loadingText"),s=e("../constant/messages"),l=e("../data/AutoCache"),c=e("../data/data"),u=e("../data/settings"),d=e("../data/state"),p=e("../DebugLogger"),g=e("../Event"),m=e("../hs"),E=e("../input/gestures"),T=e("../input/keyboard"),f=e("../util/DOM"),_=e("./commentsControl"),v=e("./contactInfoControl"),C=e("./contentControl"),A=e("./createWTCDErrorMessage"),y=e("./createWTCDErrorMessageFromError"),M=e("./history"),I=e("./layoutControl"),b=e("./modalControl"),L=e("./processElements"),O=e("./WTCDFeatureProvider"),w=e("./WTCDGameReaderUI"),N=new p.DebugLogger("Chapter Control");function closeChapter(){I.setLayout(I.Layout.OFF),implicitCloseChapter()}function implicitCloseChapter(){d.state.currentChapter=null,d.state.chapterSelection=null,d.state.chapterTextNodes=null}n.loadChapterEvent=new g.Event,n.closeChapter=closeChapter,n.implicitCloseChapter=implicitCloseChapter;const select=([e,t,n,i])=>{if(null===d.state.chapterTextNodes)return;const a=d.state.chapterTextNodes[e],s=d.state.chapterTextNodes[n];if(void 0===a||void 0===s)return;document.getSelection().setBaseAndExtent(a,t,s,i);const l=a.parentElement;null!==l&&"function"==typeof l.scrollIntoView&&l.scrollIntoView()},canChapterShown=e=>(u.earlyAccess.getValue()||!e.isEarlyAccess)&&!e.hidden;function findNextChapter(e){const t=e.inFolderIndex,n=e.folder.children;for(let e=t+1;e<n.length;e++){const t=n[e];if("folder"!==t.type&&canChapterShown(t))return t}return null}function findPreviousChapter(e){const t=e.inFolderIndex,n=e.folder.children;for(let e=t-1;e>=0;e--){const t=n[e];if("folder"!==t.type&&canChapterShown(t))return t}return null}function loadPrevChapter(){const e=d.state.currentChapter;if(null===e)return;const t=findPreviousChapter(e);null!==t&&(loadChapter(t.htmlRelativePath,void 0,C.Side.LEFT),M.updateHistory(!0))}function loadNextChapter(){const e=d.state.currentChapter;if(null===e)return;const t=findNextChapter(e);null!==t&&(loadChapter(t.htmlRelativePath,void 0,C.Side.RIGHT),M.updateHistory(!0))}n.loadPrevChapter=loadPrevChapter,n.loadNextChapter=loadNextChapter;const S=new l.AutoCache(e=>{const t="./chapters/"+e;return N.log(`Loading chapter from ${t}.`),fetch(t).then(e=>e.text())},new p.DebugLogger("Chapters Cache"));function loadChapter(e,t,l=C.Side.LEFT){N.log("Load chapter",e,"with selection",t),n.loadChapterEvent.emit(e),window.localStorage.setItem("lastRead",e);const u=c.relativePathLookUpMap.get(e);d.state.currentChapter=u;const p=C.newContent(l);u.chapter.isEarlyAccess&&p.addBlock({initElement:m.h("div",[m.h("h1",s.EARLY_ACCESS_TITLE),m.h("p",s.EARLY_ACCESS_DESC)]),style:C.ContentBlockStyle.WARNING});const g=p.addBlock({initElement:m.h(".content")});I.setLayout(I.Layout.MAIN),g.element.innerText=a.loadingText,S.get(e).then(e=>{if(p.isDestroyed)return void N.log("Chapter loaded, but abandoned since the original content page is already destroyed.");N.log("Chapter loaded."),g.directRemove();const n=function insertContent(e,t,n){switch(n.type){case"Markdown":const a=e.addBlock();return a.element.innerHTML=t,L.processElements(a.element),a;case"WTCD":{const a=JSON.parse(t);if(!0===a.error){e.addBlock({initElement:A.createWTCDErrorMessage({errorType:D.COMPILE,message:a.message,internalStack:a.internalStack})});break}const s=new O.WTCDFeatureProvider(n);switch(n.preferredReader){case"flow":{const t=new i.FlowReader(n.htmlRelativePath,a.wtcdRoot,y.createWTCDErrorMessageFromError,L.processElements,s),l=e.addBlock().element;t.renderTo(l);break}case"game":new w.WTCDGameReaderUI(e,n.htmlRelativePath,n.slideAnimation,a.wtcdRoot,L.processElements,s).start()}}}}(p,e,u.chapter),a=null!=n?n:p.addBlock();if(d.state.chapterTextNodes=f.getTextNodes(a.element),void 0!==t&&(null===f.id("warning")?select(t):f.id("warning").addEventListener("click",()=>{select(t)})),u.chapter.authors.length>0){const e=m.h(".authors",m.h(".outer-container",...u.chapter.authors.map(e=>{var t;const n=null!==(t=c.authorInfoMap.get(e.name))&&void 0!==t?t:{name:e.name,avatar:"https://ui-avatars.com/api/?name="+encodeURIComponent(e.name)};return m.h(".author-container",m.h("img.avatar",{src:n.avatar}),m.h(".author-role-container",m.h(".role",e.role),m.h(".name",n.name)))})));void 0===n?p.addBlock({initElement:e,prepend:!0}):f.insertAfterH1(e,n.element)}const l=findPreviousChapter(u),E=findNextChapter(u);a.element.appendChild(m.h("div.page-switcher",[null!==l?m.h("a.to-prev",{href:window.location.pathname+"#"+l.htmlRelativePath,onclick:e=>{e.preventDefault(),loadPrevChapter()}},s.PREVIOUS_CHAPTER):null,m.h("a.to-menu",{href:window.location.pathname,onclick:e=>{e.preventDefault(),closeChapter(),M.updateHistory(!0)}},s.GO_TO_MENU),null!==E?m.h("a.to-next",{href:window.location.pathname+"#"+E.htmlRelativePath,onclick:e=>{e.preventDefault(),loadNextChapter()}},s.NEXT_CHAPTER):null])),setTimeout(()=>{C.focus()},1),v.loadContactInfo(p),_.loadChapterComments(p)}).catch(e=>{N.error("Failed to load chapter.",e),g.element.innerText=s.CHAPTER_FAILED})}var D;n.loadChapter=loadChapter,E.swipeEvent.on(e=>{u.gestureSwitchChapter.getValue()&&(e===E.SwipeDirection.TO_RIGHT?loadPrevChapter():e===E.SwipeDirection.TO_LEFT&&loadNextChapter())}),T.arrowKeyPressEvent.on(e=>{b.isAnyModalOpened()||(e===T.ArrowKey.LEFT?loadPrevChapter():e===T.ArrowKey.RIGHT&&loadNextChapter())}),T.escapeKeyPressEvent.on(()=>{b.isAnyModalOpened()||(closeChapter(),M.updateHistory(!0))}),function(e){e[e.COMPILE=0]="COMPILE",e[e.RUNTIME=1]="RUNTIME",e[e.INTERNAL=2]="INTERNAL"}(D=n.ErrorType||(n.ErrorType={}))},{"../../wtcd/FlowReader":68,"../DebugLogger":8,"../Event":9,"../constant/loadingText":11,"../constant/messages":13,"../data/AutoCache":35,"../data/data":36,"../data/settings":37,"../data/state":38,"../hs":39,"../input/gestures":41,"../input/keyboard":42,"../util/DOM":57,"./WTCDFeatureProvider":17,"./WTCDGameReaderUI":18,"./commentsControl":21,"./contactInfoControl":22,"./contentControl":23,"./createWTCDErrorMessage":24,"./createWTCDErrorMessageFromError":25,"./history":28,"./layoutControl":29,"./modalControl":31,"./processElements":32}],21:[function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(a,s){function fulfilled(e){try{step(i.next(e))}catch(e){s(e)}}function rejected(e){try{step(i.throw(e))}catch(e){s(e)}}function step(e){e.done?a(e.value):function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(fulfilled,rejected)}step((i=i.apply(e,t||[])).next())}))};Object.defineProperty(n,"__esModule",{value:!0}),n.loadRecentMentions=n.loadRecentComments=n.loadChapterComments=n.recentCommentsUrl=n.chapterCommentsUrl=n.promptComment=n.sendComment=n.createToMenuButton=n.commentsCache=void 0;const a=e("../constant/messages"),s=e("../data/AutoCache"),l=e("../data/settings"),c=e("../data/state"),u=e("../DebugLogger"),d=e("../hs"),p=e("../util/formatTime"),g=e("../util/padName"),m=e("./chapterControl"),E=e("./history"),T=e("./makaiControl"),f=e("./modalControl"),_=e("./userControl"),v=new u.DebugLogger("Comments Control");function createCommentElement(e,t,s){var l;const c=e.pageName;void 0===c&&v.warn("Unknown page name.");const u=e.user.login===(null===(l=T.getUsername())||void 0===l?void 0:l.toLowerCase())?d.h("a.action",{onclick:()=>{(function promptDeleteComment(e,t){return i(this,void 0,void 0,(function*(){if(yield f.confirm(a.MAKAI_MODAL_TITLE_WARNING,a.MAKAI_MODAL_CONTENT_DELETION_CONFIRMATION,a.MAKAI_MODAL_CONFIRM,a.MAKAI_MODAL_CANCEL)){const i=_.showLoading(a.MAKAI_INFO_CONFIRM_TOKEN);try{const s=yield fetch(T.makaiUrl+"/comment/"+t+"/"+T.getToken(),{cache:"no-cache",credentials:"same-origin",headers:new Headers({"Content-Type":"application/json"}),method:"DELETE",mode:"cors",redirect:"follow",referrer:"no-referrer"}).then(e=>e.json());return i.close(),s.success?(n.commentsCache.delete("https://c.makai.city/comment/recent/github/50"),n.commentsCache.delete(chapterCommentsUrl(e)),!0):(_.showMessage(a.MAKAI_ERROR_DELETE_COMMENT_INVALID_TOKEN),!1)}catch(e){return _.showMessage(a.MAKAI_ERROR_INTERNET),v.error(e),!1}finally{i.close()}}return!1}))})(c,e.id).then(e=>{e&&m.remove()})}},a.MAKAI_BUTTON_DELETE):c&&d.h("a.action",{onclick:()=>{promptComment(c,"@"+e.user.login+" ").then(e=>{e&&t()})}},a.MAKAI_BUTTON_REPLY),m=d.h(".comment",[d.h("img.avatar",{src:e.user.avatar_url}),d.h("a.author",{target:"_blank",href:e.user.html_url,rel:"noopener noreferrer"},e.user.display),d.h(".time",a.MAKAI_SUBMITTED_0+g.padName(e.user.login)+a.MAKAI_SUBMITTED_1+(e.created_at===e.updated_at?p.formatTimeRelative(new Date(e.created_at)):""+p.formatTimeRelative(new Date(e.created_at))+a.MAKAI_GENERIC_LAST_MODIFIED+p.formatTimeRelative(new Date(e.updated_at))+a.MAKAI_GENERIC_LAST_MODIFIED_SUFFIX)),u,...e.body.split("\n\n").map(e=>d.h("p",e)),s?d.h("p",d.h("a.page-name",{href:"#"+c},"发表于"+g.padName(c.replace(/\//g," > ").replace(/-/g," ").replace(/\.html$/,"")))):null]);return m}function loadComments(e,t,i,s,l,c=!0,u){const p=d.h("p",a.COMMENTS_LOADING),g=d.h(".comments",[d.h("h1",i),p]),m=e.addBlock({initElement:g});return m.onEnteringView(()=>{n.commentsCache.get(t).then(t=>{if(e.isDestroyed)return void v.log("Comments loaded, but abandoned since the original content page is already destroyed.");v.log("Comments loaded."),p.innerText=s;const appendCreateComment=e=>{g.appendChild(d.h(".create-comment",{onclick:()=>{promptComment(e).then(e=>{e&&l()})}},a.COMMENTS_CREATE))};void 0!==u&&t.length>=6&&appendCreateComment(u),t.forEach(e=>{g.appendChild(createCommentElement(e,l,void 0===u))}),void 0!==u&&appendCreateComment(u)}).catch(e=>{p.innerText=a.COMMENTS_FAILED,v.error("Failed to load comments.",e)}).then(()=>{c&&g.appendChild(createToMenuButton())})}),m}function createToMenuButton(){return d.h("div.page-switcher",[d.h("a.to-menu",{href:window.location.pathname,onclick:e=>{e.preventDefault(),m.closeChapter(),E.updateHistory(!0)}},a.GO_TO_MENU)])}function sendComment(e,t,s){return i(this,void 0,void 0,(function*(){const i=_.showLoading(a.MAKAI_INFO_CONFIRM_TOKEN);try{return(yield fetch(T.makaiUrl+"/comment/"+e,{body:JSON.stringify({pageName:t,content:s}),cache:"no-cache",credentials:"same-origin",headers:new Headers({"Content-Type":"application/json"}),method:"POST",mode:"cors",redirect:"follow",referrer:"no-referrer"}).then(e=>e.json())).success?(n.commentsCache.delete("https://c.makai.city/comment/recent/github/50"),n.commentsCache.delete(chapterCommentsUrl(t)),!0):(_.showMessage(a.MAKAI_ERROR_SUBMIT_COMMENT_INVALID_TOKEN),!1)}catch(e){return _.showMessage(a.MAKAI_ERROR_INTERNET),v.error(e),!1}finally{i.close()}}))}function promptComment(e,t){return new Promise((n,s)=>{const l=d.h("input"),c=d.h("input"),u=T.hasToken()?d.h("p",[a.MAKAI_SUBMIT_0+g.padName(T.getUsername())+a.MAKAI_SUBMIT_1]):[d.h(".input-group",[d.h("span",a.MAKAI_MODAL_CONTENT_NAME_INPUT_PREFIX),l]),d.h(".input-group",[d.h("span",a.MAKAI_MODAL_CONTENT_EMAIL_INPUT_PREFIX),c])],p=d.h("textarea.makai-comment");void 0!==t&&(p.value=t);const onSubmit=()=>i(this,void 0,void 0,(function*(){if(!T.hasToken()){const e=_.showLoading(a.MAKAI_INFO_OBTAIN_TOKEN),t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";try{const n=yield fetch(T.makaiUrl+"/register/",{body:JSON.stringify({username:l.value,email:c.value,encodedPassword:new Array(20).fill(void 0).map(()=>t[Math.floor(Math.random()*t.length)]).join("")}),cache:"no-cache",headers:new Headers({"Content-Type":"application/json"}),credentials:"same-origin",method:"POST",mode:"cors",redirect:"follow",referrer:"no-referrer"}),i=yield n.json();if(!i.success){switch(i.errorMessage){case"Illegal email format.":_.showMessage(a.MAKAI_ERROR_INVALID_EMAIL);break;case"User exist.":_.showMessage(a.MAKAI_ERROR_USER_EXIST);break;default:_.showMessage(a.MAKAI_ERROR_UNKNOWN)}return!1}if(null===i.accessToken)return _.showMessage(a.MAKAI_ERROR_UNKNOWN),!1;T.saveToken(i.accessToken),T.saveUsername(l.value)}catch(e){return _.showMessage(a.MAKAI_ERROR_INTERNET),v.error(e),!1}finally{e.close()}}return sendComment(T.getToken(),e,p.value)})),m=new f.Modal(d.h("div",[d.h("h1",a.MAKAI_MODAL_TITLE_COMMENT),d.h("p",a.MAKAI_MODAL_CONTENT_COMMENT_HINT),p,u,d.h(".button-container",[d.h("div",{onclick:()=>{onSubmit().then(e=>(e&&(m.close(),n(!0)),e)).catch(s)}},a.MAKAI_MODAL_SUBMIT),d.h("div",{onclick:()=>{""===p.value?(m.close(),n(!1)):f.confirm(a.MAKAI_MODAL_CONFIRM_LOSS_EDITED,"",a.MAKAI_MODAL_CONFIRM_LOSS_EDITED_YES,a.MAKAI_MODAL_CONFIRM_LOSS_EDITED_NO).then(e=>{e&&(m.close(),n(!1))})}},a.MAKAI_MODAL_CANCEL)])]));m.open(),p.focus(),p.addEventListener("input",()=>{p.style.height="auto",p.style.height=Math.max(120,p.scrollHeight)+"px"},!1)})}function chapterCommentsUrl(e){return T.makaiUrl+"/comment/github/"+encodeURIComponent(e)+"/"}function recentCommentsUrl(){return"https://c.makai.city/comment/recent/github/50"}n.commentsCache=new s.AutoCache(e=>(v.log(`Loading comments from ${e}.`),fetch(e).then(e=>e.json())),new u.DebugLogger("Comments Cache")),n.createToMenuButton=createToMenuButton,n.sendComment=sendComment,n.promptComment=promptComment,n.chapterCommentsUrl=chapterCommentsUrl,n.recentCommentsUrl=recentCommentsUrl,n.loadChapterComments=function loadChapterComments(e){if(!1===l.useComments.getValue())return;let t=null;const n=c.state.currentChapter.chapter.htmlRelativePath;!function load(){null!==t&&t.directRemove(),t=loadComments(e,chapterCommentsUrl(n),a.COMMENTS_SECTION,a.COMMENTS_LOADED,load,!1,c.state.currentChapter.chapter.htmlRelativePath)}()},n.loadRecentComments=function loadRecentComments(e){let t=null;!function load(){null!==t&&t.directRemove(),t=loadComments(e,"https://c.makai.city/comment/recent/github/50",a.COMMENTS_RECENT_SECTION,a.COMMENTS_RECENT_LOADED,load)}()},n.loadRecentMentions=function loadRecentMentions(e,t){loadComments(e,"https://c.makai.city/mentions?token="+t,a.COMMENTS_MENTION_SECTION,a.COMMENTS_MENTION_LOADED,()=>{f.notify(a.COMMENTS_MENTION_REPLIED_TITLE,"",a.COMMENTS_MENTION_REPLIED_OK)})}},{"../DebugLogger":8,"../constant/messages":13,"../data/AutoCache":35,"../data/settings":37,"../data/state":38,"../hs":39,"../util/formatTime":59,"../util/padName":62,"./chapterControl":20,"./history":28,"./makaiControl":30,"./modalControl":31,"./userControl":34}],22:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.loadContactInfo=void 0;const i=e("../data/settings"),a=e("../hs");n.loadContactInfo=function loadContactInfo(e){if(!i.contactInfo.getValue())return;const t=e.addBlock({initElement:a.h("div",a.h("h3","欢迎加入《可穿戴科技》相关讨论组"),a.h("ul",a.h("li","Telegram 群：",a.h("a.regular",{href:"https://t.me/joinchat/Dt8_WlJnmEwYNbjzlnLyNA",target:"_blank"},"https://t.me/joinchat/Dt8_WlJnmEwYNbjzlnLyNA")),a.h("li.regular","Telegram 频道：",a.h("a.regular",{href:"https://t.me/joinchat/AAAAAEpkRVwZ-3s5V3YHjA",target:"_blank"},"https://t.me/joinchat/AAAAAEpkRVwZ-3s5V3YHjA")),a.h("li","QQ 群（禁止色情/政治）：462213854")),a.h("a.regular",{href:"#",onclick:e=>{e.preventDefault(),t.directRemove(),i.contactInfo.setValue(!1)}},"点此永久关闭本提示"))})}},{"../data/settings":37,"../hs":39}],23:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ContentBlock=n.Content=n.ContentBlockStyle=n.newContent=n.focus=n.getCurrentContent=n.Side=void 0;const i=e("../data/settings"),a=e("../DebugLogger"),s=e("../hs"),l=e("../input/keyboard"),c=e("../util/DOM"),u=e("./layoutControl"),d=e("./MonoDimensionTransitionControl"),p=c.id("content-container"),g=new a.DebugLogger("Content Control");var m;function setSide(e,t){t===m.LEFT?(e.classList.add("left"),e.classList.remove("right")):(e.classList.add("right"),e.classList.remove("left"))}!function(e){e[e.LEFT=0]="LEFT",e[e.RIGHT=1]="RIGHT"}(m=n.Side||(n.Side={}));let E=null;var T;n.getCurrentContent=function getCurrentContent(){return E},n.focus=function focus(){null!==E&&E.element.focus({preventScroll:!0})},n.newContent=function newContent(e){const t=new Content;if(u.getCurrentLayout()===u.Layout.OFF)null!==E&&E.destroy();else if(i.animation.getValue()){if(null!==E){setSide(E.element,function otherSide(e){return e===m.LEFT?m.RIGHT:m.LEFT}(e));const t=E;setTimeout(()=>{t.destroy()},2500)}setSide(t.element,e),t.element.offsetWidth,t.element.classList.remove("left","right")}else null!==E&&E.destroy();return E=t,t},function(e){e[e.REGULAR=0]="REGULAR",e[e.WARNING=1]="WARNING"}(T=n.ContentBlockStyle||(n.ContentBlockStyle={}));class Content{constructor(){this.isDestroyed=!1,this.blocks=[],this.scrollTransition=null,this.onKeyPress=e=>{e!==l.ArrowKey.UP&&e!==l.ArrowKey.DOWN||this.interruptScrolling()},this.interruptScrolling=()=>{null!==this.scrollTransition&&(this.scrollTransition=null,g.log("Transition interrupted."))},this.scrollAnimation=()=>{if(null===this.scrollTransition)return;const e=Date.now();this.element.scrollTop=this.scrollTransition.getValue(e),this.scrollTransition.isFinished(e)?(g.log("Transition finished."),this.scrollTransition=null):requestAnimationFrame(this.scrollAnimation)};const e=s.h("div.content",{tabIndex:-1});p.appendChild(e),this.element=e,window.addEventListener("wheel",this.interruptScrolling),l.arrowKeyPressEvent.on(this.onKeyPress)}addBlock(e={}){const t=new ContentBlock(this,e);return this.blocks.push(t),t}destroy(){this.isDestroyed=!0,this.element.remove(),window.removeEventListener("wheel",this.interruptScrolling),l.arrowKeyPressEvent.off(this.onKeyPress)}scrollTo(e){if(!i.animation.getValue()||u.getCurrentLayout()===u.Layout.OFF)return g.log(`Scroll to ${e}, no animation.`),void(this.element.scrollTop=e);null===this.scrollTransition?(g.log(`Scrolling to ${e}, new transition stared.`),this.scrollTransition=new d.MonoDimensionTransitionControl(this.element.scrollTop,2e4),this.scrollTransition.setTarget(e),requestAnimationFrame(this.scrollAnimation)):(g.log(`Scrolling to ${e}, existing transition updated.`),this.scrollTransition.setTarget(e))}}n.Content=Content;class ContentBlock{constructor(e,{initElement:t=s.h("div"),style:n=T.REGULAR,slidable:i=!1,prepend:a=!1}){switch(this.slideContainer=null,this.heightHolder=null,this.sliding=0,this.element=t,t.classList.add("content-block"),n){case T.WARNING:t.classList.add("warning")}i?(this.slideContainer=s.h(".slide-container",t),a?e.element.prepend(this.slideContainer):e.element.append(this.slideContainer)):a?e.element.prepend(t):e.element.append(t)}onEnteringView(e){const t=new IntersectionObserver(n=>{n[0].isIntersecting&&(t.disconnect(),e())},{root:p,threshold:0});t.observe(this.element)}directRemove(){null!==this.slideContainer?this.slideContainer.remove():this.element.remove()}directReplace(e=s.h("div")){e.classList.add("content-block"),this.element.parentElement.replaceChild(e,this.element),this.element=e}slideReplace(e=s.h("div")){if(!i.animation.getValue())return void this.directReplace(e);const t=this.slideContainer;if(null===t)throw new Error("Content block is not slidable.");this.sliding++,t.classList.add("in-transition"),e.classList.add("content-block");const n=this.element;e.classList.add("right"),t.prepend(e);const a=e.offsetHeight;e.classList.remove("right"),null===this.heightHolder&&(this.heightHolder=s.h(".height-holder"),this.heightHolder.style.height=n.offsetHeight+"px",t.appendChild(this.heightHolder),this.heightHolder.offsetWidth),this.heightHolder.style.height=a+"px",n.classList.add("left"),this.element=e,setTimeout(()=>{n.remove(),this.sliding--,0===this.sliding&&(t.classList.remove("in-transition"),null!==this.heightHolder&&(this.heightHolder.remove(),this.heightHolder=null))},2500)}}n.ContentBlock=ContentBlock},{"../DebugLogger":8,"../data/settings":37,"../hs":39,"../input/keyboard":42,"../util/DOM":57,"./MonoDimensionTransitionControl":16,"./layoutControl":29}],24:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.createWTCDErrorMessage=void 0;const i=e("../constant/messages"),a=e("./chapterControl");n.createWTCDErrorMessage=function createWTCDErrorMessage({errorType:e,message:t,internalStack:n,wtcdStack:s}){const l=document.createElement("div"),c=document.createElement("h1"),u=document.createElement("p");switch(e){case a.ErrorType.COMPILE:c.innerText=i.WTCD_ERROR_COMPILE_TITLE,u.innerText=i.WTCD_ERROR_COMPILE_TITLE;break;case a.ErrorType.RUNTIME:c.innerText=i.WTCD_ERROR_RUNTIME_TITLE,u.innerText=i.WTCD_ERROR_RUNTIME_DESC;break;case a.ErrorType.INTERNAL:c.innerText=i.WTCD_ERROR_INTERNAL_TITLE,u.innerText=i.WTCD_ERROR_INTERNAL_DESC}l.appendChild(c),l.appendChild(u);const d=document.createElement("p");if(d.innerText=i.WTCD_ERROR_MESSAGE+t,l.appendChild(d),void 0!==s){const e=document.createElement("h2");e.innerText=i.WTCD_ERROR_WTCD_STACK_TITLE,l.appendChild(e);const t=document.createElement("p");t.innerText=i.WTCD_ERROR_WTCD_STACK_DESC,l.appendChild(t);const n=document.createElement("pre"),a=document.createElement("code");a.innerText=s,n.appendChild(a),l.appendChild(n)}if(void 0!==n){const e=document.createElement("h2");e.innerText=i.WTCD_ERROR_INTERNAL_STACK_TITLE,l.appendChild(e);const t=document.createElement("p");t.innerText=i.WTCD_ERROR_INTERNAL_STACK_DESC,l.appendChild(t);const a=document.createElement("pre"),s=document.createElement("code");s.innerText=n,a.appendChild(s),l.appendChild(a)}return l}},{"../constant/messages":13,"./chapterControl":20}],25:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.createWTCDErrorMessageFromError=void 0;const i=e("../../wtcd/WTCDError"),a=e("./chapterControl"),s=e("./createWTCDErrorMessage");n.createWTCDErrorMessageFromError=function createWTCDErrorMessageFromError(e){return s.createWTCDErrorMessage({errorType:e instanceof i.WTCDError?a.ErrorType.RUNTIME:a.ErrorType.INTERNAL,message:e.message,internalStack:e.stack,wtcdStack:e instanceof i.WTCDError?e.wtcdStack:void 0})}},{"../../wtcd/WTCDError":72,"./chapterControl":20,"./createWTCDErrorMessage":24}],26:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.followQuery=void 0;const i=e("../constant/messages"),a=e("../data/data"),s=e("../data/state"),l=e("../pages/pages"),c=e("./chapterControl"),u=e("./contentControl"),d=e("./history"),p=e("./layoutControl"),g=e("./modalControl");n.followQuery=function followQuery(){let e=!1;if(""===window.location.hash)c.closeChapter(),e=!0,document.title=d.getTitle(),d.updateHistory(!1);else{const t=decodeURIComponent(window.location.hash.substr(1));t.startsWith("#")?e=!!t.startsWith("#page/")&&function followQueryToPage(e){c.implicitCloseChapter();for(const t of l.pages)if(e.startsWith(t.name)){const n=u.newContent(u.Side.LEFT);return p.setLayout(p.Layout.MAIN),t.handler(n,e.substr(t.name.length))}return!1}(t.substr(6)):(e=function followQueryToChapter(e){const t=a.relativePathLookUpMap.get(e);if(void 0===t)return!1;const n=null!==s.state.currentChapter&&t.inFolderIndex<s.state.currentChapter.inFolderIndex?u.Side.LEFT:u.Side.RIGHT;if("function"!=typeof URLSearchParams)c.loadChapter(e,void 0,n);else{const t=new URLSearchParams(window.location.search).get("selection"),i=null!==t?t.split(",").map(e=>+e):[];4===i.length&&i.every(e=>e>=0&&e%1==0&&!Number.isNaN(e)&&Number.isFinite(e))?c.loadChapter(e,i,n):c.loadChapter(e,void 0,n)}return!0}(t),document.title=d.getTitle(),d.updateHistory(!1))}e||(g.notify(i.BROKEN_LINK_TITLE,i.BROKEN_LINK_DESC,i.BROKEN_LINK_OK),document.title=d.getTitle(),d.updateHistory(!1))}},{"../constant/messages":13,"../data/data":36,"../data/state":38,"../pages/pages":53,"./chapterControl":20,"./contentControl":23,"./history":28,"./layoutControl":29,"./modalControl":31}],27:[function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(a,s){function fulfilled(e){try{step(i.next(e))}catch(e){s(e)}}function rejected(e){try{step(i.throw(e))}catch(e){s(e)}}function step(e){e.done?a(e.value):function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(fulfilled,rejected)}step((i=i.apply(e,t||[])).next())}))};Object.defineProperty(n,"__esModule",{value:!0}),n.createHint=void 0;const a=e("../hs");let s=Promise.resolve();n.createHint=function createHint(e,t=2e3){s=s.then(()=>i(this,void 0,void 0,(function*(){const n=a.h(".hint",e);document.body.appendChild(n),n.style.opacity="0",n.offsetWidth,n.style.removeProperty("opacity"),yield new Promise(e=>setTimeout(e,t)),n.style.opacity="0",yield new Promise(e=>setTimeout(e,500)),n.remove()})))}},{"../hs":39}],28:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.updateHistory=n.getTitle=void 0;const i=e("../data/state");function getTitle(){let e="可穿戴科技";return null!==i.state.currentChapter&&(e+=" - "+i.state.currentChapter.chapter.displayName),e}n.getTitle=getTitle,n.updateHistory=function updateHistory(e){const t=e?window.history.pushState:window.history.replaceState;let n=window.location.pathname;null!==i.state.currentChapter&&(null!==i.state.chapterSelection&&(n+="?selection="+i.state.chapterSelection.join(",")),n+="#"+i.state.currentChapter.chapter.htmlRelativePath);const a=getTitle();document.title=a,t.call(window.history,null,a,n)}},{"../data/state":38}],29:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.setLayout=n.getCurrentLayout=n.layoutChangeEvent=n.Layout=void 0;const i=e("../DebugLogger"),a=e("../Event");var s;!function(e){e[e.SIDE=0]="SIDE",e[e.MAIN=1]="MAIN",e[e.OFF=2]="OFF"}(s=n.Layout||(n.Layout={}));const l=document.body,c=new i.DebugLogger("Layout");n.layoutChangeEvent=new a.Event,n.layoutChangeEvent.on(({newLayout:e})=>{switch(l.classList.remove("layout-side","layout-main","layout-off"),e){case s.SIDE:l.classList.add("layout-side");break;case s.MAIN:l.classList.add("layout-main");break;case s.OFF:l.classList.add("layout-off")}});let u=s.OFF;n.getCurrentLayout=function getCurrentLayout(){return u},n.setLayout=function setLayout(e){c.log(`${s[u]} -> ${s[e]}`),u!==e&&(n.layoutChangeEvent.emit({previousLayout:u,newLayout:e}),u=e)}},{"../DebugLogger":8,"../Event":9}],30:[function(e,t,n){"use strict";function tokenToUsername(e){return null}Object.defineProperty(n,"__esModule",{value:!0}),n.hasToken=n.getUsername=n.getToken=n.saveUsername=n.saveToken=n.validToken=n.tokenToUsername=n.makaiUrl=void 0,n.makaiUrl="https://c.makai.city",n.tokenToUsername=tokenToUsername,n.validToken=function validToken(e){return!1},n.saveToken=function saveToken(e){window.localStorage.setItem("token",e)},n.saveUsername=function saveUsername(e){window.localStorage.setItem("username",e)},n.getToken=function getToken(){return window.localStorage.getItem("token")},n.getUsername=function getUsername(){return window.localStorage.getItem("username")},n.hasToken=function hasToken(){return null!==window.localStorage.getItem("token")}},{}],31:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.isAnyModalOpened=n.notify=n.confirm=n.Modal=void 0;const i=e("../data/settings"),a=e("../hs"),s=e("../input/keyboard"),l=e("../util/DOM").id("modal-holder");class Modal{constructor(e=a.h("div")){this.dismissSet=!1,this.escKeyListener=null,e.classList.add("modal"),this.modal=e,this.modalContainer=a.h(".modal-container.closed",e),l.appendChild(this.modalContainer)}open(){this.modalContainer.offsetWidth,this.modalContainer.classList.remove("closed")}close(){i.animation.getValue()?(this.modalContainer.classList.add("closed"),setTimeout(()=>{this.modalContainer.remove()},400)):this.modalContainer.remove(),null!==this.escKeyListener&&s.escapeKeyPressEvent.off(this.escKeyListener)}setDismissible(e=(()=>{this.close()})){if(this.dismissSet)throw new Error("Dismissible already set.");this.dismissSet=!0,s.escapeKeyPressEvent.on(e),this.modalContainer.addEventListener("click",t=>{t.target===this.modalContainer&&e()})}}n.Modal=Modal,n.confirm=function confirm(e,t,n,i){let s=!1;return new Promise(l=>{const c=new Modal(a.h("div",[a.h("h1",e),""===t?null:a.h("p",t),a.h(".button-container",[a.h("div",{onclick:()=>{s||(s=!0,c.close(),l(!0))}},n),a.h("div",{onclick:()=>{s||(s=!0,c.close(),l(!1))}},i)])]));c.open()})},n.notify=function notify(e,t,n){let i=!1;return new Promise(s=>{const l=new Modal(a.h("div",[a.h("h1",e),""===t?null:a.h("p",t),a.h(".button-container",[a.h("div",{onclick:()=>{i||(i=!0,l.close(),s())}},n)])]));l.open()})},n.isAnyModalOpened=function isAnyModalOpened(){return l.childElementCount>0}},{"../data/settings":37,"../hs":39,"../input/keyboard":42,"../util/DOM":57}],32:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.processElements=void 0;const i=e("../util/DOM");n.processElements=function processElements(e){Array.from(e.getElementsByTagName("a")).forEach(e=>{const t=e.attributes.getNamedItem("href");null===t||t.value.startsWith("#")||(e.target="_blank"),e.rel="noopener noreferrer",e.className="regular"}),Array.from(e.getElementsByTagName("code")).forEach(e=>e.addEventListener("dblclick",()=>{e.parentNode instanceof HTMLPreElement||i.selectNode(e)})),Array.from(e.getElementsByTagName("img")).forEach(e=>{const t=e.src,n=t.lastIndexOf("."),i=t.substr(0,n);if(i.endsWith("_low")){const a=t.substr(n+1),s=i.substr(0,i.length-4);e.style.cursor="zoom-in",e.addEventListener("click",()=>window.open(s+"."+a))}})}},{"../util/DOM":57}],33:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.updateSelection=void 0;const i=e("../data/state"),a=e("./history");n.updateSelection=function updateSelection(){if(null===i.state.chapterTextNodes)return;const e=String(i.state.chapterSelection),t=document.getSelection();if(null===t)i.state.chapterSelection=null;else{const e=t.anchorNode instanceof HTMLElement?t.anchorNode.firstChild:t.anchorNode,n=i.state.chapterTextNodes.indexOf(e),a=t.focusNode instanceof HTMLElement?t.focusNode.firstChild:t.focusNode,s=i.state.chapterTextNodes.indexOf(a);-1===n||-1===s||n===s&&t.anchorOffset===t.focusOffset?i.state.chapterSelection=null:n<s||n===s&&t.anchorOffset<t.focusOffset?i.state.chapterSelection=[n,t.anchorOffset,s,t.focusOffset]:i.state.chapterSelection=[s,t.focusOffset,n,t.anchorOffset]}e!==String(i.state.chapterSelection)&&a.updateHistory(!1)}},{"../data/state":38,"./history":28}],34:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.showLogin=n.showLoading=n.showMessage=void 0;const i=e("../constant/messages"),a=e("../hs"),s=e("./makaiControl"),l=e("./modalControl");function showMessage(e){const t=new l.Modal(a.h("div",[a.h("h1",i.MAKAI_MODAL_TITLE_INFO),a.h("p",e),a.h(".button-container",[a.h("div",{onclick:()=>{t.close()}},i.MAKAI_MODAL_OK)])]));t.setDismissible(),t.open()}function showLoading(e){const t=new l.Modal(a.h("div",[a.h("h1",i.MAKAI_MODAL_TITLE_WAITING),a.h("p",e)]));return t.open(),t}n.showMessage=showMessage,n.showLoading=showLoading,n.showLogin=function showLogin(){const e=a.h("input",{value:void 0===s.getToken()?"":s.getToken()}),t=new l.Modal(a.h("div",[a.h("h1",i.MAKAI_MODAL_TITLE_TOKEN),...i.MAKAI_MODAL_CONTENT_MAKAI_TOKEN_DESC.split("\n").map(e=>a.h("p",e)),a.h("i",i.MAKAI_MODAL_CONTENT_DEVELOPMENT_HINT),a.h(".input-group",[a.h("span",i.MAKAI_MODAL_CONTENT_TOKEN_INPUT_PREFIX),e]),a.h(".button-container",[a.h("div",{onclick:()=>{if(""===e.value)return void showMessage(i.MAKAI_ERROR_EMPTY_TOKEN);const n=showLoading(i.MAKAI_INFO_CONFIRM_TOKEN);fetch(s.makaiUrl+"/username/"+e.value).then(e=>e.json()).then(a=>{n.close(),null===a.username?showMessage(i.MAKAI_ERROR_INVALID_TOKEN):(s.saveToken(e.value),s.saveUsername(a.username),t.close(),showMessage(i.MAKAI_INFO_SET_TOKKEN_SUCCESS))}).catch(e=>{n.close(),showMessage(i.MAKAI_ERROR_INTERNET)})}},i.MAKAI_MODAL_SAVE),a.h("div",{onclick:()=>{t.close()}},i.MAKAI_MODAL_CANCEL)])]));t.setDismissible(),t.open()}},{"../constant/messages":13,"../hs":39,"./makaiControl":30,"./modalControl":31}],35:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AutoCache=void 0;n.AutoCache=class AutoCache{constructor(e,t){this.loader=e,this.logger=t,this.map=new Map}delete(e){this.map.delete(e)}get(e){let t=this.map.get(e);return void 0===t?(this.logger.log(`Start loading for key=${e}.`),t=this.loader(e),this.map.set(e,t),t.catch(t=>{this.map.delete(e),this.logger.warn(`Loader failed for key=${e}. Cache removed.`,t)})):this.logger.log(`Cached value used for key=${e}.`),t}}},{}],36:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.authorInfoMap=n.relativePathLookUpMap=n.data=void 0,n.data=window.DATA,n.relativePathLookUpMap=new Map,function iterateFolder(e){e.children.forEach((t,i)=>{"folder"===t.type?iterateFolder(t):n.relativePathLookUpMap.set(t.htmlRelativePath,{folder:e,chapter:t,inFolderIndex:i})})}(n.data.chapterTree),n.authorInfoMap=new Map;for(const e of n.data.authorsInfo)n.authorInfoMap.set(e.name,e)},{}],37:[function(e,t,n){(function(t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.contactInfo=n.wtcdGameQuickLoadConfirm=n.charCount=n.developerMode=n.fontFamily=n.gestureSwitchChapter=n.useComments=n.earlyAccess=n.warning=n.animation=n.EnumSetting=n.BooleanSetting=void 0;const i=e("../Event"),noop=()=>{};class BooleanSetting{constructor(e,n){this.key=e,this.event=new i.Event,this.value=n?"false"!==window.localStorage.getItem(e):"true"===window.localStorage.getItem(e),this.updateLocalStorage(),t(()=>this.event.emit(this.value))}updateLocalStorage(){window.localStorage.setItem(this.key,String(this.value))}getValue(){return this.value}setValue(e){e!==this.value&&this.event.emit(e),this.value=e,this.updateLocalStorage()}toggle(){this.setValue(!this.value)}}n.BooleanSetting=BooleanSetting;class EnumSetting{constructor(e,t,n,i=noop){if(this.key=e,this.options=t,this.defaultValue=n,this.onUpdate=i,!this.isCorrectValue(n))throw new Error(`Default value ${n} is not correct.`);this.value=+(window.localStorage.getItem(e)||n),this.correctValue(),this.onUpdate(this.value,this.options[this.value])}isCorrectValue(e){return!(Number.isNaN(e)||e%1!=0||e<0||e>=this.options.length)}correctValue(){this.isCorrectValue(this.value)||(this.value=this.defaultValue)}updateLocalStorage(){window.localStorage.setItem(this.key,String(this.value))}getValue(){return this.value}getValueName(){return this.options[this.value]}setValue(e){e!==this.value&&this.onUpdate(e,this.options[e]),this.value=e,this.updateLocalStorage()}}n.EnumSetting=EnumSetting,n.animation=new BooleanSetting("animation",!0),n.animation.event.on(e=>{setTimeout(()=>{document.body.classList.toggle("animation-enabled",e)},1)}),n.warning=new BooleanSetting("warning",!1),n.earlyAccess=new BooleanSetting("earlyAccess",!1),n.earlyAccess.event.on(e=>{document.body.classList.toggle("early-access-disabled",!e)}),n.useComments=new BooleanSetting("useComments",!0),n.gestureSwitchChapter=new BooleanSetting("gestureSwitchChapter",!0);const a=['-apple-system, "Noto Sans", "Helvetica Neue", Helvetica, "Nimbus Sans L", Arial, "Liberation Sans", "PingFang SC", "Hiragino Sans GB", "Noto Sans CJK SC", "Source Han Sans SC", "Source Han Sans CN", "Microsoft YaHei", "Wenquanyi Micro Hei", "WenQuanYi Zen Hei", "ST Heiti", SimHei, "WenQuanYi Zen Hei Sharp", sans-serif','Baskerville, Georgia, "Liberation Serif", "Kaiti SC", STKaiti, "AR PL UKai CN", "AR PL UKai HK", "AR PL UKai TW", "AR PL UKai TW MBE", "AR PL KaitiM GB", KaiTi, KaiTi_GB2312, DFKai-SB, "TW-Kai", serif','Georgia, "Nimbus Roman No9 L", "Songti SC", "Noto Serif CJK SC", "Source Han Serif SC", "Source Han Serif CN", STSong, "AR PL New Sung", "AR PL SungtiL GB", NSimSun, SimSun, "TW-Sung", "WenQuanYi Bitmap Song", "AR PL UMing CN", "AR PL UMing HK", "AR PL UMing TW", "AR PL UMing TW MBE", PMingLiU, MingLiU, serif','Baskerville, "Times New Roman", "Liberation Serif", STFangsong, FangSong, FangSong_GB2312, "CWTEX-F", serif'];n.fontFamily=new EnumSetting("fontFamily",["黑体","楷体","宋体","仿宋"],0,e=>{document.documentElement.style.setProperty("--font-family",a[e]),document.documentElement.style.setProperty("--font-family-mono",'"Fira Code", '+a[e])}),n.developerMode=new BooleanSetting("developerMode",!1),n.charCount=new BooleanSetting("charCount",!0),n.charCount.event.on(e=>{document.body.classList.toggle("char-count-disabled",!e)}),n.wtcdGameQuickLoadConfirm=new BooleanSetting("wtcdGameQuickLoadConfirm",!0),n.contactInfo=new BooleanSetting("contactInfo",!0)}).call(this,e("timers").setImmediate)},{"../Event":9,timers:7}],38:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.state=void 0,n.state={currentChapter:null,chapterSelection:null,chapterTextNodes:null}},{}],39:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.h=void 0;const i=e("hyperscript");n.h=i},{hyperscript:4}],40:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.removeNewMentionLink=void 0;const i=e("./constant/messages"),a=e("./control/followQuery"),s=e("./control/modalControl"),l=e("./control/updateSelection"),c=e("./data/data"),u=e("./data/settings"),d=e("./DebugLogger"),p=e("./Menu"),g=e("./menu/MainMenu"),m=e("./util/DOM");e("./control/analyticsControl");const E=m.id("warning");null!==E&&E.addEventListener("click",()=>{E.style.opacity="0",u.animation.getValue()?E.addEventListener("transitionend",()=>{E.remove()}):E.remove()});m.id("build-number").innerText="Build "+c.data.buildNumber;const T=new g.MainMenu;T.setActive(!0);let f=null;n.removeNewMentionLink=function removeNewMentionLink(){null!==f&&(f.remove(),f=null)};const _=new d.DebugLogger("Last Mention Notification");if(null!==localStorage.getItem("token")){const e=Math.floor(+localStorage.getItem("lastCheckedMention"));fetch(`https://c.makai.city/init?token=${localStorage.getItem("token")}&since=${e}`).then(e=>e.json()).then(e=>{localStorage.setItem("username",e.username),_.log(`Initialization result: ${e.mentions} new mentions.`),0!==e.mentions&&(f=T.addItem(`您有 ${e.mentions} 条新回复`,{button:!0,link:"##page/recent-mentions",small:!0,decoration:p.ItemDecoration.ICON_NOTIFICATION,location:p.ItemLocation.BEFORE}))}).catch(e=>{_.error("Failed to initialize.",e)})}else _.log("Token not set, skipping initialization.");c.data.buildError&&s.notify(i.BUILD_FAILED_TITLE,i.BUILD_FAILED_DESC,i.BUILD_FAILED_OK),document.addEventListener("selectionchange",()=>{l.updateSelection()}),window.addEventListener("popstate",()=>{a.followQuery()}),a.followQuery()},{"./DebugLogger":8,"./Menu":10,"./constant/messages":13,"./control/analyticsControl":19,"./control/followQuery":26,"./control/modalControl":31,"./control/updateSelection":33,"./data/data":36,"./data/settings":37,"./menu/MainMenu":46,"./util/DOM":57}],41:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.swipeEvent=n.SwipeDirection=void 0;const i=e("../DebugLogger"),a=e("../Event"),s=e("../util/DOM");var l;!function(e){e[e.TO_TOP=0]="TO_TOP",e[e.TO_RIGHT=1]="TO_RIGHT",e[e.TO_BOTTOM=2]="TO_BOTTOM",e[e.TO_LEFT=3]="TO_LEFT"}(l=n.SwipeDirection||(n.SwipeDirection={}));n.swipeEvent=new a.Event;let c=0,u=0,d=0,p=null;window.addEventListener("touchstart",e=>{1===e.touches.length&&(p=e.target,c=e.touches[0].clientX,u=e.touches[0].clientY,d=Date.now())}),window.addEventListener("touchend",e=>{if(0!==e.touches.length)return;if(Date.now()-d>500)return;if(window.innerWidth>900)return;const t=e.changedTouches[0].clientX-c,i=e.changedTouches[0].clientY-u,a=Math.abs(t/window.innerWidth),g=Math.abs(i/window.innerHeight);if(a>.17&&g<.1){if(s.isAnyParent(p,e=>"hidden"!==window.getComputedStyle(e).getPropertyValue("overflow-x")&&e.scrollWidth>e.clientWidth))return;t>0?n.swipeEvent.emit(l.TO_RIGHT):n.swipeEvent.emit(l.TO_LEFT)}else if(g>.1&&a<.1){if(s.isAnyParent(p,e=>"hidden"!==window.getComputedStyle(e).getPropertyValue("overflow-y")&&e.scrollHeight>e.clientHeight))return;i>0?n.swipeEvent.emit(l.TO_BOTTOM):n.swipeEvent.emit(l.TO_TOP)}});const g=new i.DebugLogger("Swipe Event");n.swipeEvent.on(e=>{g.log(l[e])})},{"../DebugLogger":8,"../Event":9,"../util/DOM":57}],42:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.escapeKeyPressEvent=n.arrowKeyPressEvent=n.ArrowKey=void 0;const i=e("../DebugLogger"),a=e("../Event");var s;!function(e){e[e.LEFT=0]="LEFT",e[e.UP=1]="UP",e[e.RIGHT=2]="RIGHT",e[e.DOWN=3]="DOWN"}(s=n.ArrowKey||(n.ArrowKey={})),n.arrowKeyPressEvent=new a.Event,n.escapeKeyPressEvent=new a.Event,document.addEventListener("keydown",e=>{if(!e.repeat)switch(e.keyCode){case 27:n.escapeKeyPressEvent.emit();break;case 37:n.arrowKeyPressEvent.emit(s.LEFT);break;case 38:n.arrowKeyPressEvent.emit(s.UP);break;case 39:n.arrowKeyPressEvent.emit(s.RIGHT);break;case 40:n.arrowKeyPressEvent.emit(s.DOWN)}});const l=new i.DebugLogger("Arrow Key Event");n.arrowKeyPressEvent.on(e=>{l.log(s[e])})},{"../DebugLogger":8,"../Event":9}],43:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ChaptersMenu=n.isEmptyFolder=void 0;const i=e("../control/chapterControl"),a=e("../control/history"),s=e("../data/data"),l=e("../Menu"),c=e("../util/shortNumber"),u=new Map;let d=null;function attachLastReadLabelTo(e){void 0!==e&&(d=e.append("[上次阅读]"))}function getDecorationForChapterType(e){switch(e){case"Markdown":return l.ItemDecoration.ICON_FILE;case"WTCD":return l.ItemDecoration.ICON_GAME}}function isEmptyFolder(e){return e.children.every(e=>"folder"===e.type&&isEmptyFolder(e))}i.loadChapterEvent.on(e=>{null!==d&&d.remove(),attachLastReadLabelTo(u.get(e))}),n.isEmptyFolder=isEmptyFolder;class ChaptersMenu extends l.Menu{constructor(e,t){void 0===t&&(t=s.data.chapterTree),super(""===t.sourceRelativePath?"章节选择":t.displayName,e);for(const e of t.children)if("folder"===e.type){if(isEmptyFolder(e))continue;const t=this.addLink(new ChaptersMenu(this,e),!0,l.ItemDecoration.ICON_FOLDER);null!==e.charsCount&&t.append(`[${c.shortNumber(e.charsCount)}]`,"char-count")}else{if(e.hidden)continue;const t=this.addItem(e.displayName,{small:!0,button:!0,decoration:getDecorationForChapterType(e.type)}).onClick(()=>{i.loadChapter(e.htmlRelativePath),a.updateHistory(!0)});e.isEarlyAccess&&(t.prepend("[编写中]"),t.addClass("early-access")),null!==e.charsCount&&t.append(`[${c.shortNumber(e.charsCount)}]`,"char-count");window.localStorage.getItem("lastRead")===e.htmlRelativePath&&attachLastReadLabelTo(t),u.set(e.htmlRelativePath,t)}}}n.ChaptersMenu=ChaptersMenu},{"../Menu":10,"../control/chapterControl":20,"../control/history":28,"../data/data":36,"../util/shortNumber":64}],44:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ContactMenu=void 0;const i=e("../Menu");class ContactMenu extends i.Menu{constructor(e){super("订阅/讨论组",e),this.addItem("Telegram 更新推送频道",{small:!0,button:!0,link:"https://t.me/joinchat/AAAAAEpkRVwZ-3s5V3YHjA",decoration:i.ItemDecoration.ICON_LINK}),this.addItem("Telegram 讨论组",{small:!0,button:!0,link:"https://t.me/joinchat/Dt8_WlJnmEwYNbjzlnLyNA",decoration:i.ItemDecoration.ICON_LINK}),this.addItem("GitHub Repo",{small:!0,button:!0,link:"https://github.com/SCLeoX/Wearable-Technology",decoration:i.ItemDecoration.ICON_LINK}),this.addItem("原始 Google Docs",{small:!0,button:!0,link:"https://docs.google.com/document/d/1Pp5CtO8c77DnWGqbXg-3e7w9Q3t88P35FOl6iIJvMfo/edit?usp=sharing",decoration:i.ItemDecoration.ICON_LINK})}}n.ContactMenu=ContactMenu},{"../Menu":10}],45:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.LinkExchangeMenu=void 0;const i=e("../Menu");class LinkExchangeMenu extends i.Menu{constructor(e){super("友情链接",e),this.addItem("艾利浩斯学院 图书馆",{small:!0,button:!0,link:"http://ailihaosi.xyz/",decoration:i.ItemDecoration.ICON_LINK}),this.addItem("acted 咕咕喵的小说和小游戏",{small:!0,button:!0,link:"https://acted.gitlab.io/h3/",decoration:i.ItemDecoration.ICON_LINK})}}n.LinkExchangeMenu=LinkExchangeMenu},{"../Menu":10}],46:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.MainMenu=void 0;const i=e("../Menu"),a=e("./ChaptersMenu"),s=e("./ContactMenu"),l=e("./LinkExchangeMenu"),c=e("./SettingsMenu"),u=e("./StatsMenu"),d=e("./StyleMenu"),p=e("./ThanksMenu");class MainMenu extends i.Menu{constructor(){super("",null),this.addLink(new a.ChaptersMenu(this)),this.addLink(new p.ThanksMenu(this)),this.addLink(new d.StyleMenu(this)),this.addLink(new s.ContactMenu(this)),this.addItem("最新评论",{button:!0,link:"##page/recent-comments"}),this.addLink(new l.LinkExchangeMenu(this)),this.addItem("源代码",{button:!0,link:"https://github.com/SCLeoX/Wearable-Technology"}),this.addLink(new c.SettingsMenu(this)),this.addLink(new u.StatsMenu(this))}}n.MainMenu=MainMenu},{"../Menu":10,"./ChaptersMenu":43,"./ContactMenu":44,"./LinkExchangeMenu":45,"./SettingsMenu":48,"./StatsMenu":50,"./StyleMenu":51,"./ThanksMenu":52}],47:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.MakaiMenu=void 0;const i=e("../control/userControl"),a=e("../Menu");class MakaiMenu extends a.Menu{constructor(e){super("Makai 评论系统管理",e),this.addItem("Makai 令牌",{small:!0,button:!0}).onClick(()=>{i.showLogin()})}}n.MakaiMenu=MakaiMenu},{"../Menu":10,"../control/userControl":34}],48:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SettingsMenu=n.EnumSettingMenu=void 0;const i=e("../constant/stylePreviewArticle"),a=e("../control/contentControl"),s=e("../control/layoutControl"),l=e("../data/settings"),c=e("../Menu"),u=e("./MakaiMenu");class EnumSettingMenu extends c.Menu{constructor(e,t,n,l){let u;super(t+"设置",e,l?s.Layout.SIDE:s.Layout.MAIN),l&&this.activateEvent.on(()=>{a.newContent(a.Side.RIGHT).addBlock().element.innerHTML=i.stylePreviewArticle}),n.options.forEach((e,t)=>{const i=this.addItem(e,{small:!0,button:!0,decoration:c.ItemDecoration.SELECTABLE}).onClick(()=>{u.setSelected(!1),i.setSelected(!0),n.setValue(t),u=i});t===n.getValue()&&(u=i,i.setSelected(!0))})}}n.EnumSettingMenu=EnumSettingMenu;class SettingsMenu extends c.Menu{constructor(e){super("设置",e),this.addLink(new u.MakaiMenu(this),!0),this.addBooleanSetting("NSFW 警告",l.warning),this.addBooleanSetting("使用动画",l.animation),this.addBooleanSetting("显示编写中章节",l.earlyAccess),this.addBooleanSetting("显示评论",l.useComments),this.addBooleanSetting("手势切换章节（仅限手机）",l.gestureSwitchChapter),this.addEnumSetting("字体",l.fontFamily,!0),this.addBooleanSetting("显示每个章节的字数",l.charCount),this.addBooleanSetting("WTCD 游戏快速读取前确认",l.wtcdGameQuickLoadConfirm),this.addBooleanSetting("开发人员模式",l.developerMode),this.addBooleanSetting("文章末显示联系信息",l.contactInfo)}addBooleanSetting(e,t){const getText=t=>`${e}：${t?"开":"关"}`,n=this.addItem(getText(t.getValue()),{small:!0,button:!0}).onClick(()=>{t.toggle()});t.event.on(e=>{n.setInnerText(getText(e))})}addEnumSetting(e,t,n){const getText=()=>`${e}：${t.getValueName()}`,i=this.addItem(getText(),{small:!0,button:!0}),a=new EnumSettingMenu(this,e,t,!0===n);i.linkTo(a).onClick(()=>{this.activateEvent.once(()=>{i.setInnerText(getText())})})}}n.SettingsMenu=SettingsMenu},{"../Menu":10,"../constant/stylePreviewArticle":14,"../control/contentControl":23,"../control/layoutControl":29,"../data/settings":37,"./MakaiMenu":47}],49:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.StatsKeywordsCountMenu=void 0;const i=e("../data/data"),a=e("../Menu"),s=e("../util/shortNumber");class StatsKeywordsCountMenu extends a.Menu{constructor(e){super("关键词统计",e),this.addItem("添加其他关键词",{small:!0,button:!0,link:"https://github.com/SCLeoX/Wearable-Technology/edit/master/src/builder/keywords.ts",decoration:a.ItemDecoration.ICON_LINK}),i.data.keywordsCount.forEach(([e,t])=>{this.addItem(`${e}：${s.shortNumber(t,2)}`,{small:!0})})}}n.StatsKeywordsCountMenu=StatsKeywordsCountMenu},{"../Menu":10,"../data/data":36,"../util/shortNumber":64}],50:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.StatsMenu=void 0;const i=e("../data/data"),a=e("../Menu"),s=e("./StatsKeywordsCountMenu"),l=e("../util/shortNumber");class StatsMenu extends a.Menu{constructor(e){super("统计",e),this.addItem("访问量统计",{button:!0,link:"##page/visit-count",small:!0,decoration:a.ItemDecoration.ICON_EQUALIZER}),this.addLink(new s.StatsKeywordsCountMenu(this),!0,a.ItemDecoration.ICON_EQUALIZER),this.addItem("总字数："+(null===i.data.charsCount?"不可用":l.shortNumber(i.data.charsCount,2)),{small:!0}),this.addItem("总段落数："+l.shortNumber(i.data.paragraphsCount,2),{small:!0})}}n.StatsMenu=StatsMenu},{"../Menu":10,"../data/data":36,"../util/shortNumber":64,"./StatsKeywordsCountMenu":49}],51:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.StyleMenu=void 0;const i=e("../constant/stylePreviewArticle"),a=e("../control/contentControl"),s=e("../control/layoutControl"),l=e("../DebugLogger"),c=e("../hs"),u=e("../Menu");class Style{constructor(e,t){this.name=e,this.def=t,this.styleSheet=null,this.debugLogger=new l.DebugLogger(`Style (${e})`)}injectStyleSheet(){const e=document.createElement("style");document.head.appendChild(e);const t=e.sheet;t.disabled=!0;const attemptInsertRule=e=>{try{t.insertRule(e)}catch(t){this.debugLogger.error(`Failed to inject rule "${e}".`,t)}},n=`rgb(${this.def.keyColor.join(",")})`,keyAlpha=e=>`rgba(${this.def.keyColor.join(",")},${e})`;attemptInsertRule(`.container { color: ${n}; }`),attemptInsertRule(`.menu { color: ${n}; }`),attemptInsertRule(`.menu .button:active::after { background-color: ${n}; }`),attemptInsertRule(`.button::after { background-color: ${n}; }`),attemptInsertRule(`body { background-color: ${this.def.paperBgColor}; }`),attemptInsertRule(`:root { --comment-color:${this.def.commentColor}; }`),attemptInsertRule(`:root { --content-block-warning-color:${this.def.contentBlockWarningColor}; }`),attemptInsertRule(`:root { --rect-bg-color: ${this.def.rectBgColor}; }`),attemptInsertRule(`:root { --paper-bg-color: ${this.def.paperBgColor}; }`),attemptInsertRule(`:root { --link-color: ${this.def.linkColor}; }`),attemptInsertRule(`:root { --link-hover-color: ${this.def.linkHoverColor}; }`),attemptInsertRule(`:root { --link-active-color: ${this.def.linkActiveColor}; }`),attemptInsertRule(`:root { --key: ${n}; }`),attemptInsertRule(`:root { --key-opacity-01: ${keyAlpha(.1)}; }`),attemptInsertRule(`:root { --key-opacity-015: ${keyAlpha(.15)}; }`),attemptInsertRule(`:root { --key-opacity-05: ${keyAlpha(.5)}; }`),attemptInsertRule(`:root { --key-opacity-007: ${keyAlpha(.07)}; }`),attemptInsertRule(`:root { --key-opacity-004: ${keyAlpha(.04)}; }`),attemptInsertRule(`:root { --button-color: ${this.def.commentColor}; }`),this.styleSheet=t}active(){if(null!==Style.currentlyEnabled){const e=Style.currentlyEnabled;null!==e.styleSheet&&(e.styleSheet.disabled=!0),e.itemHandle.setSelected(!1)}null===this.styleSheet&&this.injectStyleSheet(),this.styleSheet.disabled=!1,this.itemHandle.setSelected(!0),window.localStorage.setItem("style",this.name),null===Style.themeColorMetaTag?(Style.themeColorMetaTag=c.h("meta",{name:"theme-color",content:this.def.paperBgColor}),document.head.appendChild(Style.themeColorMetaTag)):Style.themeColorMetaTag.content=this.def.paperBgColor,Style.currentlyEnabled=this}}Style.currentlyEnabled=null,Style.themeColorMetaTag=null;const d={linkColor:"#00E",linkHoverColor:"#F00",linkActiveColor:"#00E"},p={linkColor:"#88F",linkHoverColor:"#F33",linkActiveColor:"#88F"},g=[new Style("可穿戴科技（默认）",Object.assign(Object.assign({rectBgColor:"#444",paperBgColor:"#333",keyColor:[221,221,221]},p),{contentBlockWarningColor:"#E65100",commentColor:"#444",keyIsDark:!1})),new Style("白纸",Object.assign(Object.assign({rectBgColor:"#EFEFED",paperBgColor:"#FFF",keyColor:[0,0,0]},d),{contentBlockWarningColor:"#FFE082",commentColor:"#F5F5F5",keyIsDark:!0})),new Style("夜间",Object.assign(Object.assign({rectBgColor:"#272B36",paperBgColor:"#38404D",keyColor:[221,221,221]},p),{contentBlockWarningColor:"#E65100",commentColor:"#272B36",keyIsDark:!1})),new Style("羊皮纸",Object.assign(Object.assign({rectBgColor:"#D8D4C9",paperBgColor:"#F8F4E9",keyColor:[85,40,48]},d),{contentBlockWarningColor:"#FFE082",commentColor:"#F9EFD7",keyIsDark:!0})),new Style("巧克力",Object.assign(Object.assign({rectBgColor:"#2E1C11",paperBgColor:"#3A2519",keyColor:[221,175,153]},p),{contentBlockWarningColor:"#E65100",commentColor:"#2C1C11",keyIsDark:!1}))];class StyleMenu extends u.Menu{constructor(e){super("阅读器样式",e,s.Layout.SIDE);for(const e of g)e.itemHandle=this.addItem(e.name,{small:!0,button:!0,decoration:u.ItemDecoration.SELECTABLE}).onClick(()=>{e.active()});const t=window.localStorage.getItem("style");let n=!1;for(const e of g)if(t===e.name){e.active(),n=!0;break}n||g[0].active(),this.activateEvent.on(()=>{a.newContent(a.Side.RIGHT).addBlock().element.innerHTML=i.stylePreviewArticle})}}n.StyleMenu=StyleMenu},{"../DebugLogger":8,"../Menu":10,"../constant/stylePreviewArticle":14,"../control/contentControl":23,"../control/layoutControl":29,"../hs":39}],52:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ThanksMenu=void 0;const i=e("../constant/thanks"),a=e("../Menu");class ThanksMenu extends a.Menu{constructor(e){super("鸣谢列表",e);for(const e of i.thanks)this.addItem(e.name,void 0===e.link?{small:!0}:{small:!0,button:!0,link:e.link,decoration:a.ItemDecoration.ICON_LINK})}}n.ThanksMenu=ThanksMenu},{"../Menu":10,"../constant/thanks":15}],53:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.pages=void 0;const i=e("./recentComments"),a=e("./recentMentions"),s=e("./visitCount");n.pages=[i.recentComments,s.visitCount,a.recentMentions]},{"./recentComments":54,"./recentMentions":55,"./visitCount":56}],54:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.recentComments=void 0;const i=e("../control/commentsControl");n.recentComments={name:"recent-comments",handler:e=>(i.loadRecentComments(e),!0)}},{"../control/commentsControl":21}],55:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.recentMentions=void 0;const i=e("../constant/messages"),a=e("../control/commentsControl"),s=e("../hs"),l=e("../index");n.recentMentions={name:"recent-mentions",handler:e=>(setTimeout(()=>{l.removeNewMentionLink()},500),localStorage.setItem("lastCheckedMention",String(Date.now())),null===localStorage.getItem("token")?e.addBlock({initElement:s.h("div",s.h("h1",i.COMMENTS_MENTION_NO_TOKEN_TITLE),s.h("p",i.COMMENTS_MENTION_NO_TOKEN_DESC))}):a.loadRecentMentions(e,localStorage.getItem("token")),!0)}},{"../constant/messages":13,"../control/commentsControl":21,"../hs":39,"../index":40}],56:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.visitCount=void 0;const i=e("../constant/messages"),a=e("../control/chapterControl"),s=e("../control/history"),l=e("../data/AutoCache"),c=e("../DebugLogger"),u=e("../hs"),d=e("../util/commaNumber"),p=e("../util/padName"),g=e("../util/shortNumber"),m=["ALL","HOUR","DAY","WEEK","MONTH","YEAR"];const E=new c.DebugLogger("Visit Count Logger");function getTimeFrameText(e){switch(e){case"ALL":return i.VISIT_COUNT_TIME_FRAME_ALL;case"HOUR":return i.VISIT_COUNT_TIME_FRAME_HOUR;case"DAY":return i.VISIT_COUNT_TIME_FRAME_DAY;case"WEEK":return i.VISIT_COUNT_TIME_FRAME_WEEK;case"YEAR":return i.VISIT_COUNT_TIME_FRAME_YEAR;case"MONTH":return i.VISIT_COUNT_TIME_FRAME_MONTH}}const T=new l.AutoCache(e=>fetch(e).then(e=>e.json()),new c.DebugLogger("Visit Count Cache"));n.visitCount={name:"visit-count",handler:e=>{const t=e.addBlock();t.element.appendChild(u.h("h1",i.VISIT_COUNT_TITLE)),t.element.appendChild(u.h("p",[i.VISIT_COUNT_DESC_0,u.h("a.regular",{href:"#META/隐私政策.html"},i.VISIT_COUNT_DESC_1),i.VISIT_COUNT_DESC_2]));const n=u.h("p"),l=u.h(".visit-count-holder"),c=u.h("div.rich"),f=u.h(".button-container.display-none",{style:{"margin-top":"0.5em"}},c);let _=0,v="ALL",C=2,A=0;const load=(t,a)=>{const s=function getEndpoint(e,t){return"ALL"===e?"https://wta.makai.city/api/chapters/all?page="+t:`https://wta.makai.city/api/chapters/recent?page=${t}&time_frame=${e}`}(t,a);_++;const m=_;E.log(`Request ID ${m}: Loading visit count info from ${s}.`),T.get(s).then(s=>{var T,v;if(e.isDestroyed||m!==_)E.log(`Request ID ${m}: Request completed, but the result is abandoned.`);else{1===a?(A=null!==(v=null===(T=s[0])||void 0===T?void 0:T.visit_count)&&void 0!==v?v:0,f.classList.remove("display-none")):c.classList.remove("disabled"),n.innerText=i.VISIT_COUNT_DISPLAYING.replace(/\$/g,p.padName(getTimeFrameText(t))),c.innerText=i.VISIT_COUNT_LOAD_MORE,f.classList.toggle("display-none",50!==s.length);for(const e of s)l.appendChild(u.h("a",{style:{width:e.visit_count/A*100+"%"},title:d.commaNumber(e.visit_count)+i.VISIT_COUNT_TIMES,href:"#"+e.relative_path},(y=e.relative_path,M=e.visit_count,y.endsWith(".html")&&(y=y.substr(0,y.length-".html".length)),(y=(y=y.replace(/\//g," > ")).replace(/-/g," "))+": "+g.shortNumber(M,2)+i.VISIT_COUNT_TIMES)));var y,M;C=a+1}}).catch(t=>{e.isDestroyed||m!==_?E.warn(`Request ID ${m}: Request failed, but the result is abandoned.`,t):1===a?n.innerText=i.VISIT_COUNT_FAILED:(c.classList.remove("disabled"),c.innerText=i.VISIT_COUNT_LOAD_MORE_FAILED)})};c.addEventListener("click",()=>{c.classList.contains("disabled")||(c.classList.add("disabled"),c.innerText=i.VISIT_COUNT_LOAD_MORE_LOADING,load(v,C))});const loadTimeFrame=e=>{l.innerHTML="",n.innerText=i.VISIT_COUNT_LOADING,f.classList.add("display-none"),v=e,C=2,load(e,1)},y=[];return t.element.appendChild(u.h(".button-container",m.map(e=>((e,t)=>{const n=u.h("div.rich",{onclick:()=>{for(const e of y)e.classList.toggle("selected",e===n);loadTimeFrame(t)}},e);return"ALL"===t&&n.classList.add("selected"),y.push(n),n})(getTimeFrameText(e),e)))),t.element.appendChild(n),t.element.appendChild(l),t.element.appendChild(f),t.element.appendChild(u.h("div.page-switcher",[u.h("a.to-menu",{href:window.location.pathname,onclick:e=>{e.preventDefault(),a.closeChapter(),s.updateHistory(!0)}},i.GO_TO_MENU)])),loadTimeFrame("ALL"),!0}}},{"../DebugLogger":8,"../constant/messages":13,"../control/chapterControl":20,"../control/history":28,"../data/AutoCache":35,"../hs":39,"../util/commaNumber":58,"../util/padName":62,"../util/shortNumber":64}],57:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.insertAfterH1=n.insertAfter=n.isAnyParent=n.selectNode=n.getTextNodes=n.id=void 0;const i=e("../DebugLogger");n.id=function id(e){return document.getElementById(e)},n.getTextNodes=function getTextNodes(e,t){const n=t||[];let i=e.firstChild;for(;null!==i;)i instanceof HTMLElement&&getTextNodes(i,n),i instanceof Text&&n.push(i),i=i.nextSibling;return n};const a=new i.DebugLogger("Select Node");function insertAfter(e,t){t.parentElement.insertBefore(e,t.nextSibling)}n.selectNode=function selectNode(e){try{const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}catch(t){a.log("Failed to select node: ",e,"; Error: ",t)}},n.isAnyParent=function isAnyParent(e,t){for(;null!==e;){if(t(e))return!0;e=e.parentElement}return!1},n.insertAfter=insertAfter,n.insertAfterH1=function insertAfterH1(e,t){const n=t.firstChild;null!==n&&n instanceof HTMLHeadingElement&&"h1"===n.tagName.toLowerCase()?insertAfter(e,n):t.prepend(e)}},{"../DebugLogger":8}],58:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.commaNumber=void 0,n.commaNumber=function commaNumber(e){const t=[];for(;e>=1e3;)t.push(String(e%1e3).padStart(3,"0")),e=Math.floor(e/1e3);return t.push(String(e)),t.reverse(),t.join(",")}},{}],59:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.formatTimeSimple=n.formatTimeRelative=void 0;const i=864e5;n.formatTimeRelative=function formatTimeRelative(e){const t=Date.now()-e.getTime();return t>6048e5?`${e.getFullYear()}/${e.getMonth()+1}/${e.getDate()}`:t>i?Math.floor(t/i)+" 天前":t>36e5?Math.floor(t/36e5)+" 小时前":t>6e4?Math.floor(t/6e4)+" 分钟前":Math.floor(t/1e3)+" 秒前"},n.formatTimeSimple=function formatTimeSimple(e){return`${e.getFullYear()}-${e.getMonth()+1}-${e.getDate()} ${e.getHours()}:${e.getMinutes()}:${e.getSeconds()}`}},{}],60:[function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(a,s){function fulfilled(e){try{step(i.next(e))}catch(e){s(e)}}function rejected(e){try{step(i.throw(e))}catch(e){s(e)}}function step(e){e.done?a(e.value):function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(fulfilled,rejected)}step((i=i.apply(e,t||[])).next())}))};Object.defineProperty(n,"__esModule",{value:!0}),n.loadGoogleFonts=void 0;const a=e("../DebugLogger"),s=e("./matchAll"),l=new a.DebugLogger("Load Google Fonts"),c=/@font-face {[^}]*?font-family:\s*['"]?([^;'"]+?)['"]?;[^}]*?font-style:\s*([^;]+);[^}]*?font-weight:\s*([^;]+);[^}]*?src:\s*([^;]+);[^}]*?(?:unicode-range:\s*([^;]+))?;/g;n.loadGoogleFonts=function loadGoogleFonts(e){return i(this,void 0,void 0,(function*(){const t="https://fonts.googleapis.com/css2?family="+e.replace(/ /g,"+");l.log(`Loading font: "${e}" from "${t}".`);const n=yield fetch(t),i=yield n.text(),a=s.matchAll(i,c);return Promise.all(a.map(e=>new FontFace(e[1],e[4],{style:e[2],weight:e[3],unicodeRange:e[5]}).load())).then(e=>e.map(e=>document.fonts.add(e))).then(()=>e)}))}},{"../DebugLogger":8,"./matchAll":61}],61:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.matchAll=void 0,n.matchAll=function matchAll(e,t){if(!0!==t.global)throw new Error("Global flag is required.");const n=[];let i;for(;null!==(i=t.exec(e));)n.push(i);return n}},{}],62:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.padName=void 0;const i=/^(?:[\u4E00-\u9FCC\u3400-\u4DB5\uFA0E\uFA0F\uFA11\uFA13\uFA14\uFA1F\uFA21\uFA23\uFA24\uFA27-\uFA29]|[\ud840-\ud868][\udc00-\udfff]|\ud869[\udc00-\uded6\udf00-\udfff]|[\ud86a-\ud86c][\udc00-\udfff]|\ud86d[\udc00-\udf34\udf40-\udfff]|\ud86e[\udc00-\udc1d])/,a=/(?:[\u4E00-\u9FCC\u3400-\u4DB5\uFA0E\uFA0F\uFA11\uFA13\uFA14\uFA1F\uFA21\uFA23\uFA24\uFA27-\uFA29]|[\ud840-\ud868][\udc00-\udfff]|\ud869[\udc00-\uded6\udf00-\udfff]|[\ud86a-\ud86c][\udc00-\udfff]|\ud86d[\udc00-\udf34\udf40-\udfff]|\ud86e[\udc00-\udc1d])$/;n.padName=function padName(e){return i.test(e)||(e=" "+e),a.test(e)||(e+=" "),e}},{}],63:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.resolvePath=void 0,n.resolvePath=function resolvePath(...e){const t=[];for(const n of e){const e=n.split("/");for(const n of e)switch(n){case"":case".":return null;case"..":if(0===t.length)return null;t.pop();break;default:t.push(n)}}return t.join("/")}},{}],64:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.shortNumber=void 0,n.shortNumber=function shortNumber(e,t=1){return e<1e3?String(e):e<1e6?(e/1e3).toFixed(t)+"k":(e/1e6).toFixed(t)+"M"}},{}],65:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.stringHash=void 0,n.stringHash=function stringHash(e){let t=0;if(0===e.length)return t;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return t}},{}],66:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ChainedCanvas=void 0;n.ChainedCanvas=class ChainedCanvas{constructor(e,t){this.promise=Promise.resolve(),this.canvas=document.createElement("canvas"),this.canvas.width=e,this.canvas.height=t,this.ctx=this.canvas.getContext("2d")}updatePromise(e){this.promise=this.promise.then(e)}onResolve(e){this.promise.then(e)}getWidth(){return this.canvas.width}getHeight(){return this.canvas.height}}},{}],67:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.defaultFeatureProvider=n.FeatureProvider=void 0;class FeatureProvider{loadImage(e){return Promise.reject("Loading images is not allowed.")}loadFont(e){return Promise.reject("Loading fonts is not allowed.")}drawLoadingCanvas(e){}}n.FeatureProvider=FeatureProvider,n.defaultFeatureProvider=new FeatureProvider},{}],68:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.FlowReader=void 0;const i=e("./Interpreter"),a=e("./Random"),s=e("./FeatureProvider");n.FlowReader=class FlowReader{constructor(e,t,n,i,a=s.defaultFeatureProvider){this.wtcdRoot=t,this.errorMessageCreator=n,this.elementPreprocessor=i,this.featureProvider=a,this.currentDecisionIndex=0,this.buttons=[],this.contents=[],this.started=!1,this.storageKey="wtcd.fr."+e,this.data=this.parseData(window.localStorage.getItem(this.storageKey))||{random:String(Math.random()),decisions:[]},this.resetInterpreter()}parseData(e){if("string"!=typeof e)return null;let t;try{t=JSON.parse(e)}catch(e){return null}return"string"!=typeof t.random?null:Array.isArray(t.decisions)?t.decisions.some(e=>"number"!=typeof e)?null:t:null}persist(){window.localStorage.setItem(this.storageKey,JSON.stringify(this.data))}next(e){try{return this.interpreterIterator.next(e)}catch(e){const t=this.errorMessageCreator(e);return this.target.appendChild(t),this.contents.push(t),{done:!0,value:{choices:[],content:[]}}}}resetInterpreter(){this.interpreter=new i.Interpreter(this.wtcdRoot,new a.Random(this.data.random),this.featureProvider),this.interpreterIterator=this.interpreter.start()}decide(e,t=!1){this.buttons[this.currentDecisionIndex].forEach((t,n)=>{t.classList.contains("disabled")||(t.classList.remove("candidate"),n===e?t.classList.add("selected"):t.classList.add("unselected"))}),t||this.data.decisions.push(e),this.currentDecisionIndex++;const n=this.next(e);return this.handleOutput(n.value),n.done}undecide(e){this.resetInterpreter(),this.data.decisions.splice(e),this.buttons.splice(e+1),this.contents.splice(e+1).forEach(e=>e.remove()),this.next();for(const e of this.data.decisions)this.next(e);this.buttons[e].forEach(e=>{e.classList.contains("disabled")||(e.classList.remove("selected","unselected"),e.classList.add("candidate"))}),this.currentDecisionIndex=e}handleOutput(e){const t=document.createElement("div");t.classList.add("wtcd-group-container"),e.content.forEach(e=>t.appendChild(e)),this.interpreter.getPinned().forEach(e=>t.appendChild(e));const n=this.currentDecisionIndex;this.buttons.push(e.choices.map((e,i)=>{const a=document.createElement("div");return a.classList.add("wtcd-button"),a.innerText=e.content,e.disabled?a.classList.add("disabled"):(a.classList.add("candidate"),a.addEventListener("click",()=>{this.data.decisions[n]===i?(this.undecide(n),this.persist()):this.currentDecisionIndex===n&&(this.decide(i),this.persist())})),t.appendChild(a),a})),this.contents.push(t),this.target.appendChild(t),this.elementPreprocessor(t)}renderTo(e){if(this.started)throw new Error("Flow reader already started.");this.started=!0,this.target=e;const t=this.next();let n=t.done;this.handleOutput(t.value);for(const e of this.data.decisions){if(n)return;n=this.decide(e,!0)}}}},{"./FeatureProvider":67,"./Interpreter":70,"./Random":71}],69:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.GameReader=void 0;const i=e("./Interpreter"),a=e("./Random"),s=e("./FeatureProvider");function isGameData(e){return"object"==typeof e&&null!==e&&("string"==typeof e.random&&(!!Array.isArray(e.decisions)&&!e.decisions.some(e=>"number"!=typeof e)))}function isData(e){return"object"==typeof e&&null!==e&&(!!isGameData(e.current)&&(!!Array.isArray(e.saves)&&!!e.saves.every(e=>null===e||function isSaveData(e){return!!isGameData(e)&&("number"==typeof e.date&&"string"==typeof e.desc)}(e))))}n.GameReader=class GameReader{constructor(e,t,n,i,a=s.defaultFeatureProvider){this.wtcdRoot=t,this.onOutput=n,this.onError=i,this.featureProvider=a,this.started=!1,this.storageKey="wtcd.gr."+e,this.data=this.parseData(window.localStorage.getItem(this.storageKey))||{saves:[null,null,null],current:{random:String(Math.random()),decisions:[]}}}parseData(e){if("string"!=typeof e)return null;let t;try{t=JSON.parse(e)}catch(e){return null}return isData(t)?t:null}persist(){window.localStorage.setItem(this.storageKey,JSON.stringify(this.data))}getSaves(){return this.data.saves.map(e=>null===e?null:{desc:e.desc,date:new Date(e.date)})}reset(e){this.data.current.decisions=[],e&&(this.data.current.random=String(Math.random())),this.restoreGameState(),this.persist()}save(e){if(void 0===this.data.saves[e])throw new Error("Illegal save index: "+e);this.data.saves[e]={date:Date.now(),desc:this.interpreter.getStateDesc()||"",random:this.data.current.random,decisions:this.data.current.decisions.slice()},null!==this.data.saves[this.data.saves.length-1]&&this.data.saves.push(null),this.persist()}load(e){const t=this.data.saves[e];if(null==t)throw new Error(`Illegal save index: ${e}.`);this.data.current.random=t.random,this.data.current.decisions=t.decisions.slice(),this.restoreGameState(),this.persist()}next(e){try{return this.interpreterIterator.next(e)}catch(e){return this.onError(e),{done:!0,value:{choices:[],content:[]}}}}restoreGameState(){this.interpreter=new i.Interpreter(this.wtcdRoot,new a.Random(this.data.current.random),this.featureProvider),this.interpreterIterator=this.interpreter.start();let e=this.next();this.data.current.decisions.forEach(t=>e=this.next(t)),this.handleOutput(e.value)}handleOutput(e){const t=document.createElement("div");e.content.forEach(e=>t.appendChild(e)),this.interpreter.getPinned().forEach(e=>t.appendChild(e));const n=this.data.current.decisions.length,i=e.choices.map((e,a)=>{const s=document.createElement("div");return s.classList.add("wtcd-button"),s.innerText=e.content,e.disabled?s.classList.add("disabled"):(s.classList.add("candidate"),s.addEventListener("click",()=>{n===this.data.current.decisions.length&&(this.data.current.decisions.push(a),i.forEach(e=>{e===s?e.classList.add("selected"):e.classList.add("unselected")}),this.handleOutput(this.next(a).value),this.persist())})),t.appendChild(s),s});this.onOutput(t)}start(){if(this.started)throw new Error("Game reader already started.");this.started=!0,this.restoreGameState()}}},{"./FeatureProvider":67,"./Interpreter":70,"./Random":71}],70:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Interpreter=n.InvalidChoiceError=n.assignValueToVariable=n.isTypeAssignableTo=n.describe=n.BubbleSignal=n.BubbleSignalType=n.isEqual=void 0;const i=e("./constantsPool"),a=e("./invokeFunction"),s=e("./operators"),l=e("./std"),c=e("./utils"),u=e("./WTCDError");function isEqual(e,t){if(e.type!==t.type)return!1;switch(e.type){case"null":return!0;case"number":case"boolean":case"string":return e.value===t.value;case"action":if(e.value.action!==t.value.action)return!1;switch(e.value.action){case"exit":return!0;case"goto":return c.arrayEquals(e.value.target,t.value.target);case"selection":return e.value.choices.length===t.value.choices.length&&e.value.choices.every((e,n)=>isEqual(e,t.value.choices[n]))}throw new Error("Shouldn't fall through.");case"choice":return e.value.text===t.value.text&&isEqual(e.value.action,t.value.action);case"function":return e.value.fnType===t.value.fnType&&("native"===e.value.fnType?e.value.nativeFn===t.value.nativeFn:"wtcd"===e.value.fnType?e.value.expr===t.value.expr&&e.value.captured.every((e,n)=>{const i=t.value.captured[n];return e.name===i.name&&e.value===i.value}):e.value.isLeft===t.value.isLeft&&isEqual(e.value.targetFn,t.value.targetFn)&&c.arrayEquals(e.value.applied,t.value.applied,isEqual));case"list":return e.value.length===t.value.length&&e.value.every((e,n)=>isEqual(e,t.value[n]))}}var d;n.isEqual=isEqual,function(e){e[e.YIELD=0]="YIELD",e[e.RETURN=1]="RETURN",e[e.BREAK=2]="BREAK",e[e.CONTINUE=3]="CONTINUE"}(d=n.BubbleSignalType||(n.BubbleSignalType={}));class BubbleSignal extends Error{constructor(e){super("Uncaught Bubble Signal."),this.type=e,Object.setPrototypeOf(this,new.target.prototype)}}function describe(e){switch(e.type){case"number":case"boolean":return`${e.type} (value = ${e.value})`;case"string":return`string (value = "${e.value}")`;case"choice":return`choice (action = ${describe(e.value.action)}, label = "${e.value.text}")`;case"action":switch(e.value.action){case"goto":return`action (type = goto, target = ${e.value.target})`;case"exit":return"action (type = exit)";case"selection":return`action (type = selection, choices = [${e.value.choices.map(describe).join(", ")}])`}case"null":return"null";case"list":return`list (elements = [${e.value.map(describe).join(", ")}])`;case"function":return"native"===e.value.fnType?`function (native ${e.value.nativeFn.name})`:"wtcd"===e.value.fnType?`function (arguments = [${e.value.expr.arguments.map(e=>e.name).join(", ")}])`:`function (partial ${e.value.isLeft?"left":"right"}, applied = [${e.value.applied.map(describe).join(", ")}], targetFn = ${describe(e.value.targetFn)})`}}function isTypeAssignableTo(e,t){return null===t||t.includes(e)}n.BubbleSignal=BubbleSignal,n.describe=describe,n.isTypeAssignableTo=isTypeAssignableTo,n.assignValueToVariable=function assignValueToVariable(e,t,n,i){if(!isTypeAssignableTo(t.type,e.types))throw u.WTCDError.atLocation(n,`Cannot assign value (${describe(t)}) to variable "${i}". "${i}" can only store these types: `+e.types.join(", "));e.value=t};class RuntimeScope{constructor(){this.variables=new Map,this.registers=null}resolveVariableReference(e){return this.variables.get(e)||null}addVariable(e,t){this.variables.set(e,t)}addRegister(e){null===this.registers&&(this.registers=new Map),this.registers.set(e,i.getMaybePooled("null",null))}setRegisterIfExist(e,t){return null!==this.registers&&(!!this.registers.has(e)&&(this.registers.set(e,t),!0))}getRegister(e){return this.registers&&this.registers.get(e)||null}}class InvalidChoiceError extends Error{constructor(e){super(`Invalid choice ${e}.`),this.choiceId=e}}n.InvalidChoiceError=InvalidChoiceError;n.Interpreter=class Interpreter{constructor(e,t,n){this.wtcdRoot=e,this.random=t,this.featureProvider=n,this.timers=new Map,this.interpreterHandle={evaluator:this.evaluator.bind(this),pushScope:this.pushScope.bind(this),popScope:this.popScope.bind(this),resolveVariableReference:this.resolveVariableReference.bind(this),getRandom:()=>this.random,pushContent:this.pushContent.bind(this),timers:this.timers,setPinnedFunction:this.setPinnedFunction.bind(this),setStateDesc:this.setStateDesc.bind(this),featureProvider:this.featureProvider,canvases:new Map},this.pinnedFunction=null,this.pinned=[],this.stateDesc=null,this.scopes=[],this.sectionStack=[],this.started=!1,this.sectionEnterTimes=new Map,this.currentlyBuilding=[],this.sectionStack.push(this.wtcdRoot.sections[0])}setPinnedFunction(e){this.pinnedFunction=e}setStateDesc(e){this.stateDesc=e}resolveVariableReference(e){for(let t=this.scopes.length-1;t>=0;t--){const n=this.scopes[t].resolveVariableReference(e);if(null!==n)return n}throw u.WTCDError.atUnknown(`Cannot resolve variable reference "${e}". This is most likely caused by WTCD compiler's error or the compiled output has been modified`)}setRegister(e,t){for(let n=this.scopes.length-1;n>=0;n--)if(this.scopes[n].setRegisterIfExist(e,t))return;throw u.WTCDError.atUnknown(`Cannot resolve register reference "${e}". This is mostly likely caused by WTCD compiler's error or the compiled output has been modified`)}getCurrentScope(){return this.scopes[this.scopes.length-1]}pushScope(){const e=new RuntimeScope;return this.scopes.push(e),e}popScope(){return this.scopes.pop()}evaluateChoiceExpression(e){const t=this.evaluator(e.text);if("string"!==t.type)throw u.WTCDError.atLocation(e,"First argument of choice is expected to be a string, received: "+describe(t));let n=this.evaluator(e.action);if("action"!==n.type&&"function"!==n.type&&"null"!==n.type)throw u.WTCDError.atLocation(e,"Second argument of choice is expected to be an action, a function, or null, received: "+describe(t));return"function"===n.type&&(n={type:"action",value:{action:"function",fn:n,creator:e}}),{type:"choice",value:{text:t.value,action:n}}}evaluateConditionalExpression(e){const t=this.evaluator(e.condition);if("boolean"!==t.type)throw u.WTCDError.atLocation(e,"First argument of a conditional expression is expected to be a boolean, received: "+describe(t));return t.value?this.evaluator(e.then):this.evaluator(e.otherwise)}executeDeclarationStatement(e){for(const t of e.declarations){let n;if(null!==t.initialValue)n=this.evaluator(t.initialValue);else if(null===t.variableType)n=i.getMaybePooled("null",null);else if(1===t.variableType.length)switch(t.variableType[0]){case"boolean":n=i.getMaybePooled("boolean",!1);break;case"number":n=i.getMaybePooled("number",0);break;case"string":n=i.getMaybePooled("string","");break;case"list":n={type:"list",value:[]};break;default:throw u.WTCDError.atLocation(e,`Variable type "${t.variableType[0]}" does not have a default initial value`)}else{if(!t.variableType.includes("null"))throw u.WTCDError.atLocation(e,`Variable type "${t.variableType.join(" ")}" does not have a default initial value`);n=i.getMaybePooled("null",null)}if(!isTypeAssignableTo(n.type,t.variableType))throw u.WTCDError.atLocation(e,"The type of variable "+t.variableName+" is "+t.variableType+", thus cannot hold "+describe(n));this.getCurrentScope().addVariable(t.variableName,{types:t.variableType,value:n})}}evaluateBlockExpression(e){const t=this.pushScope();try{t.addRegister("yield");for(const t of e.statements)this.executeStatement(t);return t.getRegister("yield")}catch(e){if(e instanceof BubbleSignal&&e.type===d.YIELD)return t.getRegister("yield");throw e}finally{this.popScope()}}evaluateSelectionExpression(e){const t=this.evaluator(e.choices);if("list"!==t.type)throw u.WTCDError.atLocation(e,"Expression after selection is expected to be a list of choices, received: "+describe(t));const n=t.value.filter(e=>"null"!==e.type);for(let t=0;t<n.length;t++)if("choice"!==n[t].type)throw u.WTCDError.atLocation(e,`Choice at index ${t} is expected to be a choice, received: `+describe(n[t]));return{type:"action",value:{action:"selection",choices:n}}}evaluateListExpression(e){return{type:"list",value:c.flat(e.elements.map(e=>{if("spread"!==e.type)return this.evaluator(e);const t=this.evaluator(e.expression);if("list"!==t.type)throw u.WTCDError.atLocation(e,'Spread operator "..." can only be used before a list, received: '+describe(t));return t.value}))}}evaluateFunctionExpression(e){return{type:"function",value:{fnType:"wtcd",expr:e,captured:e.captures.map(e=>({name:e,value:this.resolveVariableReference(e)}))}}}evaluateSwitchExpression(e){const t=this.evaluator(e.expression);for(const n of e.cases){const e=this.evaluator(n.matches);if("list"!==e.type)throw u.WTCDError.atLocation(n.matches,"Value to match for each case is expected to be a list, received: "+describe(e));if(e.value.some(e=>isEqual(e,t)))return this.evaluator(n.returns)}if(null===e.defaultCase)throw u.WTCDError.atLocation(e,"None of the cases matched and no default case is provided");return this.evaluator(e.defaultCase)}evaluateWhileExpression(e){const t=this.pushScope();t.addRegister("break");let n=!1;try{for(;;){if(!n&&null!==e.preExpr)try{this.evaluator(e.preExpr)}catch(e){if(!(e instanceof BubbleSignal&&e.type===d.CONTINUE))throw e}n=!1;const t=this.evaluator(e.condition);if("boolean"!==t.type)throw u.WTCDError.atLocation(e,"Condition expression of a while loop is expected to return a boolean. Received: "+describe(t));if(!1===t.value)break;if(null!==e.postExpr)try{this.evaluator(e.postExpr)}catch(e){if(!(e instanceof BubbleSignal&&e.type===d.CONTINUE))throw e;n=!0}}}catch(e){if(e instanceof BubbleSignal&&e.type===d.BREAK)return t.getRegister("break");throw e}finally{this.popScope()}return t.getRegister("break")}evaluateIfExpression(e){const t=this.evaluator(e.condition);if("boolean"!==t.type)throw u.WTCDError.atLocation(e,"The condition of an if expression is expected to be a boolean. Received: "+describe(t));return t.value?this.evaluator(e.then):null!==e.otherwise?this.evaluator(e.otherwise):i.getMaybePooled("null",null)}evaluator(e){switch(e.type){case"unaryExpression":return s.unaryOperators.get(e.operator).fn(e,this.interpreterHandle);case"binaryExpression":return s.binaryOperators.get(e.operator).fn(e,this.interpreterHandle);case"booleanLiteral":return i.getMaybePooled("boolean",e.value);case"numberLiteral":return i.getMaybePooled("number",e.value);case"stringLiteral":return i.getMaybePooled("string",e.value);case"nullLiteral":return i.getMaybePooled("null",null);case"list":return this.evaluateListExpression(e);case"choiceExpression":return this.evaluateChoiceExpression(e);case"conditionalExpression":return this.evaluateConditionalExpression(e);case"block":return this.evaluateBlockExpression(e);case"gotoAction":return{type:"action",value:{action:"goto",target:e.sections}};case"exitAction":return{type:"action",value:{action:"exit"}};case"selection":return this.evaluateSelectionExpression(e);case"variableReference":return this.resolveVariableReference(e.variableName).value;case"function":return this.evaluateFunctionExpression(e);case"switch":return this.evaluateSwitchExpression(e);case"while":return this.evaluateWhileExpression(e);case"if":return this.evaluateIfExpression(e);case"tag":return{type:"list",value:[i.getMaybePooled("string",e.name)]}}}executeStatement(e){switch(e.type){case"declaration":return void this.executeDeclarationStatement(e);case"expression":return void this.evaluator(e.expression);case"yield":throw this.setRegister("yield",this.evaluator(e.value)),new BubbleSignal(d.YIELD);case"setYield":return void this.setRegister("yield",this.evaluator(e.value));case"return":throw this.setRegister("return",this.evaluator(e.value)),new BubbleSignal(d.RETURN);case"setReturn":return void this.setRegister("return",this.evaluator(e.value));case"break":throw this.setRegister("break",this.evaluator(e.value)),new BubbleSignal(d.BREAK);case"setBreak":return void this.setRegister("break",this.evaluator(e.value));case"continue":throw new BubbleSignal(d.CONTINUE)}}addToSectionStack(e){for(const t of this.wtcdRoot.sections)if(t.name===e)return void this.sectionStack.push(t);throw u.WTCDError.atUnknown(`Unknown section "${e}"`)}updatePinned(){if(null!==this.pinnedFunction){try{a.invokeFunctionRaw(this.pinnedFunction.value,[],this.interpreterHandle)}catch(e){if(e instanceof a.FunctionInvocationError)throw u.WTCDError.atUnknown(`Failed to invoke the pinned function (${describe(this.pinnedFunction)}): `+e.message);throw e instanceof u.WTCDError&&e.pushWTCDStack("Pinned function ("+describe(this.pinnedFunction)+")"),e}this.pinned=this.currentlyBuilding,this.currentlyBuilding=[]}else 0!==this.pinned.length&&(this.pinned=[])}*executeAction(e){switch(e.value.action){case"goto":for(let t=e.value.target.length-1;t>=0;t--)this.addToSectionStack(e.value.target[t]);break;case"exit":this.sectionStack.length=0;break;case"selection":{const t=e.value.choices,n=t.map(e=>({content:e.value.text,disabled:"null"===e.value.action.type})),i={content:this.currentlyBuilding,choices:n};this.currentlyBuilding=[],this.updatePinned();const a=yield i,s=t[a];if(void 0===s||"null"===s.value.action.type)throw new InvalidChoiceError(a);yield*this.executeAction(s.value.action);break}case"function":{let t;try{t=a.invokeFunctionRaw(e.value.fn.value,[],this.interpreterHandle)}catch(t){if(t instanceof a.FunctionInvocationError)throw u.WTCDError.atLocation(e.value.creator,"Failed to evaluate the function action for this choice: "+t.message);throw t instanceof u.WTCDError&&t.pushWTCDStack("Function action",e.value.creator),t}if("action"===t.type)yield*this.executeAction(t);else if("null"!==t.type)throw u.WTCDError.atLocation(e.value.creator,"Value returned an function action is expected to be an action or null. Received: "+describe(t));break}}}pushContent(e){this.currentlyBuilding.push(e)}runSection(e){const t=document.createElement("div");null!==e.executes&&this.evaluator(e.executes);const n=this.sectionEnterTimes.has(e.name)?this.sectionEnterTimes.get(e.name)+1:1;this.sectionEnterTimes.set(e.name,n);const i=e.content.filter(e=>(void 0===e.lowerBound||e.lowerBound<=n)&&(void 0===e.upperBound||e.upperBound>=n));if(0!==i.length){const e=i[this.random.nextInt(0,i.length)];t.innerHTML=e.html;for(const n of e.variables)t.getElementsByClassName(n.elementClass)[0].innerText=String(this.resolveVariableReference(n.variableName).value.value);let n=t.firstChild;for(;null!==n;)n instanceof HTMLElement&&this.pushContent(n),n=n.nextSibling}return this.evaluator(e.then)}getPinned(){return this.pinned}getStateDesc(){return this.stateDesc}*start(){const e=this.pushScope();for(const t of l.stdFunctions)e.addVariable(t.name,{types:["function"],value:{type:"function",value:{fnType:"native",nativeFn:t}}});if(this.pushScope(),this.started)throw new Error("Interpretation has already started.");this.started=!0;let t=null;try{for(const e of this.wtcdRoot.initStatements)this.executeStatement(e);for(;0!==this.sectionStack.length;){const e=this.sectionStack.pop();t=e;const n=this.runSection(e);if("action"===n.type)yield*this.executeAction(n);else if("null"!==n.type)throw u.WTCDError.atLocation(e.then,"Expression after then is expected to return an action, or null, received: "+describe(n))}}catch(e){if(e instanceof BubbleSignal)throw u.WTCDError.atUnknown(`Uncaught BubbleSignal with type "${e.type}".`);throw e instanceof u.WTCDError&&(null===t?e.pushWTCDStack("initialization"):e.pushWTCDStack(`section "${t.name}"`,t)),e}const n={content:this.currentlyBuilding,choices:[]};return this.updatePinned(),n}}},{"./WTCDError":72,"./constantsPool":74,"./invokeFunction":75,"./operators":76,"./std":80,"./utils":87}],71:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Random=void 0;n.Random=class Random{constructor(e){const t=function xmur3(e){let t=1779033703^e.length;for(let n=0;n<e.length;n++)t=Math.imul(t^e.charCodeAt(n),3432918353),t=t<<13|t>>>19;return()=>(t=Math.imul(t^t>>>16,2246822507),t=Math.imul(t^t>>>13,3266489909),(t^=t>>>16)>>>0)}(e);this.rng=function sfc32(e,t,n,i){return()=>{let a=(e>>>=0)+(t>>>=0)|0;return e=t^t>>>9,t=(n>>>=0)+(n<<3)|0,a=a+(i=(i>>>=0)+1|0)|0,n=(n=n<<21|n>>>11)+a|0,(a>>>0)/4294967296}}(t(),t(),t(),t())}next(e=0,t=1){return this.rng()*(t-e)+e}nextBool(){return this.rng()<.5}nextInt(e,t){return Math.floor(this.next(e,t))}}},{}],72:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.WTCDError=void 0;const i={};class WTCDError extends Error{constructor(e,t,n){super(e),this.line=t,this.column=n,this.wtcdStackArray=[],this.name="WTCDError"}get wtcdStack(){return this.message+"\n"+this.wtcdStackArray.join("\n")}pushWTCDStack(e,t=i){this.wtcdStackArray.push("    at "+e+(t.line?":"+t.line+(t.column?":"+t.column:""):""))}static atUnknown(e){return new WTCDError(e+" at unknown location. (Location info is not available for this type of error)",null,null)}static atLineColumn(e,t,n){return new WTCDError(n+` at ${e}:${t}.`,e,t)}static atLocation(e,t){return null===e?WTCDError.atUnknown(t):void 0===e.line?new WTCDError(t+" at unknown location. (Try recompile in debug mode to enable source map)",null,null):WTCDError.atLineColumn(e.line,e.column,t)}}n.WTCDError=WTCDError},{}],73:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.autoEvaluated=void 0,n.autoEvaluated=function autoEvaluated(e){return(t,n)=>{const i=n.evaluator(t.arg0),a=n.evaluator(t.arg1);return e(i,a,t,n)}}},{}],74:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.getMaybePooled=n.booleanValue=n.smallIntegers=n.falseValue=n.trueValue=n.nullValue=void 0,n.nullValue={type:"null",value:null},n.trueValue={type:"boolean",value:!0},n.falseValue={type:"boolean",value:!1},n.smallIntegers=[];for(let e=0;e<=100;e++)n.smallIntegers.push({type:"number",value:e});function booleanValue(e){return e?n.trueValue:n.falseValue}n.booleanValue=booleanValue,n.getMaybePooled=function getMaybePooled(e,t){return"null"===e?n.nullValue:"boolean"===e?booleanValue(t):"number"===e&&t>=0&&t<=100&&t%1==0?n.smallIntegers[t]:{type:e,value:t}}},{}],75:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.reverseInvocation=n.pipelineInvocation=n.regularInvocation=n.regularInvocationRaw=n.invokeFunctionRaw=n.FunctionInvocationError=void 0;const i=e("./autoEvaluated"),a=e("./constantsPool"),s=e("./Interpreter"),l=e("./std/utils"),c=e("./WTCDError");class FunctionInvocationError extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}function invokeFunctionRaw(e,t,n){const{evaluator:i,pushScope:c,popScope:u}=n;if("native"===e.fnType)try{return e.nativeFn(t,n)}catch(t){throw t instanceof l.NativeFunctionError?new FunctionInvocationError(`Failed to call native function "${e.nativeFn.name}". Reason: ${t.message}`):t}else{if("wtcd"!==e.fnType){let i=e;const a=[],s=[];do{i.isLeft?a.unshift(...i.applied):s.push(...i.applied),i=i.targetFn.value}while("partial"===i.fnType);return invokeFunctionRaw(i,[...a,...t,...s],n)}{const n=c();try{n.addRegister("return"),e.expr.arguments.forEach((e,l)=>{let c=t[l];if(void 0===c||"null"===c.type)if(null!==e.defaultValue)c=i(e.defaultValue);else{if(!s.isTypeAssignableTo("null",e.type))throw new FunctionInvocationError("The argument with index = "+l+" of invocation is omitted, but it does not have a default value and it does not allow null values");c=a.getMaybePooled("null",null)}if(!s.isTypeAssignableTo(c.type,e.type))throw new FunctionInvocationError("The argument with index = "+l+" of invocation has wrong type. Expected: "+`${e.type}, received: ${s.describe(c)}`);n.addVariable(e.name,{types:[c.type],value:c})}),null!==e.expr.restArgName&&n.addVariable(e.expr.restArgName,{types:["list"],value:{type:"list",value:t.slice(e.expr.arguments.length)}}),e.captured.forEach(e=>{n.addVariable(e.name,e.value)});const l=i(e.expr.expression),c=n.getRegister("return");return"null"===c.type?l:c}catch(e){if(e instanceof s.BubbleSignal&&e.type===s.BubbleSignalType.RETURN)return n.getRegister("return");throw e}finally{u()}}}}function handleError(e,t){if(t instanceof FunctionInvocationError)throw c.WTCDError.atLocation(e,t.message);throw t instanceof c.WTCDError&&t.pushWTCDStack(`"${e.operator}" invocation`,e),t}n.FunctionInvocationError=FunctionInvocationError,n.invokeFunctionRaw=invokeFunctionRaw,n.regularInvocationRaw=(e,t,n,i)=>{if("function"!==e.type)throw c.WTCDError.atLocation(n,`Left side of function invocation "${n.operator}" is expected to be a function, received: `+s.describe(e));if("list"!==t.type)throw c.WTCDError.atLocation(n,`Right side of function invocation "${n.operator}" is expected to be a list, received: `+s.describe(t));try{return invokeFunctionRaw(e.value,t.value,i)}catch(e){return handleError(n,e)}},n.regularInvocation=i.autoEvaluated(n.regularInvocationRaw),n.pipelineInvocation=i.autoEvaluated((e,t,n,i)=>{if("function"!==t.type)throw c.WTCDError.atLocation(n,'Right side of pipeline invocation "|>" is expected to be a function, received: '+s.describe(t));try{return invokeFunctionRaw(t.value,[e],i)}catch(e){return handleError(n,e)}}),n.reverseInvocation=i.autoEvaluated((e,t,n,i)=>{if("list"!==e.type)throw c.WTCDError.atLocation(n,'Left side of reverse invocation "|::" is expected to be a list, received: '+s.describe(e));if("function"!==t.type)throw c.WTCDError.atLocation(n,'Right side of reverse invocation "|::" is expected to be a function, received: '+s.describe(t));try{return invokeFunctionRaw(t.value,e.value,i)}catch(e){return handleError(n,e)}})},{"./Interpreter":70,"./WTCDError":72,"./autoEvaluated":73,"./constantsPool":74,"./std/utils":86}],76:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.operators=n.conditionalOperatorPrecedence=n.binaryOperators=n.unaryOperators=void 0;const i=e("./autoEvaluated"),a=e("./constantsPool"),s=e("./Interpreter"),l=e("./invokeFunction"),c=e("./WTCDError");function autoEvaluatedSameTypeArg(e,t,n){return i.autoEvaluated((i,l,u,d)=>{if(i.type===e&&l.type===e)return a.getMaybePooled(t,n(i.value,l.value,u,d));throw c.WTCDError.atLocation(u,`Binary operator "${u.operator}" can only be applied to two ${e}s, received: ${s.describe(i)} (left) and `+s.describe(l)+" (right)")})}function opAssignment(e,t,n){return(i,l)=>{if("variableReference"!==i.arg0.type)throw c.WTCDError.atLocation(i,`Left side of binary operator "${i.operator}" has to be a variable reference`);const u=l.resolveVariableReference(i.arg0.variableName);if(u.value.type!==e)throw c.WTCDError.atLocation(i,`Left side of binary operator "${i.operator}" has to be a variable of type ${e}, actual type: ${u.value.type}`);const d=l.evaluator(i.arg1);if(d.type!==t)throw c.WTCDError.atLocation(i,`Right side of binary operator "${i.operator}"  has to be a ${t}, received: ${s.describe(d)}`);const p=a.getMaybePooled(e,n(u.value.value,d.value,i,l));return u.value=p,p}}n.unaryOperators=new Map([["-",{precedence:17,fn:(e,{evaluator:t})=>{const n=t(e.arg);if("number"!==n.type)throw c.WTCDError.atLocation(e,'Unary operator "-" can only be applied to a number, received: '+s.describe(n));return a.getMaybePooled("number",-n.value)}}],["!",{precedence:17,fn:(e,{evaluator:t})=>{const n=t(e.arg);if("boolean"!==n.type)throw c.WTCDError.atLocation(e,'Unary operator "!" can only be applied to a boolean, received: '+s.describe(n));return a.getMaybePooled("boolean",!n.value)}}]]),n.binaryOperators=new Map([["=",{precedence:3,fn:(e,{evaluator:t,resolveVariableReference:n})=>{if("variableReference"!==e.arg0.type)throw c.WTCDError.atLocation(e,'Left side of binary operator "=" has to be a variable reference');const i=n(e.arg0.variableName),a=t(e.arg1);return s.assignValueToVariable(i,a,e,e.arg0.variableName),a}}],["+=",{precedence:3,fn:(e,{evaluator:t,resolveVariableReference:n})=>{if("variableReference"!==e.arg0.type)throw c.WTCDError.atLocation(e,'Left side of binary operator "+=" has to be a variable reference');const i=n(e.arg0.variableName);if("string"!==i.value.type&&"number"!==i.value.type)throw c.WTCDError.atLocation(e,'Left side of binary operator "+=" has to be a variable of type number or string, actual type: '+i.value.type);const l=t(e.arg1);if(l.type!==i.value.type)throw c.WTCDError.atLocation(e,`Right side of binary operator "+=" has to  be a ${i.value.type}, received: ${s.describe(l)}`);const u=a.getMaybePooled(i.value.type,i.value.value+l.value);return i.value=u,u}}],["-=",{precedence:3,fn:opAssignment("number","number",(e,t)=>e-t)}],["*=",{precedence:3,fn:opAssignment("number","number",(e,t)=>e*t)}],["/=",{precedence:3,fn:opAssignment("number","number",(e,t)=>e/t)}],["~/=",{precedence:3,fn:opAssignment("number","number",(e,t)=>Math.trunc(e/t))}],["%=",{precedence:3,fn:opAssignment("number","number",(e,t)=>e%t)}],["|>",{precedence:5,fn:l.pipelineInvocation}],["|::",{precedence:5,fn:l.reverseInvocation}],["||",{precedence:6,fn:(e,{evaluator:t})=>{const n=t(e.arg0);if("boolean"!==n.type)throw c.WTCDError.atLocation(e,'Left side of binary operator "||" has to be a boolean. Received '+s.describe(n));if(!0===n.value)return a.getMaybePooled("boolean",!0);const i=t(e.arg1);if("boolean"!==i.type)throw c.WTCDError.atLocation(e,'Right side of binary operator "||" has to be a boolean. Received '+s.describe(i));return a.getMaybePooled("boolean",i.value)}}],["?!",{precedence:6,fn:(e,{evaluator:t})=>{const n=t(e.arg0);if("null"!==n.type)return n;const i=t(e.arg1);if("null"===i.type)throw c.WTCDError.atLocation(e,'Right side of binary operator "?!" cannot be null. If returning null is desired in this case, please use "??" instead');return i}}],["??",{precedence:6,fn:(e,{evaluator:t})=>{const n=t(e.arg0);return"null"!==n.type?n:t(e.arg1)}}],["&&",{precedence:7,fn:(e,{evaluator:t})=>{const n=t(e.arg0);if("boolean"!==n.type)throw c.WTCDError.atLocation(e,'Left side of binary operator "&&" has to be a boolean. Received '+s.describe(n));if(!1===n.value)return a.getMaybePooled("boolean",!1);const i=t(e.arg1);if("boolean"!==i.type)throw c.WTCDError.atLocation(e,'Right side of binary operator "&&" has to be a boolean. Received '+s.describe(i));return a.getMaybePooled("boolean",i.value)}}],["==",{precedence:11,fn:i.autoEvaluated((e,t)=>a.getMaybePooled("boolean",s.isEqual(e,t)))}],["!=",{precedence:11,fn:i.autoEvaluated((e,t)=>a.getMaybePooled("boolean",!s.isEqual(e,t)))}],["<",{precedence:12,fn:autoEvaluatedSameTypeArg("number","boolean",(e,t)=>e<t)}],["<=",{precedence:12,fn:autoEvaluatedSameTypeArg("number","boolean",(e,t)=>e<=t)}],[">",{precedence:12,fn:autoEvaluatedSameTypeArg("number","boolean",(e,t)=>e>t)}],[">=",{precedence:12,fn:autoEvaluatedSameTypeArg("number","boolean",(e,t)=>e>=t)}],["+",{precedence:14,fn:i.autoEvaluated((e,t,n)=>{if("number"===e.type&&"number"===t.type)return a.getMaybePooled("number",e.value+t.value);if("string"===e.type&&"string"===t.type)return a.getMaybePooled("string",e.value+t.value);throw c.WTCDError.atLocation(n,`Binary operator "+" can only be applied to two strings or two numbers, received: ${s.describe(e)} (left) and `+s.describe(t)+" (right)")})}],["-",{precedence:14,fn:autoEvaluatedSameTypeArg("number","number",(e,t)=>e-t)}],["*",{precedence:15,fn:autoEvaluatedSameTypeArg("number","number",(e,t)=>e*t)}],["/",{precedence:15,fn:autoEvaluatedSameTypeArg("number","number",(e,t)=>e/t)}],["~/",{precedence:15,fn:autoEvaluatedSameTypeArg("number","number",(e,t)=>Math.trunc(e/t))}],["%",{precedence:15,fn:autoEvaluatedSameTypeArg("number","number",(e,t)=>e%t)}],["**",{precedence:16,fn:autoEvaluatedSameTypeArg("number","number",(e,t)=>e**t)}],[".",{precedence:19,fn:i.autoEvaluated((e,t,n)=>{if("list"!==e.type)throw c.WTCDError.atLocation(n,'Left side of binary operator "." is expected to be a list. Received: '+s.describe(e));if("number"!==t.type||t.value%1!=0)throw c.WTCDError.atLocation(n,'Right side of binary operator "." is expected to be an integer. Received: '+s.describe(t));const i=e.value[t.value];if(void 0===i)throw c.WTCDError.atLocation(n,"List does not have an element at "+t.value+'. If return null is desired, use ".?" instead. List contents: '+s.describe(e));return i})}],[".?",{precedence:19,fn:i.autoEvaluated((e,t,n)=>{if("list"!==e.type)throw c.WTCDError.atLocation(n,'Left side of binary operator ".?" is expected to be a list. Received: '+s.describe(e));if("number"!==t.type||t.value%1!=0)throw c.WTCDError.atLocation(n,'Right side of binary operator ".?" is expected to be an integer. Received: '+s.describe(t));const i=e.value[t.value];return void 0===i?a.getMaybePooled("null",null):i})}],["?.",{precedence:19,fn:(e,{evaluator:t})=>{const n=t(e.arg0);if("null"===n.type)return n;if("list"!==n.type)throw c.WTCDError.atLocation(e,'Left side of binary operator "?." is expected to be a list or null. Received: '+s.describe(n));const i=t(e.arg1);if("number"!==i.type||i.value%1!=0)throw c.WTCDError.atLocation(e,'Right side of binary operator "?." is expected to be an integer. Received: '+s.describe(i));const a=n.value[i.value];if(void 0===a)throw c.WTCDError.atLocation(e,"List does not have an element at "+i.value+'. If return null is desired, use "?.?" instead. List contents: '+s.describe(n));return a}}],["?.?",{precedence:19,fn:(e,{evaluator:t})=>{const n=t(e.arg0);if("null"===n.type)return n;if("list"!==n.type)throw c.WTCDError.atLocation(e,'Left side of binary operator "?.?" is expected to be a list or null. Received: '+s.describe(n));const i=t(e.arg1);if("number"!==i.type||i.value%1!=0)throw c.WTCDError.atLocation(e,'Right side of binary operator "?.?" is expected to be an integer. Received: '+s.describe(i));const l=n.value[i.value];return void 0===l?a.getMaybePooled("null",null):l}}],["::",{precedence:20,fn:l.regularInvocation}],["?::",{precedence:20,fn:(e,t)=>{const{evaluator:n}=t,i=n(e.arg0);return"null"===i.type?i:l.regularInvocationRaw(i,n(e.arg1),e,t)}}],[".:",{precedence:20,fn:i.autoEvaluated((e,t,n)=>{if("function"!==e.type)throw c.WTCDError.atLocation(n,'Left side of binary operator ".:" is expected to be a function. Received: '+s.describe(e));if("list"!==t.type)throw c.WTCDError.atLocation(n,'Right side of binary operator ".:" is expected to be a list. Received: '+s.describe(t));return 0===t.value.length?e:{type:"function",value:{fnType:"partial",isLeft:!1,applied:t.value,targetFn:e}}})}],[":.",{precedence:20,fn:i.autoEvaluated((e,t,n)=>{if("function"!==e.type)throw c.WTCDError.atLocation(n,'Left side of binary operator ":." is expected to be a function. Received: '+s.describe(e));if("list"!==t.type)throw c.WTCDError.atLocation(n,'Right side of binary operator ":." is expected to be a list. Received: '+s.describe(t));return 0===t.value.length?e:{type:"function",value:{fnType:"partial",isLeft:!0,applied:t.value,targetFn:e}}})}]]),n.conditionalOperatorPrecedence=4,n.operators=new Set([...n.unaryOperators.keys(),...n.binaryOperators.keys(),"?",":","..."])},{"./Interpreter":70,"./WTCDError":72,"./autoEvaluated":73,"./constantsPool":74,"./invokeFunction":75}],77:[function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(a,s){function fulfilled(e){try{step(i.next(e))}catch(e){s(e)}}function rejected(e){try{step(i.throw(e))}catch(e){s(e)}}function step(e){e.done?a(e.value):function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(fulfilled,rejected)}step((i=i.apply(e,t||[])).next())}))};Object.defineProperty(n,"__esModule",{value:!0}),n.canvasStdFunctions=void 0;const a=e("../constantsPool"),s=e("./utils"),l=e("../ChainedCanvas");function obtainCanvas(e,t){const n=e.canvases.get(t);if(void 0===n)throw new s.NativeFunctionError(`Canvas with id="${t}" does not exist.`);return n}function assertIsHAlign(e){switch(e){case"left":case"center":case"right":case"start":case"end":break;default:throw new s.NativeFunctionError("Unknown text hAlign: "+e)}}function assertIsVAlign(e){switch(e){case"top":case"hanging":case"middle":case"alphabetic":case"ideographic":case"bottom":break;default:throw new s.NativeFunctionError("Unknown text vAlign: "+e)}}n.canvasStdFunctions=[function canvasCreate(e,t){s.assertArgsLength(e,3);const n=s.assertArgType(e,0,"string"),i=s.assertArgType(e,1,"number"),c=s.assertArgType(e,2,"number");if(t.canvases.has(n))throw new s.NativeFunctionError(`Canvas with id="${n}" already exists`);if(i%1!=0)throw new s.NativeFunctionError(`Width (${i}) has to be an integer`);if(i<=0)throw new s.NativeFunctionError(`Width (${i}) must be positive`);if(c%1!=0)throw new s.NativeFunctionError(`Height (${c}) has to be an integer`);if(c<=0)throw new s.NativeFunctionError(`Height (${c}) must be positive`);return t.canvases.set(n,new l.ChainedCanvas(i,c)),a.getMaybePooled("null",null)},function canvasOutput(e,t){const n=obtainCanvas(t,s.assertArgType(e,0,"string")),i=document.createElement("canvas");return i.width=n.getWidth(),i.height=n.getHeight(),i.style.maxWidth="100%",t.featureProvider.drawLoadingCanvas(i),t.pushContent(i),n.onResolve(()=>{if(document.body.contains(i)){const e=i.getContext("2d");e.clearRect(0,0,i.width,i.height),e.drawImage(n.canvas,0,0)}}),a.getMaybePooled("null",null)},function canvasClear(e,t){const n=obtainCanvas(t,s.assertArgType(e,0,"string"));return n.updatePromise(()=>i(this,void 0,void 0,(function*(){n.ctx.clearRect(0,0,n.getWidth(),n.getHeight())}))),a.getMaybePooled("null",null)},function canvasPutImage(e,t){s.assertArgsLength(e,4,6);const n=s.assertArgType(e,0,"string"),l=s.assertArgType(e,1,"string"),c=s.assertArgType(e,2,"number"),u=s.assertArgType(e,3,"number"),d=s.assertArgType(e,4,"number",-1),p=s.assertArgType(e,5,"number",-1);if(d<0!=p<0)throw new s.NativeFunctionError("Width and height must be provided at the same time.");const g=obtainCanvas(t,n);return g.updatePromise(()=>i(this,void 0,void 0,(function*(){try{const e=yield t.featureProvider.loadImage(l);d<0?g.ctx.drawImage(e,c,u):g.ctx.drawImage(e,c,u,d,p)}catch(e){console.error(`WTCD failed to load image with path="${l}".`,e)}}))),a.getMaybePooled("null",null)},function canvasPutImagePart(e,t){s.assertArgsLength(e,8,10);const n=s.assertArgType(e,0,"string"),l=s.assertArgType(e,1,"string"),c=s.assertArgType(e,2,"number"),u=s.assertArgType(e,3,"number"),d=s.assertArgType(e,4,"number"),p=s.assertArgType(e,5,"number"),g=s.assertArgType(e,6,"number"),m=s.assertArgType(e,7,"number"),E=s.assertArgType(e,8,"number",-1),T=s.assertArgType(e,9,"number",-1);if(E<0!=T<0)throw new s.NativeFunctionError("destWidth and destHeight must be provided at the same time.");const f=obtainCanvas(t,n);return f.updatePromise(()=>i(this,void 0,void 0,(function*(){try{const e=yield t.featureProvider.loadImage(l);E<0?f.ctx.drawImage(e,c,u,d,p,g,m,d,p):f.ctx.drawImage(e,c,u,d,p,g,m,E,T)}catch(e){console.error(`WTCD failed to load image with path="${l}".`,e)}}))),a.getMaybePooled("null",null)},function canvasSetFont(e,t){s.assertArgsLength(e,3);const n=s.assertArgType(e,0,"string"),l=s.assertArgType(e,1,"number"),c=s.assertArgType(e,2,"string"),u=obtainCanvas(t,n);return u.updatePromise(()=>i(this,void 0,void 0,(function*(){try{const e=yield t.featureProvider.loadFont(c);u.ctx.font=`${l}px ${e}`}catch(e){console.error(`WTCD failed to load font with identifier="${c}".`,e)}}))),a.getMaybePooled("null",null)},function canvasSetFillStyle(e,t){s.assertArgsLength(e,2);const n=s.assertArgType(e,0,"string"),l=s.assertArgType(e,1,"string"),c=obtainCanvas(t,n);return c.updatePromise(()=>i(this,void 0,void 0,(function*(){c.ctx.fillStyle=l}))),a.getMaybePooled("null",null)},function canvasFillText(e,t){s.assertArgsLength(e,4,6);const n=s.assertArgType(e,0,"string"),l=s.assertArgType(e,1,"string"),c=s.assertArgType(e,2,"number"),u=s.assertArgType(e,3,"number"),d=s.assertArgType(e,4,"string","start"),p=s.assertArgType(e,5,"string","alphabetic"),g=obtainCanvas(t,n);return assertIsHAlign(d),assertIsVAlign(p),g.updatePromise(()=>i(this,void 0,void 0,(function*(){const e=g.ctx;e.textAlign=d,e.textBaseline=p,e.fillText(l,c,u)}))),a.getMaybePooled("null",null)},function canvasFillRect(e,t){s.assertArgsLength(e,5);const n=s.assertArgType(e,0,"string"),l=s.assertArgType(e,1,"number"),c=s.assertArgType(e,2,"number"),u=s.assertArgType(e,3,"number"),d=s.assertArgType(e,4,"number"),p=obtainCanvas(t,n);return p.updatePromise(()=>i(this,void 0,void 0,(function*(){p.ctx.fillRect(l,c,u,d)}))),a.getMaybePooled("null",null)},function canvasSetStrokeStyle(e,t){s.assertArgsLength(e,2);const n=s.assertArgType(e,0,"string"),l=s.assertArgType(e,1,"string"),c=obtainCanvas(t,n);return c.updatePromise(()=>i(this,void 0,void 0,(function*(){c.ctx.strokeStyle=l}))),a.getMaybePooled("null",null)},function canvasSetLineWidth(e,t){s.assertArgsLength(e,2);const n=s.assertArgType(e,0,"string"),l=s.assertArgType(e,1,"number"),c=obtainCanvas(t,n);return c.updatePromise(()=>i(this,void 0,void 0,(function*(){c.ctx.lineWidth=l}))),a.getMaybePooled("null",null)},function canvasStrokeText(e,t){s.assertArgsLength(e,4,6);const n=s.assertArgType(e,0,"string"),l=s.assertArgType(e,1,"string"),c=s.assertArgType(e,2,"number"),u=s.assertArgType(e,3,"number"),d=s.assertArgType(e,4,"string","start"),p=s.assertArgType(e,5,"string","alphabetic"),g=obtainCanvas(t,n);return assertIsHAlign(d),assertIsVAlign(p),g.updatePromise(()=>i(this,void 0,void 0,(function*(){const e=g.ctx;e.textAlign=d,e.textBaseline=p,e.lineJoin="round",e.lineCap="round",e.strokeText(l,c,u)}))),a.getMaybePooled("null",null)}]},{"../ChainedCanvas":66,"../constantsPool":74,"./utils":86}],78:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.contentStdFunctions=void 0;const i=e("../constantsPool"),a=e("../Interpreter"),s=e("./utils");n.contentStdFunctions=[function contentAddParagraph(e,t){s.assertArgsLength(e,1);const n=document.createElement("p");return n.innerText=s.assertArgType(e,0,"string"),t.pushContent(n),i.getMaybePooled("null",null)},function contentAddImage(e,t){s.assertArgsLength(e,1);const n=document.createElement("img");return n.src=s.assertArgType(e,0,"string"),t.pushContent(n),i.getMaybePooled("null",null)},function contentAddUnorderedList(e,t){const n=document.createElement("ul");for(let t=0;t<e.length;t++){const i=s.assertArgType(e,t,"string"),a=document.createElement("li");a.innerText=i,n.appendChild(a)}return t.pushContent(n),i.getMaybePooled("null",null)},function contentAddOrderedList(e,t){const n=document.createElement("ol");for(let t=0;t<e.length;t++){const i=s.assertArgType(e,t,"string"),a=document.createElement("li");a.innerText=i,n.appendChild(a)}return t.pushContent(n),i.getMaybePooled("null",null)},function contentAddHeader(e,t){s.assertArgsLength(e,1,2);const n=s.assertArgType(e,1,"number",1);if(![1,2,3,4,5,6].includes(n))throw new s.NativeFunctionError("There is no header with level "+n);const a=document.createElement("h"+n);return a.innerText=s.assertArgType(e,0,"string"),t.pushContent(a),i.getMaybePooled("null",null)},function contentAddTable(e,t){s.assertArgsLength(e,1,1/0);const n=e.map((t,n)=>s.assertArgType(e,n,"list"));n.forEach((e,t)=>{if(e.length!==n[0].length)throw new s.NativeFunctionError(`Row with index = ${t} has incorrect number of items. Expecting ${n[0].length}, received `+e.length);e.forEach((e,n)=>{if("string"!==e.type)throw new s.NativeFunctionError("Item in row with index = "+t+`, and column with index = ${n} is expected to be a string, received: `+a.describe(e))})});const l=document.createElement("table"),c=document.createElement("thead"),u=document.createElement("tr");n.shift().forEach(e=>{const t=document.createElement("th");t.innerText=e.value,u.appendChild(t)}),c.appendChild(u),l.appendChild(c);const d=document.createElement("tbody");return n.forEach(e=>{const t=document.createElement("tr");e.forEach(e=>{const n=document.createElement("td");n.innerText=e.value,t.appendChild(n)}),d.appendChild(t)}),l.appendChild(d),t.pushContent(l),i.getMaybePooled("null",null)},function contentAddHorizontalRule(e,t){return s.assertArgsLength(e,0),t.pushContent(document.createElement("hr")),i.getMaybePooled("null",null)}]},{"../Interpreter":70,"../constantsPool":74,"./utils":86}],79:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.debugStdFunctions=void 0;const i=e("../constantsPool"),a=e("../Interpreter"),s=e("../invokeFunction"),l=e("../WTCDError"),c=e("./utils");n.debugStdFunctions=[function print(e){return console.group("WTCD print call"),e.forEach((e,t)=>console.info(`[${t}] ${a.describe(e)}`)),console.groupEnd(),i.getMaybePooled("null",null)},function assert(e){c.assertArgsLength(e,1);if(!c.assertArgType(e,0,"boolean"))throw new c.NativeFunctionError("Assertion failed");return i.getMaybePooled("null",null)},function assertError(e,t){c.assertArgsLength(e,1);const n=c.assertArgType(e,0,"function");try{s.invokeFunctionRaw(n,[],t)}catch(e){if(e instanceof l.WTCDError||e instanceof s.FunctionInvocationError)return i.getMaybePooled("null",null);throw e}throw new c.NativeFunctionError("Assertion failed, no error is thrown")},function timeStart(e,t){c.assertArgsLength(e,0,1);const n=c.assertArgType(e,0,"string","default");if(t.timers.has(n))throw new c.NativeFunctionError(`Timer "${n}" already existed.`);return t.timers.set(n,Date.now()),i.getMaybePooled("null",null)},function timeEnd(e,t){c.assertArgsLength(e,0,1);const n=c.assertArgType(e,0,"string","default");if(!t.timers.has(n))throw new c.NativeFunctionError(`Cannot find timer "${n}".`);const a=t.timers.get(n);t.timers.delete(n);const s=Date.now();return console.group("WTCD timeEnd call"),console.info("Timer        : "+n),console.info("Start time   : "+a),console.info("End time     : "+s),console.info(`Time elapsed : ${s-a}ms`),console.groupEnd(),i.getMaybePooled("null",null)}]},{"../Interpreter":70,"../WTCDError":72,"../constantsPool":74,"../invokeFunction":75,"./utils":86}],80:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.stdFunctions=void 0;const i=e("./content"),a=e("./debug"),s=e("./list"),l=e("./math"),c=e("./random"),u=e("./reader"),d=e("./string"),p=e("./canvas");n.stdFunctions=[...i.contentStdFunctions,...a.debugStdFunctions,...s.listStdFunctions,...l.mathStdFunctions,...c.randomStdFunctions,...u.readerStdFunctions,...d.stringStdFunctions,...p.canvasStdFunctions]},{"./canvas":77,"./content":78,"./debug":79,"./list":81,"./math":82,"./random":83,"./reader":84,"./string":85}],81:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.listStdFunctions=void 0;const i=e("../constantsPool"),a=e("../Interpreter"),s=e("../invokeFunction"),l=e("../WTCDError"),c=e("./utils");n.listStdFunctions=[function listSet(e){c.assertArgsLength(e,3);const t=c.assertArgType(e,0,"list"),n=c.assertArgType(e,1,"number"),i=e[2];if(n%1!=0)throw new c.NativeFunctionError(`Index (${n}) has to be an integer`);if(n<0)throw new c.NativeFunctionError(`Index (${n}) cannot be negative`);if(n>=t.length)throw new c.NativeFunctionError(`Index (${n}) out of bounds. List length is `+t.length);const a=t.slice();return a[n]=i,{type:"list",value:a}},function listForEach(e,t){c.assertArgsLength(e,2);const n=c.assertArgType(e,0,"list"),a=c.assertArgType(e,1,"function");return n.forEach((e,n)=>{try{s.invokeFunctionRaw(a,[e,i.getMaybePooled("number",n)],t)}catch(e){if(e instanceof s.FunctionInvocationError)throw new c.NativeFunctionError(`Failed to apply function to the element with index = ${n} of list: ${e.message}`);throw e instanceof l.WTCDError&&e.pushWTCDStack(`listForEach (index = ${n})`),e}}),i.getMaybePooled("null",null)},function listMap(e,t){c.assertArgsLength(e,2);const n=c.assertArgType(e,0,"list"),a=c.assertArgType(e,1,"function");return{type:"list",value:n.map((e,n)=>{try{return s.invokeFunctionRaw(a,[e,i.getMaybePooled("number",n)],t)}catch(e){if(e instanceof s.FunctionInvocationError)throw new c.NativeFunctionError(`Failed to apply function to the element with index = ${n} of list: ${e.message}`);throw e instanceof l.WTCDError&&e.pushWTCDStack(`listForMap (index = ${n})`),e}})}},function listCreateFilled(e){c.assertArgsLength(e,1,2);const t=c.assertArgType(e,0,"number"),n=1===e.length?i.getMaybePooled("null",null):e[1];if(t%1!=0)throw new c.NativeFunctionError(`Length (${t}) has to be an integer.`);if(t<0)throw new c.NativeFunctionError(`Length (${t}) cannot be negative.`);return{type:"list",value:new Array(t).fill(n)}},function listChunk(e){c.assertArgsLength(e,2);const t=c.assertArgType(e,0,"list"),n=c.assertArgType(e,1,"number");if(n%1!=0||n<1)throw new c.NativeFunctionError(`Chunk size (${n} has to be a positive integer.`);const i=[];for(let e=0;e<t.length;e+=n)i.push({type:"list",value:t.slice(e,e+n)});return{type:"list",value:i}},function listFilter(e,t){c.assertArgsLength(e,2);const n=c.assertArgType(e,0,"list"),u=c.assertArgType(e,1,"function");return{type:"list",value:n.filter((e,n)=>{try{const l=s.invokeFunctionRaw(u,[e,i.getMaybePooled("number",n)],t);if("boolean"!==l.type)throw new c.NativeFunctionError(`Predicate is expected to return booleans, but ${a.describe(l)} is returned for element with index = `+n);return l.value}catch(e){if(e instanceof s.FunctionInvocationError)throw new c.NativeFunctionError(`Failed to apply function to the element with index = ${n} of list: ${e.message}`);throw e instanceof l.WTCDError&&e.pushWTCDStack(`listFilter (index = ${n})`),e}})}},function listSplice(e){c.assertArgsLength(e,3,4);const t=c.assertArgType(e,0,"list"),n=c.assertArgType(e,1,"number"),i=c.assertArgType(e,2,"number"),a=c.assertArgType(e,3,"list",[]);if(n%1!=0)throw new c.NativeFunctionError("Start index must be an integer, provided: "+n);if(n<0||n>t.length)throw new c.NativeFunctionError(`Start index must be in the bounds of the list given (0 - ${t.length}), provided: ${n}`);if(i%1!=0)throw new c.NativeFunctionError("Start must be an integer.");if(i<0)throw new c.NativeFunctionError("Length must be nonnegative.");if(n+i>t.length)throw new c.NativeFunctionError("Length is too large and causes overflow.");const s=t.slice();return s.splice(n,i,...a),{type:"list",value:s}},function listSlice(e){c.assertArgsLength(e,2,3);const t=c.assertArgType(e,0,"list"),n=c.assertArgType(e,1,"number"),i=c.assertArgType(e,2,"number",t.length);if(n%1!=0)throw new c.NativeFunctionError("Start index must be an integer, provided: "+n);if(n<0||n>t.length)throw new c.NativeFunctionError(`Start index must be in the bounds of the list given (0 - ${t.length}), provided: ${n}`);if(i%1!=0)throw new c.NativeFunctionError("End index must be an integer, provided: "+i);if(i<0||i>t.length)throw new c.NativeFunctionError(`End index must be in the bounds of the list given (0 - ${t.length}), provided: ${i}`);if(i<n)throw new c.NativeFunctionError(`End index must be larger or equal to start index. Provided start = ${n}, end = ${i}`);return{type:"list",value:t.slice(n,i)}},function listLength(e){return c.assertArgsLength(e,1),i.getMaybePooled("number",c.assertArgType(e,0,"list").length)},function listIndexOf(e){c.assertArgsLength(e,2);const t=c.assertArgType(e,0,"list");for(let n=0;n<t.length;n++)if(a.isEqual(t[n],e[1]))return i.getMaybePooled("number",n);return i.getMaybePooled("number",-1)},function listIncludes(e){c.assertArgsLength(e,2);const t=c.assertArgType(e,0,"list");return i.getMaybePooled("boolean",t.some(t=>a.isEqual(t,e[1])))},function listFindIndex(e,t){c.assertArgsLength(e,2);const n=c.assertArgType(e,0,"list"),u=c.assertArgType(e,1,"function");for(let e=0;e<n.length;e++){const d=n[e];try{const n=s.invokeFunctionRaw(u,[d,i.getMaybePooled("number",e)],t);if("boolean"!==n.type)throw new c.NativeFunctionError(`Predicate is expected to return booleans, but ${a.describe(n)} is returned for element with index = `+e);if(n.value)return i.getMaybePooled("number",e)}catch(t){if(t instanceof s.FunctionInvocationError)throw new c.NativeFunctionError(`Failed to apply function to the element with index = ${e} of list: ${t.message}`);throw t instanceof l.WTCDError&&t.pushWTCDStack(`listFindIndex (index = ${e})`),t}}return i.getMaybePooled("number",-1)}]},{"../Interpreter":70,"../WTCDError":72,"../constantsPool":74,"../invokeFunction":75,"./utils":86}],82:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.mathStdFunctions=void 0;const i=e("../constantsPool"),a=e("./utils");n.mathStdFunctions=[function mathMin(e){a.assertArgsLength(e,1,1/0);let t=1/0;for(let n=0;n<e.length;n++){const i=a.assertArgType(e,n,"number");i<t&&(t=i)}return i.getMaybePooled("number",t)},function mathMax(e){a.assertArgsLength(e,1,1/0);let t=-1/0;for(let n=0;n<e.length;n++){const i=a.assertArgType(e,n,"number");i>t&&(t=i)}return i.getMaybePooled("number",t)},function mathFloor(e){return a.assertArgsLength(e,1),i.getMaybePooled("number",Math.floor(a.assertArgType(e,0,"number")))},function mathCeil(e){return a.assertArgsLength(e,1),i.getMaybePooled("number",Math.ceil(a.assertArgType(e,0,"number")))}]},{"../constantsPool":74,"./utils":86}],83:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.randomStdFunctions=void 0;const i=e("../constantsPool"),a=e("./utils");n.randomStdFunctions=[function random(e,t){a.assertArgsLength(e,0,2);const n=a.assertArgType(e,0,"number",0),i=a.assertArgType(e,1,"number",1);return{type:"number",value:t.getRandom().next(n,i)}},function randomInt(e,t){a.assertArgsLength(e,2);const n=a.assertArgType(e,0,"number"),s=a.assertArgType(e,1,"number");return i.getMaybePooled("number",t.getRandom().nextInt(n,s))},function randomBoolean(e,t){a.assertArgsLength(e,0,1);const n=a.assertArgType(e,0,"number",.5);return i.getMaybePooled("boolean",t.getRandom().next()<n)},function randomBiased(e,t){a.assertArgsLength(e,0,4);const n=a.assertArgType(e,0,"number",0),i=a.assertArgType(e,1,"number",1),s=a.assertArgType(e,2,"number",(n+i)/2),l=a.assertArgType(e,3,"number",4);if(n>=i)throw new a.NativeFunctionError("Low cannot be larger than or equal to high.");if(s<n||s>i)throw new a.NativeFunctionError("Bias has to be between low and high.");let c;do{c=s+(i-n)/l*Math.sqrt(-2*Math.log(t.getRandom().next()))*Math.cos(2*Math.PI*t.getRandom().next())}while(c<n||c>=i);return{type:"number",value:c}}]},{"../constantsPool":74,"./utils":86}],84:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.readerStdFunctions=void 0;const i=e("../constantsPool"),a=e("./utils");n.readerStdFunctions=[function readerSetPinned(e,t){return a.assertArgsLength(e,1),a.assertArgType(e,0,"function"),t.setPinnedFunction(e[0]),i.getMaybePooled("null",null)},function readerUnsetPinned(e,t){return a.assertArgsLength(e,0),t.setPinnedFunction(null),i.getMaybePooled("null",null)},function readerSetStateDesc(e,t){a.assertArgsLength(e,1);const n=a.assertArgType(e,0,"string");return t.setStateDesc(n),i.getMaybePooled("null",null)},function readerUnsetStateDesc(e,t){return a.assertArgsLength(e,0),t.setStateDesc(null),i.getMaybePooled("null",null)}]},{"../constantsPool":74,"./utils":86}],85:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.stringStdFunctions=void 0;const i=e("../constantsPool"),a=e("./utils");n.stringStdFunctions=[function stringLength(e){a.assertArgsLength(e,1);const t=a.assertArgType(e,0,"string");return i.getMaybePooled("number",t.length)},function stringFormatNumberFixed(e){a.assertArgsLength(e,1,2);const t=a.assertArgType(e,0,"number"),n=a.assertArgType(e,1,"number",0);if(n<0||n>100||n%1!=0)throw new a.NativeFunctionError("Digits must be an integer between 0 and 100, received: "+n);return i.getMaybePooled("string",t.toFixed(n))},function stringFormatNumberPrecision(e){a.assertArgsLength(e,2);const t=a.assertArgType(e,0,"number"),n=a.assertArgType(e,1,"number");if(n<1||n>100||n%1!=0)throw new a.NativeFunctionError("Digits must be an integer between 1 and 100, received: "+n);return i.getMaybePooled("string",t.toPrecision(n))},function stringSplit(e){a.assertArgsLength(e,2);const t=a.assertArgType(e,0,"string"),n=a.assertArgType(e,1,"string");return i.getMaybePooled("list",t.split(n).map(e=>i.getMaybePooled("string",e)))},function stringSubByLength(e){a.assertArgsLength(e,2,3);const t=a.assertArgType(e,0,"string"),n=a.assertArgType(e,1,"number"),s=a.assertArgType(e,2,"number",t.length-n);if(n<0||n%1!=0)throw new a.NativeFunctionError("Start index must be an nonnegative integer, received: "+n);if(n>t.length)throw new a.NativeFunctionError(`Start cannot be larger than str length. startIndex=${n}, str length=${t.length}`);if(s<0||s%1!=0)throw new a.NativeFunctionError("Length must be an nonnegative integer , received: "+s);if(n+s>t.length)throw new a.NativeFunctionError(`Index out of bounds. startIndex=${n}, length=${s}, str length=${t.length}.`);return i.getMaybePooled("string",t.substr(n,s))},function stringSubByIndex(e){a.assertArgsLength(e,2,3);const t=a.assertArgType(e,0,"string"),n=a.assertArgType(e,1,"number"),s=a.assertArgType(e,2,"number",t.length);if(n<0||n%1!=0)throw new a.NativeFunctionError("Start index must be an nonnegative integer, received: "+n);if(n>t.length)throw new a.NativeFunctionError(`Start cannot be larger than str length. startIndex=${n}, str length=${t.length}`);if(s<0||s%1!=0)throw new a.NativeFunctionError("End index must be an nonnegative integer, received: "+s);if(s<n||s>t.length)throw new a.NativeFunctionError(`End index cannot be smaller than start index nor larger than the length of str. endIndex=${s}, startIndex=${n}, str length=`+t.length);return i.getMaybePooled("string",t.substring(n,s))}]},{"../constantsPool":74,"./utils":86}],86:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.assertArgType=n.nullify=n.assertArgsLength=n.NativeFunctionError=void 0;const i=e("../constantsPool"),a=e("../Interpreter");class NativeFunctionError extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}function nullify(e,t){const n=e[t];return void 0===n?i.getMaybePooled("null",null):n}n.NativeFunctionError=NativeFunctionError,n.assertArgsLength=function assertArgsLength(e,t,n=t){if(e.length<t)throw new NativeFunctionError(`Too few arguments are provided. Minimum number of arguments: ${t}, received: ${e.length}`);if(e.length>n)throw new NativeFunctionError(`Too many arguments are provided. Maximum number of arguments: ${n}, received: ${e.length}`)},n.nullify=nullify,n.assertArgType=function assertArgType(e,t,n,i){const s=nullify(e,t);if("null"===s.type&&void 0!==i)return i;if(s.type!==n)throw new NativeFunctionError(`The argument with index = ${t} of invocation has wrong type. Expected: ${n}, received: `+a.describe(s));return s.value}},{"../Interpreter":70,"../constantsPool":74}],87:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.arrayEquals=n.flat=void 0,n.flat=function flat(e){const t=[];for(const n of e)Array.isArray(n)?t.push(...n):t.push(n);return t},n.arrayEquals=function arrayEquals(e,t,n=((e,t)=>e===t)){return e.length===t.length&&e.every((e,i)=>n(e,t[i]))}},{}]},{},[40]);